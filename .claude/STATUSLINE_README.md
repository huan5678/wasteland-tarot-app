# ç‹€æ…‹åˆ—è…³æœ¬èªªæ˜

## ğŸ“Š æº–ç¢ºåº¦æ¯”è¼ƒ

| è…³æœ¬ | Token æ•¸ | ç™¾åˆ†æ¯” | èˆ‡ `/context` å·®ç•° | æ¨è–¦åº¦ |
|------|---------|--------|-------------------|--------|
| **statusline-plan-b.sh** (æ–¹æ¡ˆ B) | 113.9k | 57% | âœ… **-0.1k (-0.1%)** | â­â­â­â­â­ |
| **statusline.sh** (æ–¹æ¡ˆ A - ccusage) | 96.7k | 48% | âŒ **-17.3k (-9%)** | â­â­ |
| **`/context` (çœŸå¯¦å€¼)** | 114k | 57% | - | åŸºæº– |

**çµè«–**ï¼šæ–¹æ¡ˆ B å¹¾ä¹å®Œç¾æº–ç¢ºï¼

## ğŸ“‹ è…³æœ¬æ¸…å–®

### 1. `statusline-plan-b.sh` â­â­â­â­â­ï¼ˆæœ€æ¨è–¦ï¼‰
**æ–¹æ¡ˆ Bï¼šå¾ transcript è§£ææœ€æ–° message çš„çœŸå¯¦ tokens**

- **å„ªé»**ï¼š
  - âœ… **å¹¾ä¹å®Œç¾æº–ç¢º**ï¼šèˆ‡ `/context` èª¤å·®åƒ… 0.1%
  - âœ… ä½¿ç”¨å¿«å–æ©Ÿåˆ¶ï¼ˆåŸºæ–¼æ–‡ä»¶ä¿®æ”¹æ™‚é–“ï¼‰ï¼Œæ•ˆèƒ½å„ªåŒ–
  - âœ… è¨ˆç®—é‚è¼¯ç°¡å–®ï¼š`cache_read + cache_creation + input`
  - âœ… æ ¹æ“šç™¾åˆ†æ¯”è‡ªå‹•è®Šè‰²ï¼ˆç¶ /é»ƒ/ç´…ï¼‰

- **ç¼ºé»**ï¼š
  - âš ï¸ éœ€è¦è§£æ JSONL æ–‡ä»¶ï¼ˆä½†æœ‰å¿«å–ï¼Œå¯¦éš›å½±éŸ¿å¾ˆå°ï¼‰

- **é¡¯ç¤ºæ ¼å¼**ï¼š
  ```
  claude-sonnet-4-5-20250929 Â· 113.9k/200k tokens (57%)
  sean@hostname tarot-card-nextjs-app [branch â†‘2] 00:15:46
  ```

### 2. `statusline.sh` â­â­ï¼ˆç›®å‰ä½¿ç”¨ï¼Œä½†ä¸æº–ç¢ºï¼‰
**æ–¹æ¡ˆ Aï¼šä½¿ç”¨ ccusage çµ±è¨ˆ**

- **å„ªé»**ï¼š
  - âœ… é€Ÿåº¦è¼ƒå¿«
  - âœ… å¾ ccusage æå–ä¸¦é‡æ–°æ ¼å¼åŒ–

- **ç¼ºé»**ï¼š
  - âŒ **èª¤å·®ç´„ 9%**ï¼šæ¯”çœŸå¯¦å€¼å°‘ç´„ 17k tokens
  - âš ï¸ ccusage å¾æ—¥èªŒè¨ˆç®—ï¼Œæœ‰å»¶é²
  - âš ï¸ å¯èƒ½éºæ¼æŸäº› cache tokens

- **é¡¯ç¤ºæ ¼å¼**ï¼š
  ```
  claude-sonnet-4-5-20250929 Â· 96.7k/200k tokens (48%)
  sean@hostname tarot-card-nextjs-app [branch â†‘2] 00:15:46
  ```

### 3. `statusline-debug.sh` ğŸ”ï¼ˆé™¤éŒ¯ç”¨ï¼‰
**é™¤éŒ¯å·¥å…·ï¼šæŸ¥çœ‹å‚³å…¥çš„ JSON è³‡æ–™**

- **ç”¨é€”**ï¼šæª¢æŸ¥ Claude Code å‚³çµ¦ç‹€æ…‹åˆ—çš„å®Œæ•´ JSON è¼¸å…¥
- **è¼¸å‡º**ï¼šå°‡ JSON å„²å­˜è‡³ `/tmp/claude-statusline-input.json`

## ğŸ”„ åˆ‡æ›è…³æœ¬

ç·¨è¼¯ `.claude/settings.json`ï¼š

### ä½¿ç”¨æ–¹æ¡ˆ Bï¼ˆæœ€æ¨è–¦ï¼Œå¹¾ä¹å®Œç¾æº–ç¢ºï¼‰â­
```json
{
  "statusLine": {
    "type": "command",
    "command": "bash /Users/sean/Documents/React/tarot-card-nextjs-app/.claude/statusline-plan-b.sh",
    "padding": 0
  }
}
```

### ä½¿ç”¨æ–¹æ¡ˆ Aï¼ˆccusageï¼Œè¼ƒå¿«ä½†ä¸æº–ç¢ºï¼‰
```json
{
  "statusLine": {
    "type": "command",
    "command": "bash /Users/sean/Documents/React/tarot-card-nextjs-app/.claude/statusline.sh",
    "padding": 0
  }
}
```

### é™¤éŒ¯æ¨¡å¼
```json
{
  "statusLine": {
    "type": "command",
    "command": "bash /Users/sean/Documents/React/tarot-card-nextjs-app/.claude/statusline-debug.sh",
    "padding": 0
  }
}
```

## ğŸ¨ é¡è‰²èªªæ˜

**Token ä½¿ç”¨ç‡é¡è‰²**ï¼š
- ğŸŸ¢ **ç¶ è‰²** (<60%)ï¼šå®‰å…¨ç¯„åœ
- ğŸŸ¡ **é»ƒè‰²** (60-80%)ï¼šä¸­ç­‰ä½¿ç”¨
- ğŸ”´ **ç´…è‰²** (>80%)ï¼šæ¥è¿‘ä¸Šé™

**å…¶ä»–é¡è‰²**ï¼š
- ğŸŸ£ **ç´«è‰²**ï¼šæ¨¡å‹ IDã€Git branch
- ğŸ”µ **è—è‰²**ï¼šæ™‚é–“
- ğŸŸ¡ **é»ƒè‰²**ï¼šè·¯å¾‘
- ğŸ”µ **é’è‰²**ï¼šä½¿ç”¨è€…@ä¸»æ©Ÿ
- ğŸŸ¢ **ç¶ è‰²**ï¼šGit ahead (â†‘)
- ğŸ”´ **ç´…è‰²**ï¼šGit behind (â†“)

## ğŸ—‘ï¸ æ¸…ç†å¿«å–

å¦‚æœ token çµ±è¨ˆä¸æº–ç¢ºï¼Œå¯ä»¥æ¸…ç†å¿«å–ï¼š

```bash
rm /tmp/claude_token_cache_*.cache
```

## âš™ï¸ æŠ€è¡“ç´°ç¯€

### Token è¨ˆç®—é‚è¼¯ï¼ˆæ–¹æ¡ˆ 2ï¼‰

1. å¾ JSON è¼¸å…¥æå– `transcript_path`
2. æª¢æŸ¥å¿«å–æ˜¯å¦æœ‰æ•ˆï¼ˆåŸºæ–¼æ–‡ä»¶ä¿®æ”¹æ™‚é–“ï¼‰
3. å¦‚æœå¿«å–æœ‰æ•ˆï¼Œç›´æ¥ä½¿ç”¨å¿«å–æ•¸æ“š
4. å¦‚æœå¿«å–éæœŸæˆ–ä¸å­˜åœ¨ï¼š
   ```bash
   jq -s 'map(select(.usage)) | map(.usage.input_tokens + .usage.output_tokens) | add' transcript.jsonl
   ```
5. è¨ˆç®—ç™¾åˆ†æ¯”ã€æ ¼å¼åŒ–é¡¯ç¤ºã€è¨­å®šé¡è‰²
6. å„²å­˜è‡³å¿«å–ï¼ˆä¸‹æ¬¡ä½¿ç”¨ï¼‰

### å¿«å–æ©Ÿåˆ¶

- **å¿«å–ä½ç½®**ï¼š`/tmp/claude_token_cache_<MD5>.cache`
- **å¿«å–æ ¼å¼**ï¼š`{"mtime": 1234567890, "tokens": 58000}`
- **æœ‰æ•ˆæœŸ**ï¼šæ–‡ä»¶æœªä¿®æ”¹æ™‚æ°¸ä¹…æœ‰æ•ˆ
- **è‡ªå‹•æ›´æ–°**ï¼šæ–‡ä»¶ä¿®æ”¹å¾Œè‡ªå‹•é‡æ–°è¨ˆç®—

## ğŸ“Œ å»ºè­°

- **ä¸€èˆ¬ä½¿ç”¨**ï¼šä½¿ç”¨ `statusline.sh`ï¼ˆæ–¹æ¡ˆ 2ï¼‰ï¼Œæº–ç¢ºä¸”æœ‰å¿«å–å„ªåŒ–
- **æ•ˆèƒ½å•é¡Œ**ï¼šå¦‚æœè¦ºå¾—æ…¢ï¼Œå¯åˆ‡æ›è‡³ `statusline-ccusage.sh`ï¼ˆæ–¹æ¡ˆ 1ï¼‰
- **é™¤éŒ¯**ï¼šé‡åˆ°å•é¡Œæ™‚ä½¿ç”¨ `statusline-debug.sh` æŸ¥çœ‹ JSON è¼¸å…¥
