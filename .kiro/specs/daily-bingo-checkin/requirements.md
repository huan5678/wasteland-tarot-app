# 需求文件

## 專案概述
每日登入賓果遊戲是一個結合每日簽到機制與賓果遊戲玩法的使用者互動系統。系統每日產生1-25之間的隨機號碼，使用者每月可設定個人5x5賓果卡，透過每日登入獲得當日號碼，達成三條連線時獲得獎勵。此功能旨在提升使用者每日活躍度與平台黏著度，並透過遊戲化機制增強使用者參與感。

## Project Description (User Input)
我要製作一個每日登入簽到的賓果遊戲, 每日系統會產生一個從1-25的賓果號碼, 要確保一個巡迴25日都是隨機且不重複的數字, 每個登入的使用者都可以在每月1日重新設定賓果卡(5X5 Grid)號碼,且設定之後就不能修改了, 也要確認使用者的賓果卡號需要存於資料庫之中, 且每當使用者獲得三條連線時則可獲得獎勵(獎勵我們之後再來考慮), 而使用者只有每日登入才會獲得當日的賓果號碼, 因為沒登入而沒獲得已經過了的號碼則不會再獲得, 每月1號重置系統選號跟重置玩家的賓果卡, 每月重置後玩家首次登入時要重新手動設定賓果卡號碼

## 需求

### 需求 1: 系統每日號碼生成機制
**User Story:** 身為系統管理者，我希望系統能自動產生每日賓果號碼，確保25天循環內號碼隨機且不重複，以維持遊戲的公平性與可預測的循環週期。

#### Acceptance Criteria

1. WHEN 每日 00:00 UTC+8 系統執行定時任務 THEN 系統 SHALL 產生一個1-25之間的隨機號碼作為當日賓果號碼
2. WHEN 系統產生每日號碼時 AND 當前月份的號碼池未滿25個 THEN 系統 SHALL 確保產生的號碼在本月尚未出現過
3. WHEN 本月已產生的號碼數量達到25個時 THEN 系統 SHALL 清空號碼池並重新開始新的25日循環
4. WHEN 每月1日 00:00 UTC+8 THEN 系統 SHALL 重置當月號碼池為空，允許重新開始25日循環
5. WHERE 號碼生成歷史記錄 THE 系統 SHALL 將每日產生的號碼、日期與循環週期編號記錄於資料庫中

### 需求 2: 使用者賓果卡設定機制
**User Story:** 身為使用者，我希望能在每月初設定個人的5x5賓果卡號碼，以參與每日賓果遊戲並追蹤我的遊戲進度。

#### Acceptance Criteria

1. WHEN 每月1日之後使用者首次登入 AND 使用者尚未設定本月賓果卡 THEN 系統 SHALL 強制引導使用者設定5x5賓果卡
2. WHEN 使用者設定賓果卡時 THEN 系統 SHALL 要求使用者從1-25選擇25個不重複的數字填入5x5格子中
3. WHEN 使用者完成賓果卡設定 THEN 系統 SHALL 將賓果卡配置（25個號碼的排列）儲存至資料庫並關聯至該使用者與當月份
4. IF 使用者已在本月設定過賓果卡 THEN 系統 SHALL 不允許修改或重新設定
5. WHEN 每月1日 00:00 UTC+8 THEN 系統 SHALL 重置所有使用者的賓果卡狀態，標記為「未設定」

### 需求 3: 每日登入號碼領取機制
**User Story:** 身為使用者，我希望透過每日登入獲得當日系統產生的賓果號碼，以逐步完成我的賓果卡並獲得連線獎勵。

#### Acceptance Criteria

1. WHEN 使用者登入系統 AND 使用者已設定本月賓果卡 AND 使用者尚未領取當日號碼 THEN 系統 SHALL 自動將當日系統號碼標記為該使用者已獲得
2. WHEN 使用者獲得當日號碼 AND 該號碼存在於使用者賓果卡中 THEN 系統 SHALL 在使用者賓果卡上標記該號碼為「已獲得」
3. IF 使用者當日已登入並領取號碼 THEN 系統 SHALL 不重複發放當日號碼
4. IF 使用者未在特定日期登入 AND 該日期已過 THEN 系統 SHALL 不允許使用者補領該日期的號碼
5. WHERE 使用者號碼領取歷史 THE 系統 SHALL 記錄每位使用者每日領取號碼的時間戳記與號碼內容

### 需求 4: 賓果連線檢測與獎勵機制
**User Story:** 身為使用者，我希望當我的賓果卡達成三條連線時，系統能自動檢測並發放獎勵，以獲得遊戲成就感。

#### Acceptance Criteria

1. WHEN 使用者獲得新號碼並標記於賓果卡上 THEN 系統 SHALL 即時檢測賓果卡是否形成新的連線（橫、直、斜）
2. WHEN 賓果卡檢測到連線數達到3條 AND 使用者尚未領取三連線獎勵 THEN 系統 SHALL 觸發獎勵發放流程
3. WHEN 觸發獎勵發放 THEN 系統 SHALL 記錄獎勵發放時間、連線類型與使用者ID於資料庫中
4. IF 使用者已在本月領取過三連線獎勵 THEN 系統 SHALL 不重複發放獎勵
5. WHERE 連線檢測邏輯 THE 系統 SHALL 支援檢測5種橫向、5種直向與2種對角線連線，共12種可能連線

### 需求 5: 每月重置機制
**User Story:** 身為系統管理者，我希望系統每月1日自動重置所有遊戲狀態，確保每個月都是全新的遊戲循環。

#### Acceptance Criteria

1. WHEN 每月1日 00:00 UTC+8 THEN 系統 SHALL 執行每月重置任務
2. WHEN 執行每月重置任務 THEN 系統 SHALL 清空本月系統號碼池、重置所有使用者賓果卡狀態為「未設定」、清除使用者號碼領取記錄
3. WHEN 執行每月重置任務 THEN 系統 SHALL 保留歷史月份的遊戲記錄（號碼、賓果卡、獎勵記錄）於歷史資料表中
4. IF 重置任務執行失敗 THEN 系統 SHALL 記錄錯誤日誌並發送管理員通知
5. WHEN 重置任務完成 THEN 系統 SHALL 記錄重置執行時間與狀態於系統日誌中

### 需求 6: 資料持久化與查詢
**User Story:** 身為開發者，我希望所有遊戲資料正確儲存於資料庫中，以確保資料完整性與支援未來的查詢與分析需求。

#### Acceptance Criteria

1. WHERE 使用者賓果卡資料 THE 系統 SHALL 儲存使用者ID、月份、25個號碼位置、設定時間於 `user_bingo_cards` 資料表
2. WHERE 系統每日號碼資料 THE 系統 SHALL 儲存日期、號碼、循環週期編號於 `daily_bingo_numbers` 資料表
3. WHERE 使用者號碼領取記錄 THE 系統 SHALL 儲存使用者ID、日期、號碼、領取時間於 `user_number_claims` 資料表
4. WHERE 獎勵發放記錄 THE 系統 SHALL 儲存使用者ID、月份、獎勵類型、發放時間於 `bingo_rewards` 資料表
5. WHERE 歷史遊戲記錄 THE 系統 SHALL 在每月重置後將本月資料歸檔至對應的歷史資料表中

### 需求 7: 使用者介面與互動
**User Story:** 身為使用者，我希望有清晰易用的介面來設定賓果卡、查看當日號碼與追蹤我的連線進度。

#### Acceptance Criteria

1. WHEN 使用者進入賓果遊戲頁面 AND 尚未設定本月賓果卡 THEN 系統 SHALL 顯示賓果卡設定介面，包含1-25號碼選擇器
2. WHEN 使用者設定賓果卡時 THEN 介面 SHALL 即時驗證號碼不重複，並在25個格子填滿後允許提交
3. WHEN 使用者完成賓果卡設定 THEN 介面 SHALL 顯示使用者的5x5賓果卡，並標示已獲得與未獲得的號碼
4. WHEN 使用者每日登入 THEN 介面 SHALL 顯示當日系統產生的號碼，並在賓果卡上高亮標示
5. WHERE 連線狀態顯示 THE 介面 SHALL 視覺化呈現使用者已完成的連線數量與連線類型（橫、直、斜）
6. WHEN 使用者達成三連線 THEN 介面 SHALL 顯示獎勵獲得通知與慶祝動畫

### 需求 8: 系統定時任務與自動化
**User Story:** 身為系統管理者，我希望系統能自動執行每日號碼生成與每月重置任務，無需人工介入。

#### Acceptance Criteria

1. WHERE 定時任務排程 THE 系統 SHALL 配置每日 00:00 UTC+8 執行號碼生成任務
2. WHERE 定時任務排程 THE 系統 SHALL 配置每月1日 00:00 UTC+8 執行月度重置任務
3. WHEN 定時任務執行時 THEN 系統 SHALL 記錄任務開始時間、執行狀態與結束時間於系統日誌
4. IF 定時任務執行失敗 THEN 系統 SHALL 自動重試最多3次，並在最終失敗時發送管理員告警
5. WHILE 定時任務執行中 THE 系統 SHALL 確保資料庫操作的原子性與一致性，避免並發問題
