# Dashboard Gamification System - 需求文件

## 1. 專案概述

### 1.1 專案目標
重構 Dashboard 活躍度系統，引入 Fallout 風格的遊戲化機制，提升用戶參與度和留存率。

### 1.2 核心設計原則
- **簡單明確**：避免過度設計，優先實現核心功能
- **Fallout 美學**：嚴格遵循 Pip-Boy 終端機風格
- **即時反饋**：用戶行為立即獲得視覺與數值反饋
- **向後相容**：不破壞現有功能

---

## 2. 功能需求

### 2.1 Karma 業力系統

#### 2.1.1 核心定義
- **性質**：純數值系統，正整數，無上限
- **初始值**：新用戶註冊時 Karma = 0
- **運作方式**：只增不減，永久累積
- **用途**：
  - 用戶等級計算（每 500 Karma 升 1 級）
  - 全服排行榜
  - 解鎖特殊稱號
  - 兌換特殊內容（未來擴展）

#### 2.1.2 Karma 獲得規則

| 行為類型 | Karma 獎勵 | 觸發條件 | 頻率限制 |
|---------|-----------|---------|---------|
| **基礎行為** |
| 每日首次登入 | +5 | 每日首次訪問系統 | 每日 1 次 |
| 完成占卜 | +10 | 完成一次塔羅占卜 | 無限制 |
| 分享解讀 | +15 | 分享占卜結果到社交平台 | 每次占卜 1 次 |
| **任務獎勵** |
| 完成每日任務 | +20 | 完成單個每日任務 | 每日每任務 1 次 |
| 完成每週任務 | +50 | 完成單個每週任務 | 每週每任務 1 次 |
| **里程碑獎勵** |
| 連續登入 3 天 | +30 | 達成連續登入里程碑 | 每次達成 |
| 連續登入 7 天 | +50 | 達成連續登入里程碑 | 每次達成 |
| 連續登入 30 天 | +200 | 達成連續登入里程碑 | 每次達成 |
| 完成 10 次占卜 | +100 | 累積占卜次數里程碑 | 每次達成 |
| 完成 50 次占卜 | +300 | 累積占卜次數里程碑 | 每次達成 |
| 完成 100 次占卜 | +500 | 累積占卜次數里程碑 | 每次達成 |
| **社交獎勵** |
| 獲得讚賞 | +3 | 分享的解讀被其他用戶點讚 | 每個讚 |
| 獲得評論 | +5 | 分享的解讀被其他用戶評論 | 每則評論 |

#### 2.1.3 等級系統

```
等級計算公式：Level = floor(total_karma / 500) + 1
```

**等級對照表**：
| 等級 | 所需 Karma | 稱號 |
|-----|-----------|------|
| 1 | 0 - 499 | Vault 新成員 |
| 2 | 500 - 999 | 避難所探索者 |
| 3 | 1000 - 1499 | 廢土流浪者 |
| 4 | 1500 - 1999 | 終端機使用者 |
| 5 | 2000 - 2499 | Pip-Boy 專家 |
| 10 | 4500 - 4999 | 廢土傳奇 |
| 20+ | 9500+ | Vault 長老 |

---

### 2.2 任務系統

#### 2.2.1 每日任務（Daily Tasks）

**特性**：
- 固定 3 個任務
- 每日 00:00 (UTC+8) 重置
- 完成後可立即領取獎勵
- 未完成任務不保留

**任務列表**：

| 任務 ID | 任務名稱 | 描述 | 目標值 | Karma 獎勵 |
|--------|---------|------|--------|-----------|
| daily_reading | 完成 1 次占卜 | 進行一次塔羅占卜解讀 | 1 | 20 |
| daily_login | 每日登入 | 登入 Pip-Boy 終端機 | 1 | 20 |
| daily_share | 分享 1 次解讀 | 將占卜結果分享到社交平台 | 1 | 20 |

**總獎勵**：60 Karma/天（全部完成）

#### 2.2.2 每週任務（Weekly Tasks）

**特性**：
- 固定 5 個任務
- 每週一 00:00 (UTC+8) 重置
- 難度高於每日任務
- 獎勵更豐厚

**任務列表**：

| 任務 ID | 任務名稱 | 描述 | 目標值 | Karma 獎勵 |
|--------|---------|------|--------|-----------|
| weekly_readings | 完成 5 次占卜 | 進行 5 次塔羅占卜 | 5 | 50 |
| weekly_streak | 連續登入 3 天 | 連續 3 天登入系統 | 3 | 50 |
| weekly_collection | 收集 10 張卡牌 | 在占卜中抽到 10 張不同的卡牌 | 10 | 50 |
| weekly_social | 獲得 3 個讚 | 分享的解讀獲得 3 個讚 | 3 | 50 |
| weekly_daily_complete | 完成每日任務 3 次 | 完成 3 天的所有每日任務 | 3 | 50 |

**總獎勵**：250 Karma/週（全部完成）

#### 2.2.3 任務進度追蹤

**追蹤機制**：
- 用戶完成相關行為時，自動更新任務進度
- 進度以百分比顯示（例如：2/5 = 40%）
- 達到目標值後，任務狀態變為「可領取」
- 用戶手動點擊「領取獎勵」按鈕完成任務

**整合點**：
- 完成占卜 → 更新 `daily_reading`, `weekly_readings` 進度
- 每日登入 → 更新 `daily_login`, `weekly_streak` 進度
- 分享解讀 → 更新 `daily_share` 進度
- 收集卡牌 → 更新 `weekly_collection` 進度
- 獲得讚賞 → 更新 `weekly_social` 進度

---

### 2.3 活躍度統計系統

#### 2.3.1 追蹤維度

**占卜活動**：
- 每日占卜次數
- 累積占卜總數
- 占卜卡牌分佈
- 解讀字數（未來擴展）

**社交互動**：
- 分享次數
- 獲得讚數
- 獲得評論數
- 互動率（未來擴展）

**登入習慣**：
- 每日登入狀態
- 連續登入天數（當前）
- 最長連續登入天數（歷史紀錄）
- 最後登入時間
- 平均每日活躍時長（未來擴展）

#### 2.3.2 統計粒度

**即時統計**（關鍵行為）：
- 占卜完成
- 任務完成
- Karma 獲得
- 連續登入更新

**批次統計**（輔助數據）：
- 每日活躍時長（每小時聚合一次）
- 卡牌收集進度（每天計算一次）

#### 2.3.3 顯示維度

**Dashboard 統計卡片**：
- 今日統計（今日占卜、今日 Karma、今日任務進度）
- 7 日統計（7 日占卜趨勢、7 日 Karma 趨勢）
- 總覽數據（總占卜次數、總 Karma、當前等級、連續登入）

---

## 3. 非功能需求

### 3.1 效能需求

| 指標 | 目標值 | 測量方式 |
|-----|-------|---------|
| Dashboard 頁面載入時間 | < 2 秒 | Lighthouse Performance Score > 80 |
| Karma 統計查詢 | < 500ms | Backend API 響應時間 |
| 任務進度更新 | < 200ms | Backend API 響應時間 |
| 活躍度統計查詢 | < 1 秒 | Backend API 響應時間 |
| 前端重渲染次數 | 最小化 | React Profiler 分析 |

### 3.2 資料一致性

**Karma 計算**：
- 使用資料庫事務確保 Karma 授予與記錄的原子性
- Karma 總計與 logs 總和必須一致
- 防止重複授予 Karma（冪等性設計）

**任務進度**：
- 任務完成狀態必須與獎勵領取狀態一致
- 每日/每週重置必須準確無誤
- 進度值不能超過目標值

**連續登入**：
- 斷連處理：超過 1 天未登入則連續天數歸零
- 時區處理：統一使用 UTC+8
- 跨日判定：以 00:00 為分界

### 3.3 安全性需求

- 所有 API 需要用戶認證（JWT Token）
- 防止惡意刷 Karma（頻率限制、行為驗證）
- 防止任務重複領取（冪等性檢查）
- 敏感操作記錄審計日誌

### 3.4 可擴展性

- 資料庫表設計支援未來新增任務類型
- Karma 獲得規則易於調整（配置化）
- 等級系統公式可調整
- 預留特殊事件獎勵機制（節日活動、限時任務）

### 3.5 向後相容性

- 不影響現有 Dashboard 功能
- 不影響現有 Bingo 簽到系統
- 不影響現有 Achievement 系統（未來整合）
- 資料庫 Migration 可安全回滾

---

## 4. UI/UX 需求

### 4.1 視覺風格

**設計語言**：Fallout 4 Pip-Boy 終端機
- 主色調：Pip-Boy Green (`#00ff88`)
- 輔助色：僅在必要時使用（橙色任務進度、紅色錯誤提示）
- 字體：Cubic 11 像素字體
- 背景：黑色半透明 (`bg-black/75`) + 毛玻璃效果

### 4.2 特效需求

**必須實現**：
- CRT 掃描線動畫（全局背景）
- 打字機文字效果（任務完成提示）
- 數字跳動動畫（Karma 增加時）
- 發光效果（Karma 數字、進度條）

**可選實現**：
- Glitch 故障效果（載入錯誤時）
- 輻射波紋效果（任務完成時）
- 終端機音效（按鈕點擊、任務完成）

### 4.3 響應式設計

**斷點**：
- Mobile: < 640px（單欄佈局）
- Tablet: 640px - 1024px（雙欄佈局）
- Desktop: > 1024px（三欄佈局）

**適配要求**：
- 所有元件必須支援響應式
- 觸控裝置優化（按鈕最小 44×44px）
- 橫屏模式適配

### 4.4 無障礙性

- 所有互動元素必須有 `aria-label`
- 顏色對比度符合 WCAG AA 標準
- 鍵盤導航支援
- 螢幕閱讀器友善

---

## 5. 成功指標（KPI）

### 5.1 用戶參與度
- 每日活躍用戶數 (DAU) 提升 30%
- 平均每日占卜次數提升 50%
- 用戶留存率（7日）提升 25%

### 5.2 功能使用率
- 每日任務完成率 > 60%
- 每週任務完成率 > 40%
- Dashboard 頁面訪問率 > 70%（註冊用戶）

### 5.3 用戶滿意度
- 用戶回饋正面評價 > 80%
- UI/UX 評分 > 4.0/5.0
- 功能錯誤率 < 1%

---

## 6. 範圍外（Out of Scope）

以下功能**不在本次實作範圍**，未來可擴展：

- ❌ Karma 消費系統（商店、兌換）
- ❌ PvP 競技系統
- ❌ 公會/組隊系統
- ❌ 成就系統整合（已有獨立規劃）
- ❌ 語音播報功能
- ❌ 多語言支援
- ❌ 深度數據分析（BI Dashboard）

---

## 7. 變更記錄

| 版本 | 日期 | 變更內容 | 負責人 |
|-----|------|---------|--------|
| v1.0 | 2025-01-04 | 初始版本 | Claude |

---

**文件狀態**：✅ 已核准
**下一步**：產出技術設計文件（design.md）
