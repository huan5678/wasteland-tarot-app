# éœ€æ±‚æ–‡æª” - éŸ³æ¨‚ç³»çµ±æ•´åˆæ–¹æ¡ˆï¼ˆæ’­æ”¾å™¨ + ç¯€å¥ç·¨è¼¯å™¨ï¼‰

## ç°¡ä»‹

æœ¬è¦æ ¼æ¶µè“‹å…©å€‹ç¨ç«‹ä½†äº’è£œçš„éŸ³æ¨‚ç³»çµ±ï¼š

### ç³»çµ±æ¶æ§‹æ¦‚è¦½ï¼ˆPattern-Based æ¶æ§‹ + è¨ªå®¢ç³»çµ±ï¼‰â­ v4.0 æ›´æ–°

```
è¨ªå®¢æµç¨‹ï¼ˆv4.0 æ–°å¢ï¼‰ï¼š
è¨ªå®¢ç€è¦½å…¬é–‹æ­Œæ›²
  â†“
é¸æ“‡æ­Œæ›²åŠ å…¥ localStorage æ’­æ”¾æ¸…å–®ï¼ˆä¸Šé™ 4 é¦–ï¼‰
  â†“
éŸ³æ¨‚æ’­æ”¾å™¨æ’­æ”¾ï¼ˆRhythmAudioSynthesizerï¼‰
  â†“
è¨»å†Š â†’ é¸æ“‡åŒ¯å…¥æ’­æ”¾æ¸…å–®åˆ°è³‡æ–™åº«ï¼ˆå¯é¸ï¼‰

è¨»å†Šä½¿ç”¨è€…æµç¨‹ï¼š
ä½¿ç”¨è€…å‰µå»ºç¯€å¥ï¼ˆç¯€å¥ç·¨è¼¯å™¨ï¼‰
  â†“
å„²å­˜ç‚º Pattern (user_rhythm_presets) + é¸æ“‡å…¬é–‹/ç§å¯†
  â†“
åŠ å…¥æ’­æ”¾æ¸…å–® (playlists + playlist_patterns)
  â†“
éŸ³æ¨‚æ’­æ”¾å™¨æ’­æ”¾ (RhythmAudioSynthesizer)
```

### ç³»çµ±çµ„ä»¶æ¶æ§‹

```
å‰å°ï¼ˆå…¬é–‹ä½¿ç”¨è€… + è¨ªå®¢ï¼‰:
â”œâ”€ éŸ³æ¨‚æ’­æ”¾å™¨ (MusicPlayerDrawer) - Pattern-Based æ’­æ”¾æ¸…å–®æ§åˆ¶ â­
â”‚   â”œâ”€ æ’­æ”¾æ¸…å–®é¸æ“‡å™¨ï¼ˆé¸æ“‡ Pattern æ’­æ”¾æ¸…å–®ï¼‰
â”‚   â”œâ”€ è¨ªå®¢æ’­æ”¾æ¸…å–®ç®¡ç†ï¼ˆlocalStorageï¼Œä¸Šé™ 4 é¦–ï¼‰â­ v4.0 æ–°å¢
â”‚   â”œâ”€ RhythmAudioSynthesizerï¼ˆWeb Audio API åˆæˆå™¨ï¼‰â­
â”‚   â”œâ”€ æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾/æš«åœ/ä¸Šä¸€é¦–/ä¸‹ä¸€é¦–/éš¨æ©Ÿ/å¾ªç’°ï¼‰
â”‚   â””â”€ ç•¶å‰æ’­æ”¾è³‡è¨Šï¼ˆPattern åç¨±ã€æè¿°ã€æ’­æ”¾æ¸…å–®ï¼‰
â”œâ”€ å…¬é–‹æ­Œæ›²ç€è¦½å™¨ â­ v4.0 æ–°å¢
â”‚   â”œâ”€ ç³»çµ±é è¨­æ­Œæ›²ï¼ˆ5 é¦–ï¼‰
â”‚   â”œâ”€ å…¬é–‹çš„ä½¿ç”¨è€…å‰µä½œæ­Œæ›²ï¼ˆis_public = trueï¼‰
â”‚   â””â”€ åˆ†é ã€æ’åºã€æœå°‹åŠŸèƒ½
â””â”€ ç¨‹åºå¼éŸ³æ¨‚å¼•æ“ (ProceduralMusicEngine) - ä¿ç•™ä½œç‚ºå‚™ç”¨

å¾Œå°ï¼ˆç™»å…¥ä½¿ç”¨è€…å°ˆå±¬ï¼‰:
â””â”€ /dashboard/rhythm-editor - ç¨ç«‹ç¯€å¥ç·¨è¼¯å™¨é é¢ â˜…
    â”œâ”€ 16 æ­¥é©ŸéŸ³åºå™¨ï¼ˆ5 è»Œé“ï¼šKickã€Snareã€HiHatã€OpenHatã€Clapï¼‰
    â”œâ”€ AI ç¯€å¥ç”Ÿæˆï¼ˆLLM + é…é¡ç®¡ç† 20 æ¬¡/æ—¥ï¼‰
    â”œâ”€ Preset ç®¡ç†ç³»çµ±ï¼ˆç³»çµ±é è¨­ + ä½¿ç”¨è€…è‡ªè¨‚ï¼‰
    â”œâ”€ å…¬é–‹/ç§å¯†è¨­å®šï¼ˆå„²å­˜æ™‚å‹¾é¸ï¼‰â­ v4.0 æ–°å¢
    â””â”€ Web Audio API åˆæˆå™¨ï¼ˆç¨ç«‹ AudioContextï¼‰
```

### è³‡æ–™æµæ¶æ§‹

```
ç¯€å¥ç·¨è¼¯å™¨ (Rhythm Editor):
  ä½¿ç”¨è€…æ“ä½œ â†’ 16 æ­¥é©Ÿç¶²æ ¼
       â†“
  å„²å­˜ Preset â†’ user_rhythm_presets è¡¨
       â†“
  ç³»çµ±é è¨­ï¼ˆ5 å€‹ï¼‰+ ä½¿ç”¨è€…è‡ªè¨‚ï¼ˆæœ€å¤š 10 å€‹ï¼‰

æ’­æ”¾æ¸…å–®ç®¡ç† (Playlist Manager):
  ç€è¦½å¯ç”¨ Pattern â†’ GET /api/v1/music/presets/available
       â†“
  å»ºç«‹æ’­æ”¾æ¸…å–® â†’ playlists è¡¨
       â†“
  åŠ å…¥ Pattern â†’ playlist_patterns è¡¨ï¼ˆé—œè¯ pattern_idï¼‰
       â†“
  èª¿æ•´é †åº/ç§»é™¤ Pattern

éŸ³æ¨‚æ’­æ”¾å™¨ (Music Player):
  é¸æ“‡æ’­æ”¾æ¸…å–® â†’ GET /api/v1/playlists/{id}
       â†“
  è¼‰å…¥ Pattern é™£åˆ— â†’ patterns[0].pattern
       â†“
  RhythmAudioSynthesizer æ’­æ”¾ â†’ Web Audio API
       â†“
  å¾ªç’° 4 æ¬¡å¾Œ â†’ ä¸‹ä¸€å€‹ Pattern
```

### ç³»çµ± Aï¼šæ’­æ”¾æ¸…å–®éŸ³æ¨‚æ’­æ”¾å™¨ï¼ˆå‰å°ï¼‰

å°‡ Wasteland Tarot ç¶²ç«™çš„è‡ªå‹•å ´æ™¯éŸ³æ¨‚ç³»çµ±**å®Œå…¨ç§»é™¤**ï¼Œæ”¹é€ ç‚ºä½¿ç”¨è€…ä¸»å°çš„æ’­æ”¾æ¸…å–®éŸ³æ¨‚æ§åˆ¶ç³»çµ±ã€‚ä½¿ç”¨è€…å¯ä»¥ç€è¦½æ‰€æœ‰å¯ç”¨çš„éŸ³æ¨‚æ¨¡å¼ï¼ˆsynthwaveã€divinationã€lofiã€ambient ç­‰ï¼‰ï¼Œå»ºç«‹è‡ªè¨‚æ’­æ”¾æ¸…å–®ï¼Œä¸¦**å®Œå…¨æ‰‹å‹•æ§åˆ¶**éŸ³æ¨‚æ’­æ”¾ã€‚æ’­æ”¾å™¨ä»‹é¢å°‡æ¡ç”¨ Fallout Pip-Boy ç¾å­¸é¢¨æ ¼ï¼Œä½¿ç”¨ shadcn/ui Drawer ä½œç‚ºä¸»æ’­æ”¾å™¨ä»‹é¢ï¼ŒSheet ä½œç‚ºå½ˆçª—æ’­æ”¾æ¸…å–®ã€‚

### ç³»çµ± Bï¼šç¯€å¥ç·¨è¼¯å™¨ï¼ˆå¾Œå°ï¼‰â­ æ–°å¢

**å®Œå…¨ç¨ç«‹çš„å¾Œå°ç³»çµ±**ï¼Œæä¾›ç™»å…¥ä½¿ç”¨è€…å‰µå»ºå’Œç·¨è¼¯ç¯€å¥ pattern çš„åŠŸèƒ½ã€‚ä½¿ç”¨ 16 æ­¥é©ŸéŸ³åºå™¨ã€AI ç¯€å¥ç”Ÿæˆã€Preset ç®¡ç†ï¼Œä¸¦ä½¿ç”¨ Web Audio API åˆæˆéŸ³æ•ˆã€‚æ­¤ç³»çµ±**ä¸åœ¨**éŸ³æ¨‚æ’­æ”¾å™¨å…§ï¼Œè€Œæ˜¯ç¨ç«‹çš„ `/dashboard/rhythm-editor` é é¢ã€‚

### å•†æ¥­åƒ¹å€¼
- **å®Œå…¨ä½¿ç”¨è€…æ§åˆ¶**ï¼šç§»é™¤è‡ªå‹•æ’­æ”¾ï¼Œæ‰€æœ‰éŸ³æ¨‚ç”±ä½¿ç”¨è€…æ‰‹å‹•å•Ÿå‹•å’Œç®¡ç†
- **æå‡ä½¿ç”¨è€…é«”é©—**ï¼šå¾è¢«å‹•æ¥å—å ´æ™¯éŸ³æ¨‚æ”¹ç‚ºä¸»å‹•æ§åˆ¶ï¼Œæé«˜ä½¿ç”¨è€…æ»¿æ„åº¦
- **å¢åŠ äº’å‹•æ€§**ï¼šæ’­æ”¾æ¸…å–®å»ºç«‹å’Œç®¡ç†åŠŸèƒ½å¢å¼·å¹³å°é»æ€§
- **å€‹äººåŒ–é«”é©—**ï¼šä½¿ç”¨è€…å¯æ ¹æ“šå€‹äººå–œå¥½é¸æ“‡éŸ³æ¨‚ï¼Œæå‡æ²‰æµ¸æ„Ÿ
- **å“ç‰Œä¸€è‡´æ€§**ï¼šPip-Boy é¢¨æ ¼æ’­æ”¾å™¨å¼·åŒ– Fallout ä¸»é¡Œé«”é©—
- **å‰µæ„å·¥å…·æä¾›**ï¼šç¯€å¥ç·¨è¼¯å™¨è®“é€²éšä½¿ç”¨è€…å‰µå»ºè‡ªè¨‚ç¯€å¥ï¼Œå¢åŠ å¹³å°åƒ¹å€¼ â­
- **AI å¢å¼·åŠŸèƒ½**ï¼šæ•´åˆ AI ç”Ÿæˆç¯€å¥ï¼Œæä¾›å‰µæ–°çš„éŸ³æ¨‚å‰µä½œé«”é©— â­

### æŠ€è¡“æ•´åˆ
- æ•´åˆç¾æœ‰ ProceduralMusicEngineï¼ˆç¨‹åºå¼éŸ³æ¨‚ç”Ÿæˆï¼‰
- æ•´åˆç¾æœ‰ audioStoreï¼ˆZustand ç‹€æ…‹ç®¡ç†ï¼‰
- æ•´åˆç¾æœ‰ VolumeControl çµ„ä»¶ï¼ˆéŸ³é‡æ§åˆ¶ï¼‰
- ä½¿ç”¨ shadcn/ui Drawer çµ„ä»¶ï¼ˆä¸»æ’­æ”¾å™¨ä»‹é¢ï¼‰
- ä½¿ç”¨ shadcn/ui Sheet çµ„ä»¶ï¼ˆå½ˆçª—æ’­æ”¾æ¸…å–®ï¼‰
- ä½¿ç”¨ shadcn/ui å…¶ä»–çµ„ä»¶ï¼ˆä¿æŒè¨­è¨ˆä¸€è‡´æ€§ï¼‰
- **æ–°å¢**ï¼šWeb Audio API éŸ³æ•ˆåˆæˆå™¨ï¼ˆç¯€å¥ç·¨è¼¯å™¨å°ˆç”¨ï¼‰â­
- **æ–°å¢**ï¼šAI Provider æ•´åˆï¼ˆç¯€å¥ç”Ÿæˆï¼‰â­
- **æ–°å¢**ï¼šSupabase é…é¡ç®¡ç†ç³»çµ±ï¼ˆuser_ai_quotasï¼‰â­

## è¨ªå®¢ vs è¨»å†Šä½¿ç”¨è€…æ¬Šé™å°æ¯” â­ v4.0 æ–°å¢

| åŠŸèƒ½ | è¨ªå®¢ï¼ˆæœªç™»å…¥ï¼‰ | è¨»å†Šä½¿ç”¨è€…ï¼ˆå·²ç™»å…¥ï¼‰ |
|------|---------------|---------------------|
| **æŸ¥çœ‹å…¬é–‹æ­Œæ›²** | âœ… å¯ä»¥ | âœ… å¯ä»¥ |
| **æŸ¥çœ‹ç³»çµ±é è¨­æ­Œæ›²** | âœ… å¯ä»¥ï¼ˆ5 é¦–ï¼‰ | âœ… å¯ä»¥ï¼ˆ5 é¦–ï¼‰ |
| **æŸ¥çœ‹è‡ªå·±çš„æ­Œæ›²** | âŒ ç„¡æ³• | âœ… å¯ä»¥ |
| **å‰µå»ºç¯€å¥æ­Œæ›²** | âŒ ç„¡æ³• | âœ… å¯ä»¥ |
| **å„²å­˜æ­Œæ›²æ™‚é¸æ“‡å…¬é–‹/ç§å¯†** | âŒ ç„¡æ³• | âœ… å¯ä»¥ |
| **å»ºç«‹æ’­æ”¾æ¸…å–®** | âœ… å¯ä»¥ï¼ˆlocalStorageï¼Œä¸Šé™ 1 å€‹æ¸…å–®ï¼‰ | âœ… å¯ä»¥ï¼ˆè³‡æ–™åº«ï¼Œç„¡é™åˆ¶ï¼‰ |
| **æ’­æ”¾æ¸…å–®å…§æ­Œæ›²æ•¸é‡** | âš ï¸ ä¸Šé™ 4 é¦– | âœ… ç„¡é™åˆ¶ |
| **æ’­æ”¾æ¸…å–®æŒä¹…åŒ–** | âš ï¸ localStorageï¼ˆæ›è£ç½®æœƒéºå¤±ï¼‰ | âœ… è³‡æ–™åº«ï¼ˆè·¨è£ç½®åŒæ­¥ï¼‰ |
| **AI ç”Ÿæˆç¯€å¥** | âŒ ç„¡æ³•ï¼ˆéœ€ç™»å…¥ï¼‰ | âœ… å¯ä»¥ï¼ˆ20 æ¬¡/å¤©ï¼‰ |

### æ­Œæ›²å¯è¦‹æ€§è¦å‰‡

```
è¨ªå®¢å¯è¦‹çš„æ­Œæ›²ï¼š
â”œâ”€ ç³»çµ±é è¨­æ­Œæ›²ï¼ˆ5 é¦–ï¼‰
â”‚   â”œâ”€ Techno
â”‚   â”œâ”€ House
â”‚   â”œâ”€ Trap
â”‚   â”œâ”€ Breakbeat
â”‚   â””â”€ Minimal
â””â”€ å…¬é–‹çš„ä½¿ç”¨è€…å‰µä½œæ­Œæ›²ï¼ˆis_public = trueï¼‰
    â”œâ”€ ä½¿ç”¨è€… A çš„å…¬é–‹æ­Œæ›²
    â”œâ”€ ä½¿ç”¨è€… B çš„å…¬é–‹æ­Œæ›²
    â””â”€ ...

è¨»å†Šä½¿ç”¨è€…å¯è¦‹çš„æ­Œæ›²ï¼š
â”œâ”€ ç³»çµ±é è¨­æ­Œæ›²ï¼ˆ5 é¦–ï¼‰
â”œâ”€ å…¬é–‹çš„ä½¿ç”¨è€…å‰µä½œæ­Œæ›²ï¼ˆis_public = trueï¼‰
â””â”€ è‡ªå·±çš„ç§å¯†æ­Œæ›²ï¼ˆis_public = false, user_id = è‡ªå·±ï¼‰
```

## éœ€æ±‚

### ã€ç³»çµ± Aã€‘æ’­æ”¾æ¸…å–®éŸ³æ¨‚æ’­æ”¾å™¨éœ€æ±‚

### éœ€æ±‚ 1ï¼šéŸ³æ¨‚æ¨¡å¼ç€è¦½èˆ‡é¸æ“‡
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦ç€è¦½æ‰€æœ‰å¯ç”¨çš„éŸ³æ¨‚æ¨¡å¼ï¼Œä»¥ä¾¿é¸æ“‡ç¬¦åˆç•¶å‰å¿ƒæƒ…çš„èƒŒæ™¯éŸ³æ¨‚ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…é–‹å•Ÿæ’­æ”¾å™¨ä»‹é¢ THEN ç³»çµ± SHALL é¡¯ç¤ºæ‰€æœ‰å¯ç”¨çš„éŸ³æ¨‚æ¨¡å¼æ¸…å–®
2. WHERE éŸ³æ¨‚æ¨¡å¼æ¸…å–®ä¸­ THE ç³»çµ± SHALL åŒ…å«ä»¥ä¸‹æ¨¡å¼ï¼šsynthwaveã€divinationã€lofiã€ambient
3. WHEN ä½¿ç”¨è€…é»æ“ŠéŸ³æ¨‚æ¨¡å¼ THEN ç³»çµ± SHALL åœ¨ 500ms å…§é–‹å§‹æ’­æ”¾è©²æ¨¡å¼
4. IF éŸ³æ¨‚æ¨¡å¼æ­£åœ¨æ’­æ”¾ AND ä½¿ç”¨è€…é¸æ“‡æ–°æ¨¡å¼ THEN ç³»çµ± SHALL ä½¿ç”¨ 2 ç§’ crossfade å¹³æ»‘åˆ‡æ›
5. WHILE éŸ³æ¨‚æ¨¡å¼è¼‰å…¥ä¸­ THE ç³»çµ± SHALL é¡¯ç¤º Pip-Boy é¢¨æ ¼è¼‰å…¥å‹•ç•«
6. WHERE æ¯å€‹éŸ³æ¨‚æ¨¡å¼é …ç›®ä¸­ THE ç³»çµ± SHALL é¡¯ç¤ºæ¨¡å¼åç¨±ã€æè¿°å’Œè¦–è¦ºåŒ–åœ–ç¤º
7. WHEN ä½¿ç”¨è€… hover éŸ³æ¨‚æ¨¡å¼é …ç›® THEN ç³»çµ± SHALL é¡¯ç¤º Pip-Boy ç¶ è‰²ç™¼å…‰æ•ˆæœ

### éœ€æ±‚ 2ï¼šæ’­æ”¾æ§åˆ¶åŠŸèƒ½
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦å®Œæ•´çš„æ’­æ”¾æ§åˆ¶åŠŸèƒ½ï¼Œä»¥ä¾¿éš¨æ™‚ç®¡ç†éŸ³æ¨‚æ’­æ”¾ç‹€æ…‹ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…é»æ“Šæ’­æ”¾æŒ‰éˆ• THEN ç³»çµ± SHALL é–‹å§‹æ’­æ”¾ç•¶å‰é¸æ“‡çš„éŸ³æ¨‚æ¨¡å¼
2. WHEN ä½¿ç”¨è€…é»æ“Šæš«åœæŒ‰éˆ• THEN ç³»çµ± SHALL æš«åœéŸ³æ¨‚æ’­æ”¾ä¸¦ä¿ç•™æ’­æ”¾ä½ç½®
3. WHEN ä½¿ç”¨è€…é»æ“Šä¸Šä¸€é¦–æŒ‰éˆ• THEN ç³»çµ± SHALL åˆ‡æ›è‡³æ’­æ”¾æ¸…å–®ä¸­çš„ä¸Šä¸€å€‹éŸ³æ¨‚æ¨¡å¼
4. WHEN ä½¿ç”¨è€…é»æ“Šä¸‹ä¸€é¦–æŒ‰éˆ• THEN ç³»çµ± SHALL åˆ‡æ›è‡³æ’­æ”¾æ¸…å–®ä¸­çš„ä¸‹ä¸€å€‹éŸ³æ¨‚æ¨¡å¼
5. IF æ’­æ”¾æ¸…å–®è™•æ–¼å–®æ›²å¾ªç’°æ¨¡å¼ THEN ç³»çµ± SHALL é‡è¤‡æ’­æ”¾ç•¶å‰éŸ³æ¨‚æ¨¡å¼
6. IF æ’­æ”¾æ¸…å–®è™•æ–¼åˆ—è¡¨å¾ªç’°æ¨¡å¼ THEN ç³»çµ± SHALL åœ¨æ’­æ”¾å®Œæœ€å¾Œä¸€é¦–å¾Œå›åˆ°ç¬¬ä¸€é¦–
7. IF æ’­æ”¾æ¸…å–®è™•æ–¼éš¨æ©Ÿæ’­æ”¾æ¨¡å¼ THEN ç³»çµ± SHALL éš¨æ©Ÿé¸æ“‡ä¸‹ä¸€å€‹éŸ³æ¨‚æ¨¡å¼
8. WHEN éŸ³æ¨‚åˆ‡æ›ç™¼ç”Ÿ THEN ç³»çµ± SHALL æ’­æ”¾ pip-boy-beep éŸ³æ•ˆä»¥æä¾›åé¥‹
9. WHERE æ’­æ”¾æ§åˆ¶æŒ‰éˆ•å€åŸŸ THE ç³»çµ± SHALL ä½¿ç”¨ Pip-Boy ç¶ è‰²é‚Šæ¡†å’Œçµ‚ç«¯æ©Ÿå­—é«”

### éœ€æ±‚ 3ï¼šæ’­æ”¾æ¸…å–®ç®¡ç†ï¼ˆå·²æ£„ç”¨ - è¦‹éœ€æ±‚ 28ï¼‰âš ï¸
**ç‹€æ…‹**ï¼šæ­¤éœ€æ±‚å·²è¢«éœ€æ±‚ 28ï¼ˆPattern-Based æ’­æ”¾æ¸…å–®ç®¡ç†ï¼‰å–ä»£

**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦å»ºç«‹å’Œç®¡ç†è‡ªè¨‚æ’­æ”¾æ¸…å–®ï¼Œä»¥ä¾¿çµ„ç¹”æˆ‘å–œæ„›çš„éŸ³æ¨‚æ¨¡å¼ã€‚

#### é©—æ”¶æ¨™æº–ï¼ˆå·²æ£„ç”¨ï¼‰

1. ~~WHEN ä½¿ç”¨è€…é»æ“Šã€Œæ–°å¢æ’­æ”¾æ¸…å–®ã€æŒ‰éˆ• THEN ç³»çµ± SHALL é¡¯ç¤ºæ’­æ”¾æ¸…å–®å»ºç«‹å°è©±æ¡†~~
2. ~~WHEN ä½¿ç”¨è€…è¼¸å…¥æ’­æ”¾æ¸…å–®åç¨±ä¸¦ç¢ºèª THEN ç³»çµ± SHALL å»ºç«‹æ–°çš„ç©ºç™½æ’­æ”¾æ¸…å–®~~
3. ~~WHEN ä½¿ç”¨è€…å°‡éŸ³æ¨‚æ¨¡å¼æ‹–æ›³è‡³æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL å°‡è©²æ¨¡å¼æ–°å¢è‡³æ’­æ”¾æ¸…å–®~~
4. ~~WHEN ä½¿ç”¨è€…é»æ“Šæ’­æ”¾æ¸…å–®ä¸­çš„åˆªé™¤æŒ‰éˆ• THEN ç³»çµ± SHALL ç§»é™¤è©²éŸ³æ¨‚æ¨¡å¼~~
5. ~~WHEN ä½¿ç”¨è€…èª¿æ•´æ’­æ”¾æ¸…å–®ä¸­çš„éŸ³æ¨‚é †åº THEN ç³»çµ± SHALL ç«‹å³å„²å­˜æ–°é †åºè‡³ localStorage~~
6. ~~IF ä½¿ç”¨è€…æ“æœ‰å¤šå€‹æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL æä¾›æ’­æ”¾æ¸…å–®åˆ‡æ›åŠŸèƒ½~~
7. ~~WHERE æ’­æ”¾æ¸…å–®åç¨±è¼¸å…¥æ¬„ä½ THE ç³»çµ± SHALL é™åˆ¶é•·åº¦ç‚º 30 å€‹å­—å…ƒ~~
8. ~~WHEN ä½¿ç”¨è€…åˆªé™¤æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL é¡¯ç¤ºç¢ºèªå°è©±æ¡†ä»¥é˜²èª¤åˆª~~

> **é·ç§»èªªæ˜**ï¼šè«‹åƒè€ƒéœ€æ±‚ 28ï¼Œæ’­æ”¾æ¸…å–®ç¾åœ¨åŒ…å« Pattern å¼•ç”¨ï¼ˆä¾†è‡ª `user_rhythm_presets`ï¼‰ï¼Œè€ŒééŸ³æ¨‚æ¨¡å¼ã€‚

### éœ€æ±‚ 4ï¼šDrawer æ’­æ”¾å™¨ä»‹é¢è¨­è¨ˆ
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦ä¸€å€‹ç¬¦åˆ Fallout é¢¨æ ¼çš„ Drawer æ’­æ”¾å™¨ä»‹é¢ï¼Œä»¥ä¾¿ä¿æŒæ²‰æµ¸å¼é«”é©—ã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE æ’­æ”¾å™¨ä¸»ä»‹é¢ THE ç³»çµ± SHALL ä½¿ç”¨ shadcn/ui Drawer çµ„ä»¶å¯¦ç¾
2. WHEN ä½¿ç”¨è€…é»æ“Šæ’­æ”¾å™¨è§¸ç™¼æŒ‰éˆ• THEN ç³»çµ± SHALL å¾ç•«é¢åº•éƒ¨æ»‘å…¥ Drawer æ’­æ”¾å™¨
3. WHERE Drawer æ’­æ”¾å™¨ THE ç³»çµ± SHALL ä½¿ç”¨ Pip-Boy ç¶ è‰²ä¸»é¡Œï¼ˆ#00ff88ï¼‰
4. WHERE Drawer æ–‡å­—å…§å®¹ THE ç³»çµ± SHALL ä½¿ç”¨çµ‚ç«¯æ©Ÿé¢¨æ ¼å­—é«”ï¼ˆfont-monoï¼‰
5. WHEN Drawer é¡¯ç¤ºæ™‚ THEN ç³»çµ± SHALL åŒ…å« CRT æƒæç·šæ•ˆæœ
6. WHERE Drawer é‚Šæ¡† THE ç³»çµ± SHALL ä½¿ç”¨ 2px Pip-Boy ç¶ è‰²é‚Šæ¡†
7. WHERE æŒ‰éˆ•å’Œäº’å‹•å…ƒç´  THE ç³»çµ± SHALL å…·å‚™ç¶ è‰²ç™¼å…‰æ•ˆæœ
8. WHERE Drawer é«˜åº¦ THE ç³»çµ± SHALL ç‚ºè¢å¹•é«˜åº¦çš„ 60%ï¼ˆå¯æ‹–æ›³èª¿æ•´è‡³ 30%-90%ï¼‰
9. WHEN ä½¿ç”¨è€…å‘ä¸‹æ‹–æ›³ Drawer THE ç³»çµ± SHALL æœ€å°åŒ–ç‚ºåº•éƒ¨æµ®å‹•æ§åˆ¶æ¢
10. WHEN ä½¿ç”¨è€…é»æ“Šæµ®å‹•æ§åˆ¶æ¢ THE ç³»çµ± SHALL å±•é–‹å®Œæ•´ Drawer æ’­æ”¾å™¨
11. WHERE Drawer å‹•ç•« THE ç³»çµ± SHALL ä½¿ç”¨ 300ms ease-out æ»‘å…¥/æ»‘å‡ºæ•ˆæœ
12. WHEN ä½¿ç”¨è€…é»æ“Š Drawer å¤–éƒ¨å€åŸŸ OR æŒ‰ä¸‹ Esc éµ THEN ç³»çµ± SHALL æœ€å°åŒ–ç‚ºæµ®å‹•æ§åˆ¶æ¢
13. WHERE Drawer å…§å®¹ THE ç³»çµ± SHALL åŒ…å«ï¼šæ’­æ”¾æ§åˆ¶æŒ‰éˆ•ã€ç•¶å‰æ›²ç›®è³‡è¨Šã€é€²åº¦æ¢ã€éŸ³é‡æ§åˆ¶ã€æ’­æ”¾æ¸…å–®æŒ‰éˆ•

### éœ€æ±‚ 5ï¼šéŸ³é‡æ§åˆ¶æ•´åˆ
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦åœ¨æ’­æ”¾å™¨ä¸­ç›´æ¥æ§åˆ¶éŸ³é‡ï¼Œä»¥ä¾¿å¿«é€Ÿèª¿æ•´éŸ³æ¨‚å¤§å°ã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE æ’­æ”¾å™¨ä»‹é¢ THE ç³»çµ± SHALL æ•´åˆç¾æœ‰ VolumeControl çµ„ä»¶
2. WHEN ä½¿ç”¨è€…èª¿æ•´éŸ³æ¨‚éŸ³é‡æ»‘æ¡¿ THEN ç³»çµ± SHALL å³æ™‚æ›´æ–° audioStore ä¸­çš„ music éŸ³é‡
3. WHEN ä½¿ç”¨è€…é»æ“ŠéœéŸ³æŒ‰éˆ• THEN ç³»çµ± SHALL åˆ‡æ›éŸ³æ¨‚éœéŸ³ç‹€æ…‹
4. IF éŸ³æ¨‚éŸ³é‡ç‚º 0 THEN ç³»çµ± SHALL è‡ªå‹•åˆ‡æ›éœéŸ³åœ–ç¤ºç‚º VolumeX
5. IF éŸ³æ¨‚éŸ³é‡ > 0 AND < 50 THEN ç³»çµ± SHALL é¡¯ç¤º Volume1 åœ–ç¤º
6. IF éŸ³æ¨‚éŸ³é‡ >= 50 THEN ç³»çµ± SHALL é¡¯ç¤º Volume2 åœ–ç¤º
7. WHERE éŸ³é‡æ»‘æ¡¿ THE ç³»çµ± SHALL ä½¿ç”¨ Pip-Boy é¢¨æ ¼è¨­è¨ˆï¼ˆç¶ è‰²è»Œé“å’ŒæŠŠæ‰‹ï¼‰
8. WHEN éŸ³é‡è®Šæ›´ç™¼ç”Ÿ THEN ç³»çµ± SHALL å„²å­˜è‡³ localStorage ä»¥ä¿æŒæŒä¹…åŒ–

### éœ€æ±‚ 6ï¼šç‹€æ…‹æŒä¹…åŒ–
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦ç³»çµ±è¨˜ä½æˆ‘çš„éŸ³æ¨‚åå¥½ï¼Œä»¥ä¾¿ä¸‹æ¬¡è¨ªå•æ™‚ç¹¼çºŒä½¿ç”¨ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…é¸æ“‡éŸ³æ¨‚æ¨¡å¼ THEN ç³»çµ± SHALL å„²å­˜è‡³ localStorageï¼ˆéµï¼šwasteland-tarot-audioï¼‰
2. WHEN ä½¿ç”¨è€…å»ºç«‹æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL å„²å­˜è‡³ localStorage
3. WHEN ä½¿ç”¨è€…èª¿æ•´å¾ªç’°æ¨¡å¼ THEN ç³»çµ± SHALL å„²å­˜è¨­å®šè‡³ localStorage
4. WHEN ä½¿ç”¨è€…èª¿æ•´éŸ³é‡ THEN ç³»çµ± SHALL é€é audioStore å„²å­˜è‡³ localStorage
5. WHEN ä½¿ç”¨è€…é‡æ–°è¼‰å…¥é é¢ THEN ç³»çµ± SHALL æ¢å¾©ä¸Šæ¬¡çš„æ’­æ”¾ç‹€æ…‹
6. IF localStorage è³‡æ–™æå£ THEN ç³»çµ± SHALL ä½¿ç”¨é è¨­è¨­å®šï¼ˆsynthwave æ¨¡å¼ï¼‰
7. WHERE localStorage è³‡æ–™çµæ§‹ THE ç³»çµ± SHALL åŒ…å«ç‰ˆæœ¬è™Ÿä»¥æ”¯æ´æœªä¾†è³‡æ–™é·ç§»
8. WHEN ä½¿ç”¨è€…æ¸…é™¤ç€è¦½å™¨è³‡æ–™ THEN ç³»çµ± SHALL é¡¯ç¤ºæç¤ºè¨Šæ¯ä¸¦é‡ç½®ç‚ºé è¨­è¨­å®š

### éœ€æ±‚ 7ï¼šéµç›¤å°èˆª
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦ä½¿ç”¨éµç›¤æ§åˆ¶æ’­æ”¾å™¨ï¼Œä»¥ä¾¿æé«˜æ“ä½œæ•ˆç‡ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…æŒ‰ä¸‹ç©ºç™½éµ THEN ç³»çµ± SHALL åˆ‡æ›æ’­æ”¾/æš«åœç‹€æ…‹
2. WHEN ä½¿ç”¨è€…æŒ‰ä¸‹å·¦æ–¹å‘éµ THEN ç³»çµ± SHALL åˆ‡æ›è‡³ä¸Šä¸€é¦–
3. WHEN ä½¿ç”¨è€…æŒ‰ä¸‹å³æ–¹å‘éµ THEN ç³»çµ± SHALL åˆ‡æ›è‡³ä¸‹ä¸€é¦–
4. WHEN ä½¿ç”¨è€…æŒ‰ä¸‹ M éµ THEN ç³»çµ± SHALL åˆ‡æ›éœéŸ³ç‹€æ…‹
5. WHEN ä½¿ç”¨è€…æŒ‰ä¸‹ L éµ THEN ç³»çµ± SHALL åˆ‡æ›å¾ªç’°æ¨¡å¼
6. WHEN ä½¿ç”¨è€…æŒ‰ä¸‹ Esc éµ THEN ç³»çµ± SHALL æ”¶åˆæ’­æ”¾å™¨
7. WHERE éµç›¤å¿«æ·éµ THE ç³»çµ± SHALL åƒ…åœ¨æ’­æ”¾å™¨ç²å¾—ç„¦é»æ™‚ç”Ÿæ•ˆ
8. WHEN ä½¿ç”¨è€…ä½¿ç”¨ Tab éµå°èˆª THEN ç³»çµ± SHALL é¡¯ç¤ºæ¸…æ™°çš„ç„¦é»æŒ‡ç¤ºï¼ˆç¶ è‰²å¤–æ¡†ï¼‰

### éœ€æ±‚ 8ï¼šæ•ˆèƒ½è¦æ±‚
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦æ’­æ”¾å™¨å¿«é€ŸéŸ¿æ‡‰ï¼Œä»¥ä¾¿æµæš¢ä½¿ç”¨ç³»çµ±ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…åˆ‡æ›éŸ³æ¨‚æ¨¡å¼ THEN ç³»çµ± SHALL åœ¨ 500ms å…§é–‹å§‹æ’­æ”¾
2. WHERE è¨˜æ†¶é«”ä½¿ç”¨ THE ç³»çµ± SHALL ä¸è¶…éç¾æœ‰éŸ³è¨Šç³»çµ±é™åˆ¶ï¼ˆ50MBï¼‰
3. WHEN æ’­æ”¾å™¨ä»‹é¢æ¸²æŸ“æ™‚ THEN ç³»çµ± SHALL åœ¨ 100ms å…§å®Œæˆé¦–æ¬¡ç¹ªè£½
4. IF éŸ³æ¨‚æ¨¡å¼åˆ‡æ›ä¸­ AND ä½¿ç”¨è€…å†æ¬¡é»æ“Š THEN ç³»çµ± SHALL å–æ¶ˆå‰æ¬¡åˆ‡æ›ä¸¦åŸ·è¡Œæ–°åˆ‡æ›
5. WHERE ProceduralMusicEngine ç”Ÿæˆ THE ç³»çµ± SHALL ä½¿ç”¨ Web Audio API é™ä½ CPU ä½¿ç”¨
6. WHEN æ’­æ”¾å™¨æœ€å°åŒ–æ™‚ THEN ç³»çµ± SHALL é‡‹æ”¾ä¸å¿…è¦çš„ DOM å…ƒç´ ä»¥ç¯€çœè¨˜æ†¶é«”
7. IF FPS ä½æ–¼ 30 THEN ç³»çµ± SHALL é™ç´šå‹•ç•«æ•ˆæœä»¥ç¶­æŒæµæš¢åº¦
8. WHERE éŸ³æ¨‚åˆ‡æ›éæ¸¡ THE ç³»çµ± SHALL ä½¿ç”¨ 2 ç§’ crossfade ä»¥é¿å…çªå…€æ„Ÿ

### éœ€æ±‚ 9ï¼šç„¡éšœç¤™æ”¯æ´
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºä½¿ç”¨è¼”åŠ©æŠ€è¡“çš„å»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦æ’­æ”¾å™¨æ”¯æ´è¢å¹•é–±è®€å™¨ï¼Œä»¥ä¾¿å¹³ç­‰ä½¿ç”¨éŸ³æ¨‚åŠŸèƒ½ã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE æ’­æ”¾å™¨ä¸»å®¹å™¨ THE ç³»çµ± SHALL å…·å‚™ role="region" å’Œ aria-label="éŸ³æ¨‚æ’­æ”¾å™¨"
2. WHERE æ’­æ”¾æŒ‰éˆ• THE ç³»çµ± SHALL å…·å‚™ aria-label="æ’­æ”¾" æˆ– "æš«åœ"ï¼ˆæ ¹æ“šç‹€æ…‹ï¼‰
3. WHERE éŸ³æ¨‚æ¨¡å¼é¸é … THE ç³»çµ± SHALL å…·å‚™ role="radio" å’Œ aria-checked å±¬æ€§
4. WHEN éŸ³æ¨‚æ¨¡å¼è®Šæ›´ THEN ç³»çµ± SHALL é€é aria-live="polite" é€šçŸ¥è¢å¹•é–±è®€å™¨
5. WHERE éŸ³é‡æ»‘æ¡¿ THE ç³»çµ± SHALL å…·å‚™ role="slider" å’Œ aria-valuenow å±¬æ€§
6. IF ä½¿ç”¨è€…å•Ÿç”¨ prefers-reduced-motion THEN ç³»çµ± SHALL åœç”¨æ‰€æœ‰å‹•ç•«æ•ˆæœ
7. WHERE æ‰€æœ‰äº’å‹•å…ƒç´  THE ç³»çµ± SHALL å…·å‚™æ˜ç¢ºçš„ aria-label
8. WHEN ä½¿ç”¨è€…ä½¿ç”¨éµç›¤å°èˆª THEN ç³»çµ± SHALL é¡¯ç¤ºæ¸…æ™°çš„ç„¦é»æŒ‡ç¤º

### éœ€æ±‚ 10ï¼šéŒ¯èª¤è™•ç†
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦ç³»çµ±å„ªé›…è™•ç†éŒ¯èª¤ï¼Œä»¥ä¾¿åœ¨å•é¡Œç™¼ç”Ÿæ™‚ä»èƒ½ç¹¼çºŒä½¿ç”¨ã€‚

#### é©—æ”¶æ¨™æº–

1. IF ProceduralMusicEngine åˆå§‹åŒ–å¤±æ•— THEN ç³»çµ± SHALL é¡¯ç¤º Pip-Boy é¢¨æ ¼éŒ¯èª¤è¨Šæ¯
2. IF éŸ³æ¨‚æ¨¡å¼è¼‰å…¥å¤±æ•— THEN ç³»çµ± SHALL è‡ªå‹•é‡è©¦ 3 æ¬¡ï¼ˆæ ¹æ“š MAX_LOAD_RETRIESï¼‰
3. IF é‡è©¦ 3 æ¬¡å¾Œä»å¤±æ•— THEN ç³»çµ± SHALL å›é€€è‡³é è¨­ synthwave æ¨¡å¼
4. WHERE éŒ¯èª¤ç‡ THE ç³»çµ± SHALL ç›£æ§ä¸¦åœ¨è¶…é 30% æ™‚åœç”¨éŸ³æ¨‚åŠŸèƒ½ï¼ˆERROR_RATE_THRESHOLDï¼‰
5. WHEN localStorage å¯«å…¥å¤±æ•— THEN ç³»çµ± SHALL è¨˜éŒ„éŒ¯èª¤ä¸¦ç¹¼çºŒé‹ä½œï¼ˆä¸ä¸­æ–·ä½¿ç”¨è€…ï¼‰
6. IF AudioContext è¢«ç€è¦½å™¨æš«åœ THEN ç³»çµ± SHALL é¡¯ç¤ºæç¤ºè¦æ±‚ä½¿ç”¨è€…äº’å‹•ä»¥æ¢å¾©
7. WHERE éŒ¯èª¤è¨Šæ¯ THE ç³»çµ± SHALL ä½¿ç”¨ Pip-Boy ç¶ è‰²æ–‡å­—å’Œçµ‚ç«¯æ©Ÿé¢¨æ ¼
8. WHEN åš´é‡éŒ¯èª¤ç™¼ç”Ÿ THEN ç³»çµ± SHALL æä¾›ã€Œé‡ç½®æ’­æ”¾å™¨ã€æŒ‰éˆ•ä»¥æ¢å¾©é è¨­ç‹€æ…‹

### éœ€æ±‚ 11ï¼šç§»é™¤è‡ªå‹•å ´æ™¯éŸ³æ¨‚ç³»çµ±
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦éŸ³æ¨‚å®Œå…¨ç”±æˆ‘æ§åˆ¶ï¼Œè€Œä¸æ˜¯ç³»çµ±è‡ªå‹•æ ¹æ“šé é¢æ’­æ”¾ï¼Œä»¥ä¾¿æ“æœ‰å®Œæ•´çš„è‡ªä¸»æ¬Šã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…é€²å…¥ä»»ä½•é é¢ THEN ç³»çµ± SHALL NOT è‡ªå‹•é–‹å§‹æ’­æ”¾éŸ³æ¨‚
2. WHERE ç¾æœ‰å ´æ™¯éŸ³æ¨‚é‚è¼¯ï¼ˆSCENE_MUSIC_MAPï¼‰ THE ç³»çµ± SHALL å®Œå…¨ç§»é™¤æˆ–åœç”¨
3. WHEN ä½¿ç”¨è€…åˆ‡æ›é é¢ THEN ç³»çµ± SHALL ä¿æŒç•¶å‰æ’­æ”¾ç‹€æ…‹ï¼ˆä¸è‡ªå‹•åˆ‡æ›éŸ³æ¨‚ï¼‰
4. IF ä½¿ç”¨è€…æ­£åœ¨æ’­æ”¾éŸ³æ¨‚ AND åˆ‡æ›é é¢ THEN ç³»çµ± SHALL ç¹¼çºŒæ’­æ”¾ç•¶å‰éŸ³æ¨‚
5. WHERE MusicGenerator ä¸­çš„å ´æ™¯éŸ³æ¨‚è‡ªå‹•æ’­æ”¾é‚è¼¯ THE ç³»çµ± SHALL ç§»é™¤æˆ–è¨»è§£
6. WHEN ä½¿ç”¨è€…é¦–æ¬¡è¨ªå•ç¶²ç«™ THEN ç³»çµ± SHALL é¡¯ç¤ºéœéŸ³ç‹€æ…‹ï¼ˆç„¡éŸ³æ¨‚æ’­æ”¾ï¼‰
7. WHERE audioStore åˆå§‹åŒ– THE ç³»çµ± SHALL è¨­å®š isPlaying.music ç‚º false
8. WHEN ç³»çµ±å•Ÿå‹•æ™‚ THEN ç³»çµ± SHALL NOT å‘¼å«ä»»ä½•è‡ªå‹•æ’­æ”¾éŸ³æ¨‚çš„å‡½æ•¸

### éœ€æ±‚ 12ï¼šSheet å½ˆçª—æ’­æ”¾æ¸…å–®ä»‹é¢
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦éš¨æ™‚é–‹å•Ÿæ’­æ”¾æ¸…å–®å½ˆçª—ï¼Œä»¥ä¾¿å¿«é€Ÿç€è¦½å’Œç®¡ç†æˆ‘çš„éŸ³æ¨‚æ’­æ”¾æ¸…å–®ã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE æ’­æ”¾æ¸…å–®å½ˆçª—ä»‹é¢ THE ç³»çµ± SHALL ä½¿ç”¨ shadcn/ui Sheet çµ„ä»¶å¯¦ç¾ï¼ˆæ¡Œé¢å’Œè¡Œå‹•è£ç½®é€šç”¨ï¼‰
2. WHEN ä½¿ç”¨è€…é»æ“Š Drawer æ’­æ”¾å™¨ä¸­çš„ã€Œæ’­æ”¾æ¸…å–®ã€æŒ‰éˆ• THEN ç³»çµ± SHALL å¾è¢å¹•å³å´æ»‘å…¥ Sheet å½ˆçª—
3. WHERE Sheet å½ˆçª—å¯¬åº¦ THE ç³»çµ± SHALL åœ¨è¡Œå‹•è£ç½®ï¼ˆ< 768pxï¼‰ç‚ºè¢å¹•å¯¬åº¦çš„ 90%ï¼Œæ¡Œé¢ï¼ˆ>= 768pxï¼‰ç‚ºå›ºå®š 400px
4. WHEN Sheet å½ˆçª—é–‹å•Ÿæ™‚ THEN ç³»çµ± SHALL é¡¯ç¤ºå®Œæ•´æ’­æ”¾æ¸…å–®å…§å®¹å’ŒéŸ³æ¨‚æ¨¡å¼ç€è¦½å™¨
5. WHERE Sheet å½ˆçª—å…§å®¹å€å¡Š THE ç³»çµ± SHALL åŒ…å«ï¼š
   - éŸ³æ¨‚æ¨¡å¼ç€è¦½å™¨ï¼ˆsynthwaveã€divinationã€lofiã€ambient å››ç¨®æ¨¡å¼ï¼‰
   - ç•¶å‰æ’­æ”¾æ¸…å–®é¡¯ç¤ºï¼ˆå¯æ²å‹•ï¼‰
   - æ’­æ”¾æ¸…å–®ç®¡ç†æŒ‰éˆ•ï¼ˆæ–°å¢æ’­æ”¾æ¸…å–®ã€åˆªé™¤ã€é‡æ–°å‘½åï¼‰
   - æ¯å€‹éŸ³æ¨‚æ¨¡å¼çš„æ’­æ”¾æŒ‰éˆ•å’Œè³‡è¨Š
6. WHEN ä½¿ç”¨è€…åœ¨ Sheet ä¸­é»æ“ŠéŸ³æ¨‚æ¨¡å¼ THEN ç³»çµ± SHALL ç«‹å³é–‹å§‹æ’­æ”¾è©²æ¨¡å¼
7. WHEN ä½¿ç”¨è€…é»æ“Š Sheet å¤–éƒ¨å€åŸŸ OR æŒ‰ä¸‹ Esc éµ THEN ç³»çµ± SHALL é—œé–‰ Sheet å½ˆçª—
8. WHERE Sheet æ¨£å¼ THE ç³»çµ± SHALL ä½¿ç”¨ Pip-Boy ç¶ è‰²ä¸»é¡Œï¼ˆ#00ff88ï¼‰å’Œçµ‚ç«¯æ©Ÿå­—é«”ï¼ˆfont-monoï¼‰
9. WHERE Sheet å‹•ç•« THE ç³»çµ± SHALL ä½¿ç”¨ 300ms ease-out æ»‘å…¥/æ»‘å‡ºæ•ˆæœ
10. WHEN Sheet é–‹å•Ÿæ™‚ THEN ç³»çµ± SHALL æ’­æ”¾ pip-boy-beep éŸ³æ•ˆä»¥æä¾›åé¥‹
11. WHERE Sheet èƒŒæ™¯é®ç½© THE ç³»çµ± SHALL ä½¿ç”¨åŠé€æ˜é»‘è‰²ï¼ˆrgba(0, 0, 0, 0.8)ï¼‰
12. WHEN ä½¿ç”¨è€…å°‡éŸ³æ¨‚æ¨¡å¼æ‹–æ›³è‡³æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL åœ¨ Sheet å…§å³æ™‚æ›´æ–°æ’­æ”¾æ¸…å–®é †åº
13. WHERE Sheet æ¨™é¡Œåˆ— THE ç³»çµ± SHALL åŒ…å«ã€Œæ’­æ”¾æ¸…å–®ã€æ¨™é¡Œå’Œé—œé–‰æŒ‰éˆ•ï¼ˆXï¼‰
14. WHEN Sheet å…§å®¹è¶…å‡ºå¯è¦–å€åŸŸ THEN ç³»çµ± SHALL æä¾›ç¬¦åˆç¶²ç«™é¢¨æ ¼çš„è‡ªè¨‚æ²è»¸ï¼ˆç¶ è‰² thumbï¼‰

### ã€ç³»çµ± Bã€‘ç¯€å¥ç·¨è¼¯å™¨éœ€æ±‚ â­ æ–°å¢

### éœ€æ±‚ 20ï¼šç¨ç«‹ç¯€å¥ç·¨è¼¯å™¨é é¢è·¯ç”±èˆ‡è¨ªå•æ§åˆ¶
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ç™»å…¥ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦è¨ªå•ç¨ç«‹çš„ç¯€å¥ç·¨è¼¯å™¨é é¢ï¼Œä»¥ä¾¿å‰µå»ºå’Œç·¨è¼¯è‡ªè¨‚ç¯€å¥ patternã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE ç¯€å¥ç·¨è¼¯å™¨è·¯ç”± THE ç³»çµ± SHALL å»ºç«‹ `/dashboard/rhythm-editor` é é¢è·¯ç”±
2. WHEN æœªç™»å…¥ä½¿ç”¨è€…å˜—è©¦è¨ªå• `/dashboard/rhythm-editor` THEN ç³»çµ± SHALL é‡å°å‘è‡³ç™»å…¥é é¢
3. WHERE å­˜å–æ§åˆ¶ THE ç³»çµ± SHALL ä½¿ç”¨ç¾æœ‰ auth middleware ä¿è­·è·¯ç”±ï¼ˆé©—è­‰ Supabase sessionï¼‰
4. WHEN ç™»å…¥ä½¿ç”¨è€…è¨ªå• `/dashboard/rhythm-editor` THEN ç³»çµ± SHALL åœ¨ 200ms å…§è¼‰å…¥ç·¨è¼¯å™¨ä»‹é¢
5. WHERE é é¢ä½ˆå±€ THE ç³»çµ± SHALL ä½¿ç”¨å®Œæ•´é é¢ä½ˆå±€ï¼ˆé Drawer æˆ– Modalï¼‰
6. WHERE è¨­è¨ˆé¢¨æ ¼ THE ç³»çµ± SHALL ä½¿ç”¨ Fallout Pip-Boy ç¾å­¸ï¼ˆCubic 11 å­—é«”ã€#00ff88 ä¸»è‰²ã€CRT æ•ˆæœï¼‰
7. WHERE éŸ¿æ‡‰å¼æ”¯æ´ THE ç³»çµ± SHALL æ”¯æ´æ¡Œé¢ï¼ˆ>= 768pxï¼‰å’Œæ‰‹æ©Ÿï¼ˆ< 768pxï¼‰ä½ˆå±€
8. WHEN ä½¿ç”¨è€… session éæœŸ THEN ç³»çµ± SHALL é¡¯ç¤ºã€ŒSession å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥ã€ä¸¦é‡å°å‘è‡³ç™»å…¥é 

### éœ€æ±‚ 21ï¼š16 æ­¥é©ŸéŸ³åºå™¨ UI
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ç™»å…¥ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦ä½¿ç”¨ 16 æ­¥é©ŸéŸ³åºå™¨å‰µå»ºç¯€å¥ patternï¼Œä»¥ä¾¿ç²¾ç¢ºæ§åˆ¶æ¯å€‹æ¨‚å™¨çš„ç¯€å¥ã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE éŸ³åºå™¨è»Œé“ THE ç³»çµ± SHALL é¡¯ç¤º 5 å€‹æ¨‚å™¨è»Œé“ï¼šKickã€Snareã€HiHatã€OpenHatã€Clap
2. WHERE æ­¥é©Ÿç¶²æ ¼ THE ç³»çµ± SHALL ç‚ºæ¯å€‹è»Œé“é¡¯ç¤º 16 å€‹æ­¥é©ŸæŒ‰éˆ•ï¼ˆ5 Ã— 16 ç¶²æ ¼ï¼‰
3. WHEN ä½¿ç”¨è€…é»æ“Šæ­¥é©Ÿæ ¼å­ THEN ç³»çµ± SHALL åˆ‡æ›è©²æ ¼å­çš„å•Ÿç”¨/åœç”¨ç‹€æ…‹ï¼ˆè¦–è¦ºåè½‰ï¼‰
4. WHERE æ­¥é©Ÿå•Ÿç”¨ç‹€æ…‹ THE ç³»çµ± SHALL ä½¿ç”¨ Pip-Boy ç¶ è‰²ï¼ˆ#00ff88ï¼‰è¡¨ç¤ºå•Ÿç”¨ï¼Œæ·±ç°è‰²è¡¨ç¤ºåœç”¨
5. WHERE è¦–è¦ºåˆ†çµ„ THE ç³»çµ± SHALL æ¯ 4 æ­¥é©Ÿé¡¯ç¤ºè¦–è¦ºåˆ†éš”ç·šï¼ˆæ¨¡ä»¿å‚³çµ±éŸ³åºå™¨ï¼‰
6. WHEN éŸ³åºå™¨æ’­æ”¾æ™‚ THEN ç³»çµ± SHALL é«˜äº®ç•¶å‰æ­¥é©Ÿåˆ—ï¼ˆä½¿ç”¨è„ˆè¡å‹•ç•«ï¼‰
7. WHERE è»Œé“æ¨™ç±¤ THE ç³»çµ± SHALL åœ¨æ¯å€‹è»Œé“å·¦å´é¡¯ç¤ºæ¨‚å™¨åç¨±ï¼ˆKickã€Snareã€HiHatã€OpenHatã€Clapï¼‰
8. WHERE Pattern è³‡æ–™çµæ§‹ THE ç³»çµ± SHALL ä½¿ç”¨ä»¥ä¸‹ TypeScript ä»‹é¢ï¼š
   ```typescript
   type InstrumentTrack = 'kick' | 'snare' | 'hihat' | 'openhat' | 'clap';
   type Pattern = {
     kick: boolean[];    // 16 æ­¥é©Ÿ
     snare: boolean[];   // 16 æ­¥é©Ÿ
     hihat: boolean[];   // 16 æ­¥é©Ÿ
     openhat: boolean[]; // 16 æ­¥é©Ÿ
     clap: boolean[];    // 16 æ­¥é©Ÿ
   };
   ```
9. WHERE éŸ¿æ‡‰å¼ä½ˆå±€ THE ç³»çµ± SHALL åœ¨æ‰‹æ©Ÿä¸Šæä¾›æ©«å‘æ²å‹•ç¶²æ ¼ + å‚ç›´å †ç–Šæ§åˆ¶é …

### éœ€æ±‚ 22ï¼šå‚³è¼¸æ§åˆ¶èˆ‡ Tempo èª¿æ•´
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ç™»å…¥ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦æ§åˆ¶éŸ³åºå™¨çš„æ’­æ”¾ç‹€æ…‹å’Œé€Ÿåº¦ï¼Œä»¥ä¾¿å³æ™‚èª¿æ•´ç¯€å¥æ•ˆæœã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE å‚³è¼¸æ§åˆ¶æŒ‰éˆ• THE ç³»çµ± SHALL æä¾› Play/Pauseï¼ˆåˆ‡æ›ï¼‰ã€Stopã€Clear æŒ‰éˆ•
2. WHEN ä½¿ç”¨è€…é»æ“Š Play/Pause æŒ‰éˆ• THEN ç³»çµ± SHALL åˆ‡æ›æ’­æ”¾ç‹€æ…‹ï¼ˆæ’­æ”¾ â†” æš«åœï¼‰
3. WHEN ä½¿ç”¨è€…é»æ“Š Stop æŒ‰éˆ• THEN ç³»çµ± SHALL åœæ­¢æ’­æ”¾ä¸¦é‡ç½®æ’­æ”¾é ­è‡³æ­¥é©Ÿ 0
4. WHEN ä½¿ç”¨è€…é»æ“Š Clear æŒ‰éˆ• THEN ç³»çµ± SHALL æ¸…ç©ºæ‰€æœ‰è»Œé“çš„æ‰€æœ‰æ­¥é©Ÿï¼ˆé¡¯ç¤ºç¢ºèªå°è©±æ¡†ï¼‰
5. WHERE Tempo æ§åˆ¶ THE ç³»çµ± SHALL æä¾›æ»‘æ¡¿æ§åˆ¶ BPM ç¯„åœ 60-180
6. WHEN ä½¿ç”¨è€…èª¿æ•´ Tempo æ»‘æ¡¿ THEN ç³»çµ± SHALL å³æ™‚é¡¯ç¤ºç•¶å‰ BPM æ•¸å€¼
7. WHEN Tempo èª¿æ•´æ™‚ AND éŸ³åºå™¨æ­£åœ¨æ’­æ”¾ THEN ç³»çµ± SHALL ç«‹å³èª¿æ•´æ’­æ”¾é€Ÿåº¦ï¼ˆç„¡å»¶é²ï¼‰
8. WHERE Tempo é è¨­å€¼ THE ç³»çµ± SHALL è¨­å®šåˆå§‹ BPM ç‚º 120
9. WHERE æŒ‰éˆ•æ¨£å¼ THE ç³»çµ± SHALL ä½¿ç”¨ Pip-Boy ç¶ è‰²é‚Šæ¡†å’Œç™¼å…‰æ•ˆæœï¼ˆæ¨¡ä»¿ sample.htmlï¼‰

### éœ€æ±‚ 23ï¼šAI ç¯€å¥ç”ŸæˆåŠŸèƒ½ï¼ˆéœ€ç™»å…¥ï¼‰
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ç™»å…¥ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦ä½¿ç”¨ AI ç”Ÿæˆç¯€å¥ patternï¼Œä»¥ä¾¿å¿«é€Ÿç²å¾—å‰µæ„éˆæ„Ÿã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE AI ç”Ÿæˆä»‹é¢ THE ç³»çµ± SHALL æä¾›æ–‡å­—è¼¸å…¥æ¡†ï¼ˆæè¿°ç¯€å¥é¢¨æ ¼ï¼Œæœ€å¤š 200 å­—å…ƒï¼‰
2. WHERE å¿«é€Ÿé—œéµå­—æŒ‰éˆ• THE ç³»çµ± SHALL æä¾›é è¨­æŒ‰éˆ•ï¼š808 Cowbellã€Glitchã€Jazz Fusionã€Afrobeatã€Lo-Fiã€Stadium Rockã€Ambient
3. WHEN ä½¿ç”¨è€…é»æ“Šå¿«é€Ÿé—œéµå­—æŒ‰éˆ• THEN ç³»çµ± SHALL è‡ªå‹•å¡«å…¥å°æ‡‰é—œéµå­—è‡³è¼¸å…¥æ¡†
4. WHEN ä½¿ç”¨è€…é»æ“Šã€Œç”Ÿæˆç¯€å¥ã€æŒ‰éˆ• THEN ç³»çµ± SHALL é¡¯ç¤º Pip-Boy é¢¨æ ¼è¼‰å…¥å‹•ç•«ï¼ˆæ—‹è½‰åœ–ç¤º + "GENERATING RHYTHM..." æ–‡å­—ï¼‰
5. WHERE AI Provider æ•´åˆ THE ç³»çµ± SHALL ä½¿ç”¨ç¾æœ‰ AI provider ç³»çµ±ï¼ˆOpenAI/Geminiï¼‰
6. WHERE API Endpoint THE ç³»çµ± SHALL å‘¼å« `POST /api/v1/music/generate-rhythm`
7. WHERE Request Body THE ç³»çµ± SHALL å‚³é€ `{ prompt: string, userId: string }`
8. WHERE Response THE ç³»çµ± SHALL æ¥æ”¶ `{ pattern: Pattern, presetName?: string, quotaRemaining: number }`
9. WHEN AI ç”ŸæˆæˆåŠŸ THEN ç³»çµ± SHALL åœ¨ 3 ç§’å…§å¥—ç”¨ pattern è‡³éŸ³åºå™¨ç¶²æ ¼
10. IF AI ç”Ÿæˆå¤±æ•— THEN ç³»çµ± SHALL é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ã€ŒAI ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦ã€ä¸¦ä¿æŒåŸ pattern
11. WHERE é…é¡é™åˆ¶æ•´åˆ THE ç³»çµ± SHALL æ•´åˆ `user_ai_quotas` è¡¨ï¼ˆæ¯æ—¥ç”Ÿæˆæ¬¡æ•¸é™åˆ¶ï¼‰
12. WHEN ä½¿ç”¨è€…é”åˆ°é…é¡ä¸Šé™ THEN ç³»çµ± SHALL é¡¯ç¤ºã€Œä»Šæ—¥é…é¡å·²ç”¨å®Œï¼ˆ20/20ï¼‰ï¼Œæ˜æ—¥é‡ç½®ã€ä¸¦åœç”¨ç”ŸæˆæŒ‰éˆ•
13. WHERE é…é¡é¡¯ç¤º THE ç³»çµ± SHALL åœ¨ AI ç”Ÿæˆå€å¡Šé¡¯ç¤ºå‰©é¤˜é…é¡ï¼ˆä¾‹å¦‚ï¼š15/20 remainingï¼‰

### éœ€æ±‚ 24ï¼šPreset ç³»çµ±ï¼ˆé è¨­ + ä½¿ç”¨è€…è‡ªè¨‚ï¼‰
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ç™»å…¥ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦è¼‰å…¥é è¨­ preset å’Œå„²å­˜è‡ªå·±çš„ presetï¼Œä»¥ä¾¿å¿«é€Ÿåˆ‡æ›ä¸åŒç¯€å¥é¢¨æ ¼ã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE é è¨­ Preset THE ç³»çµ± SHALL æä¾›ä»¥ä¸‹ 5 å€‹é è¨­ presetï¼ˆä¾†è‡ª sample.htmlï¼‰ï¼š
   - Techno
   - House
   - Trap
   - Breakbeat
   - Minimal
2. WHEN ä½¿ç”¨è€…é»æ“Šé è¨­ Preset æŒ‰éˆ• THEN ç³»çµ± SHALL åœ¨ 200ms å…§è¼‰å…¥å°æ‡‰ pattern è‡³éŸ³åºå™¨
3. WHERE Preset æŒ‰éˆ•æ¨£å¼ THE ç³»çµ± SHALL ä½¿ç”¨ Pip-Boy ç¶ è‰²é‚Šæ¡†ï¼Œå•Ÿç”¨æ™‚èƒŒæ™¯å¡«æ»¿ç¶ è‰²
4. WHEN ä½¿ç”¨è€…é»æ“Šã€Œå„²å­˜ Presetã€æŒ‰éˆ• THEN ç³»çµ± SHALL é¡¯ç¤ºå‘½åå°è©±æ¡†ï¼ˆæœ€å¤š 30 å­—å…ƒï¼‰
5. WHEN ä½¿ç”¨è€…è¼¸å…¥ Preset åç¨±ä¸¦ç¢ºèª THEN ç³»çµ± SHALL å„²å­˜ç•¶å‰ pattern è‡³ `user_rhythm_presets` è¡¨
6. WHERE è³‡æ–™åº«å„²å­˜ THE ç³»çµ± SHALL ä½¿ç”¨ä»¥ä¸‹æ¬„ä½ï¼š
   - `id`ï¼šUUID
   - `user_id`ï¼šUUIDï¼ˆFK è‡³ auth.usersï¼‰
   - `name`ï¼šTEXTï¼ˆPreset åç¨±ï¼‰
   - `pattern`ï¼šJSONBï¼ˆPattern è³‡æ–™ï¼‰
   - `created_at`ï¼šTIMESTAMP
   - `updated_at`ï¼šTIMESTAMP
7. WHERE ä½¿ç”¨è€… Preset åˆ—è¡¨ THE ç³»çµ± SHALL é¡¯ç¤ºä½¿ç”¨è€…å„²å­˜çš„æ‰€æœ‰ presetï¼ˆæ²å‹•åˆ—è¡¨ï¼‰
8. WHEN ä½¿ç”¨è€…é»æ“Šè‡ªè¨‚ Preset THEN ç³»çµ± SHALL è¼‰å…¥å°æ‡‰ pattern è‡³éŸ³åºå™¨
9. WHEN ä½¿ç”¨è€…é»æ“Šè‡ªè¨‚ Preset çš„åˆªé™¤æŒ‰éˆ• THEN ç³»çµ± SHALL é¡¯ç¤ºç¢ºèªå°è©±æ¡†ä¸¦åˆªé™¤è©² preset
10. WHERE Preset æ•¸é‡é™åˆ¶ THE ç³»çµ± SHALL é™åˆ¶æ¯ä½ä½¿ç”¨è€…æœ€å¤šå„²å­˜ 10 å€‹è‡ªè¨‚ preset
11. WHEN ä½¿ç”¨è€…é”åˆ° preset ä¸Šé™ THEN ç³»çµ± SHALL é¡¯ç¤ºã€Œå·²é”ä¸Šé™ï¼ˆ10 å€‹ï¼‰ï¼Œè«‹åˆªé™¤èˆŠ presetã€

### éœ€æ±‚ 25ï¼šWeb Audio API éŸ³æ•ˆåˆæˆï¼ˆåƒè€ƒ sample.htmlï¼‰
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ç™»å…¥ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦è½åˆ°çœŸå¯¦çš„åˆæˆé¼“è²éŸ³æ•ˆï¼Œä»¥ä¾¿è©•ä¼°æˆ‘å‰µå»ºçš„ç¯€å¥ patternã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE éŸ³è¨Šåˆæˆ THE ç³»çµ± SHALL ä½¿ç”¨ Web Audio API åˆæˆæ‰€æœ‰æ¨‚å™¨éŸ³æ•ˆï¼ˆä¸ä½¿ç”¨ç¾æœ‰ ProceduralMusicEngineï¼‰
2. WHERE AudioContext THE ç³»çµ± SHALL å»ºç«‹ç¨ç«‹çš„ AudioContext å¯¦ä¾‹ï¼ˆä¸å¹²æ“¾å‰å°éŸ³æ¨‚æ’­æ”¾å™¨ï¼‰
3. WHERE Kick éŸ³æ•ˆ THE ç³»çµ± SHALL ä½¿ç”¨ä»¥ä¸‹åˆæˆåƒæ•¸ï¼ˆåƒè€ƒ sample.htmlï¼‰ï¼š
   - OscillatorNodeï¼šfrequency 150 Hz â†’ 0.01 Hzï¼ˆexponentialRamp 0.5sï¼‰
   - GainNodeï¼šgain 1.0 â†’ 0.01ï¼ˆexponentialRamp 0.5sï¼‰
   - æ³¢å½¢ï¼šsine
4. WHERE Snare éŸ³æ•ˆ THE ç³»çµ± SHALL ä½¿ç”¨ç™½å™ªéŸ³ + æŒ¯ç›ªå™¨æ··åˆï¼š
   - NoiseBufferï¼šç™½å™ªéŸ³ï¼ˆAudioBufferSourceNodeï¼‰
   - OscillatorNodeï¼štriangle wave @ 180 Hz
   - BiquadFilterNodeï¼šhighpass @ 1000 Hz
   - Envelopeï¼šAttack 0.01s, Decay 0.15s
5. WHERE HiHat éŸ³æ•ˆ THE ç³»çµ± SHALL ä½¿ç”¨é«˜é »æ–¹æ³¢ï¼š
   - OscillatorNodeï¼šsquare wave @ 10000 Hz
   - BiquadFilterNodeï¼šhighpass @ 7000 Hz
   - Envelopeï¼šAttack 0.01s, Decay 0.05s
6. WHERE OpenHat éŸ³æ•ˆ THE ç³»çµ± SHALL ä½¿ç”¨é«˜é »æ–¹æ³¢ï¼ˆå»¶é•· decayï¼‰ï¼š
   - OscillatorNodeï¼šsquare wave @ 10000 Hz
   - BiquadFilterNodeï¼šhighpass @ 7000 Hz
   - Envelopeï¼šAttack 0.01s, Decay 0.3s
7. WHERE Clap éŸ³æ•ˆ THE ç³»çµ± SHALL ä½¿ç”¨ç™½å™ªéŸ³ï¼š
   - NoiseBufferï¼šç™½å™ªéŸ³
   - BiquadFilterNodeï¼šbandpass @ 1500 Hz
   - Envelopeï¼šAttack 0.01s, Decay 0.1s
8. WHEN æ­¥é©Ÿå•Ÿç”¨ AND æ’­æ”¾é ­åˆ°é”è©²æ­¥é©Ÿ THEN ç³»çµ± SHALL è§¸ç™¼å°æ‡‰æ¨‚å™¨éŸ³æ•ˆ
9. WHERE éŸ³æ•ˆæ’­æ”¾å‡½æ•¸ THE ç³»çµ± SHALL å¯¦ä½œ `playSound(instrument: InstrumentTrack, time: number)` æ–¹æ³•
10. WHEN éŸ³åºå™¨åœæ­¢ THEN ç³»çµ± SHALL é‡‹æ”¾æ‰€æœ‰ AudioNode ä»¥ç¯€çœè¨˜æ†¶é«”

### éœ€æ±‚ 26ï¼šå¾Œç«¯ API æ•´åˆï¼ˆAI ç”Ÿæˆèˆ‡ Preset ç®¡ç†ï¼‰
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºç³»çµ±ç®¡ç†å“¡ï¼Œæˆ‘æƒ³è¦å¾Œç«¯ API æ”¯æ´ç¯€å¥ AI ç”Ÿæˆå’Œ Preset ç®¡ç†ï¼Œä»¥ä¾¿æä¾›å®Œæ•´çš„ç¯€å¥ç·¨è¼¯åŠŸèƒ½ã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE AI ç”Ÿæˆ API THE ç³»çµ± SHALL æä¾› `POST /api/v1/music/generate-rhythm` endpoint
2. WHERE Request æ ¼å¼ THE API SHALL æ¥å—ï¼š
   ```json
   {
     "prompt": "808 cowbell rhythm"
   }
   ```
3. WHERE Response æ ¼å¼ THE API SHALL å›å‚³ï¼š
   ```json
   {
     "pattern": {
       "kick": [true, false, false, false, ...],
       "snare": [false, false, false, false, ...],
       "hihat": [false, false, true, false, ...],
       "openhat": [false, false, false, false, ...],
       "clap": [false, false, false, false, ...]
     },
     "quotaRemaining": 15
   }
   ```
4. WHERE é…é¡æª¢æŸ¥ THE API SHALL åœ¨ç”Ÿæˆå‰æª¢æŸ¥ `user_ai_quotas` è¡¨ï¼ˆæ¯æ—¥é™åˆ¶ 20 æ¬¡ï¼‰
5. IF é…é¡ç”¨ç›¡ THEN API SHALL å›å‚³ 400 éŒ¯èª¤ï¼š
   ```json
   {
     "error": "Daily quota exceeded",
     "quotaLimit": 20,
     "quotaUsed": 20,
     "resetAt": "2025-10-14T00:00:00Z"
   }
   ```
6. WHERE å„²å­˜ Preset API THE ç³»çµ± SHALL æä¾› `POST /api/v1/music/presets` endpoint
7. WHERE å„²å­˜ Request THE API SHALL æ¥å—ï¼š
   ```json
   {
     "name": "My Techno Beat",
     "pattern": { ... }
   }
   ```
8. WHERE å„²å­˜ Response THE API SHALL å›å‚³ï¼š
   ```json
   {
     "id": "uuid",
     "name": "My Techno Beat",
     "pattern": { ... },
     "createdAt": "2025-10-13T12:00:00Z"
   }
   ```
9. WHERE ç²å– Preset åˆ—è¡¨ API THE ç³»çµ± SHALL æä¾› `GET /api/v1/music/presets` endpoint
10. WHERE åˆªé™¤ Preset API THE ç³»çµ± SHALL æä¾› `DELETE /api/v1/music/presets/:id` endpoint
11. WHERE èªè­‰ THE æ‰€æœ‰ API SHALL ä½¿ç”¨ `Authorization: Bearer <token>` é©—è­‰ Supabase session

### éœ€æ±‚ 27ï¼šUI/UX è¨­è¨ˆèˆ‡ç„¡éšœç¤™
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ç™»å…¥ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦ç¯€å¥ç·¨è¼¯å™¨å…·å‚™ Fallout ç¾å­¸å’Œç„¡éšœç¤™æ”¯æ´ï¼Œä»¥ä¾¿æ²‰æµ¸å¼ä½¿ç”¨ä¸¦æ”¯æ´æ‰€æœ‰ä½¿ç”¨è€…ã€‚

#### é©—æ”¶æ¨™æº–

1. WHERE è¨­è¨ˆç³»çµ± THE ç³»çµ± SHALL ä½¿ç”¨ Fallout Pip-Boy ç¶ è‰²çµ‚ç«¯æ©Ÿç¾å­¸ï¼ˆ#00ff88ã€Cubic 11 å­—é«”ï¼‰
2. WHERE åœ–ç¤ºç³»çµ± THE ç³»çµ± SHALL ä½¿ç”¨ PixelIcon åœ–ç¤ºï¼ˆä¸ä½¿ç”¨ lucide-reactï¼‰
3. WHERE éŸ¿æ‡‰å¼ä½ˆå±€ THE ç³»çµ± SHALL åœ¨æ¡Œé¢é¡¯ç¤ºå®Œæ•´ç¶²æ ¼ï¼Œæ‰‹æ©Ÿæä¾›æ©«å‘æ²å‹•
4. WHERE ç„¡éšœç¤™æ¨™ç±¤ THE ç³»çµ± SHALL ç‚ºæ‰€æœ‰äº’å‹•å…ƒç´ æä¾›å®Œæ•´ ARIA æ¨™ç±¤ï¼š
   - æ­¥é©Ÿæ ¼å­ï¼š`aria-label="Kick æ­¥é©Ÿ 1"`
   - æ’­æ”¾æŒ‰éˆ•ï¼š`aria-label="æ’­æ”¾ç¯€å¥"` / `aria-label="æš«åœç¯€å¥"`
   - Tempo æ»‘æ¡¿ï¼š`role="slider" aria-valuenow={bpm} aria-valuemin="60" aria-valuemax="180"`
5. WHERE éµç›¤æ“ä½œ THE ç³»çµ± SHALL æ”¯æ´ä»¥ä¸‹å¿«æ·éµï¼š
   - ç©ºç™½éµï¼šæ’­æ”¾/æš«åœ
   - æ–¹å‘éµï¼šç§»å‹•ç„¦é»æ–¼æ­¥é©Ÿæ ¼å­
   - Enterï¼šåˆ‡æ›ç•¶å‰æ ¼å­ç‹€æ…‹
   - Deleteï¼šæ¸…ç©ºæ‰€æœ‰è»Œé“ï¼ˆéœ€ç¢ºèªï¼‰
6. WHERE Screen Reader æ”¯æ´ THE ç³»çµ± SHALL ä½¿ç”¨ `aria-live="polite"` é€šçŸ¥æ’­æ”¾ç‹€æ…‹è®Šæ›´
7. IF ä½¿ç”¨è€…å•Ÿç”¨ `prefers-reduced-motion` THEN ç³»çµ± SHALL åœç”¨æ‰€æœ‰å‹•ç•«æ•ˆæœ
8. WHERE é¡è‰²å°æ¯”åº¦ THE ç³»çµ± SHALL ç¢ºä¿ Pip-Boy ç¶ è‰²èˆ‡èƒŒæ™¯å°æ¯”åº¦ > 4.5:1

---

## ğŸ”„ ç³»çµ±æ•´åˆéœ€æ±‚ï¼ˆPattern-Based æ¶æ§‹ï¼‰â­ æ–°å¢

### éœ€æ±‚ 28ï¼šæ’­æ”¾æ¸…å–®ç®¡ç†ï¼ˆPattern-Basedï¼‰
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦å»ºç«‹æ’­æ”¾æ¸…å–®ä¸¦åŠ å…¥è‡ªå·±æˆ–ç³»çµ±çš„ patternï¼Œä»¥ä¾¿çµ„ç¹”å’Œæ’­æ”¾è‡ªè¨‚ç¯€å¥ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…å»ºç«‹æ–°æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL åœ¨ `playlists` è¡¨ä¸­å»ºç«‹è¨˜éŒ„
2. WHEN ä½¿ç”¨è€…å°‡ pattern åŠ å…¥æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL åœ¨ `playlist_patterns` è¡¨ä¸­å»ºç«‹é—œè¯
3. WHEN ä½¿ç”¨è€…èª¿æ•´ pattern é †åº THEN ç³»çµ± SHALL æ›´æ–° `position` æ¬„ä½
4. WHEN ä½¿ç”¨è€…ç§»é™¤ pattern THEN ç³»çµ± SHALL åˆªé™¤å°æ‡‰çš„ `playlist_patterns` è¨˜éŒ„
5. WHERE ä½¿ç”¨è€…åªèƒ½ç·¨è¼¯è‡ªå·±çš„æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL é©—è­‰ `user_id` æ“æœ‰æ¬Š
6. WHERE æ’­æ”¾æ¸…å–®å…§å®¹ THE ç³»çµ± SHALL æ”¯æ´åŒæ™‚åŒ…å«ç³»çµ±é è¨­ pattern å’Œä½¿ç”¨è€…è‡ªè¨‚ pattern
7. WHEN ä½¿ç”¨è€…åˆªé™¤æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL ç´šè¯åˆªé™¤æ‰€æœ‰é—œè¯çš„ `playlist_patterns` è¨˜éŒ„
8. WHERE æ’­æ”¾æ¸…å–®å…¬é–‹è¨­å®š THE ç³»çµ± SHALL å…è¨±ä½¿ç”¨è€…è¨­å®š `is_public` æ¬„ä½ï¼ˆæœªä¾†åŠŸèƒ½ï¼‰
9. WHEN ä½¿ç”¨è€…æŸ¥çœ‹æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL é€é JOIN æŸ¥è©¢å›å‚³å®Œæ•´çš„ pattern è³‡æ–™

**è³‡æ–™æ¨¡å‹**ï¼š
```typescript
interface Playlist {
  id: string;
  userId: string;
  name: string;
  description?: string;
  isPublic: boolean;
  patterns: PlaylistPattern[];  // â­ åŒ…å« pattern å¼•ç”¨
  createdAt: Date;
  updatedAt: Date;
}

interface PlaylistPattern {
  id: string;
  playlistId: string;
  patternId: string;
  position: number;
  pattern: RhythmPreset;  // å®Œæ•´çš„ pattern è³‡æ–™ï¼ˆjoinï¼‰
  createdAt: Date;
}
```

**è³‡æ–™åº«çµæ§‹**ï¼š
```sql
CREATE TABLE playlist_patterns (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  playlist_id UUID NOT NULL REFERENCES playlists(id) ON DELETE CASCADE,
  pattern_id UUID NOT NULL REFERENCES user_rhythm_presets(id) ON DELETE CASCADE,
  position INTEGER NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  UNIQUE(playlist_id, position),
  UNIQUE(playlist_id, pattern_id)  -- åŒä¸€ pattern ä¸èƒ½é‡è¤‡åŠ å…¥
);

CREATE INDEX idx_playlist_patterns_playlist_id ON playlist_patterns(playlist_id);
CREATE INDEX idx_playlist_patterns_pattern_id ON playlist_patterns(pattern_id);
```

### éœ€æ±‚ 29ï¼šç³»çµ±é è¨­ Pattern ç®¡ç†
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦ä½¿ç”¨ç³»çµ±æä¾›çš„é è¨­ pattern ä½œç‚ºå¯æ’­æ”¾çš„ã€Œæ­Œæ›²ã€ï¼Œä»¥ä¾¿å¿«é€Ÿé–‹å§‹é«”é©—éŸ³æ¨‚åŠŸèƒ½ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ç³»çµ±åˆå§‹åŒ– THEN ç³»çµ± SHALL è‡ªå‹•å»ºç«‹ 5 å€‹é è¨­ patternï¼ˆ`is_system_preset = true`ï¼‰
2. WHERE pattern ç‚ºç³»çµ±é è¨­ THEN ç³»çµ± SHALL ä½¿ç”¨ç‰¹æ®Šç³»çµ±å¸³è™Ÿï¼ˆ`user_id = '00000000-0000-0000-0000-000000000000'`ï¼‰
3. WHEN ä½¿ç”¨è€…æŸ¥çœ‹å¯ç”¨ pattern THEN ç³»çµ± SHALL é¡¯ç¤ºæ‰€æœ‰ç³»çµ±é è¨­ + ä½¿ç”¨è€…è‡ªå·±çš„ pattern
4. WHEN ä½¿ç”¨è€…å°‡ç³»çµ±é è¨­ pattern åŠ å…¥æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL å…è¨±æ“ä½œï¼ˆä¸éœ€æ“æœ‰è©² patternï¼‰
5. WHERE pattern ç‚ºç³»çµ±é è¨­ THEN ç³»çµ± SHALL ç¦æ­¢åˆªé™¤æˆ–ä¿®æ”¹
6. WHERE ç³»çµ±é è¨­ pattern THE ç³»çµ± SHALL åŒ…å«ä»¥ä¸‹ 5 å€‹é è¨­ï¼šTechnoã€Houseã€Trapã€Breakbeatã€Minimal
7. WHERE pattern è³‡æ–™çµæ§‹ THE ç³»çµ± SHALL åœ¨ `user_rhythm_presets` è¡¨ä¸­å„²å­˜ JSONB æ ¼å¼
8. WHEN ä½¿ç”¨è€…å€åˆ†ç³»çµ±é è¨­èˆ‡è‡ªè¨‚ pattern THEN ç³»çµ± SHALL é€é `is_system_preset` æ¬„ä½æ¨™è¨˜
9. WHERE API å›æ‡‰ THE ç³»çµ± SHALL åˆ†åˆ¥å›å‚³ `systemPresets` å’Œ `userPresets` é™£åˆ—

**ç³»çµ±é è¨­ Pattern å®šç¾©**ï¼š
```typescript
const SYSTEM_PRESETS: RhythmPreset[] = [
  {
    name: 'Techno',
    description: 'ç¶“å…¸ Techno ç¯€å¥',
    pattern: {
      kick:    [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
      snare:   [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
      hihat:   [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
      openhat: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      clap:    [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]
    }
  },
  {
    name: 'House',
    description: 'House éŸ³æ¨‚ç¯€å¥',
    pattern: {
      kick:    [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
      snare:   [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
      hihat:   [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
      openhat: [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
      clap:    [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]
    }
  },
  {
    name: 'Trap',
    description: 'Trap ç¯€å¥',
    pattern: {
      kick:    [1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0],
      snare:   [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
      hihat:   [1,0,1,0,1,0,1,0,1,1,0,1,0,1,1,1],
      openhat: [0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
      clap:    [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]
    }
  },
  {
    name: 'Breakbeat',
    description: 'Breakbeat ç¯€å¥',
    pattern: {
      kick:    [1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0],
      snare:   [0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0],
      hihat:   [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
      openhat: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
      clap:    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    }
  },
  {
    name: 'Minimal',
    description: 'Minimal ç¯€å¥',
    pattern: {
      kick:    [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],
      snare:   [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
      hihat:   [0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1],
      openhat: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      clap:    [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]
    }
  }
];
```

**è³‡æ–™åº«é·ç§»è…³æœ¬**ï¼š
```sql
-- 1. æ›´æ–° user_rhythm_presetsï¼ˆåŠ å…¥ç³»çµ±é è¨­æ¨™è¨˜ï¼‰
ALTER TABLE user_rhythm_presets
ADD COLUMN IF NOT EXISTS is_system_preset BOOLEAN DEFAULT FALSE,
ADD COLUMN IF NOT EXISTS description TEXT;

-- 2. æ’å…¥ç³»çµ±é è¨­ pattern
INSERT INTO user_rhythm_presets (user_id, name, description, pattern, is_system_preset)
VALUES
  ('00000000-0000-0000-0000-000000000000', 'Techno', 'ç¶“å…¸ Techno ç¯€å¥',
   '{"kick": [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], "snare": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], "hihat": [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], "clap": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]}'::jsonb, true),
  ('00000000-0000-0000-0000-000000000000', 'House', 'House éŸ³æ¨‚ç¯€å¥',
   '{"kick": [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], "snare": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], "hihat": [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], "openhat": [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], "clap": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]}'::jsonb, true),
  ('00000000-0000-0000-0000-000000000000', 'Trap', 'Trap ç¯€å¥',
   '{"kick": [1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0], "snare": [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], "hihat": [1,0,1,0,1,0,1,0,1,1,0,1,0,1,1,1], "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0], "clap": [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]}'::jsonb, true),
  ('00000000-0000-0000-0000-000000000000', 'Breakbeat', 'Breakbeat ç¯€å¥',
   '{"kick": [1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0], "snare": [0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0], "hihat": [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0], "clap": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}'::jsonb, true),
  ('00000000-0000-0000-0000-000000000000', 'Minimal', 'Minimal ç¯€å¥',
   '{"kick": [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0], "snare": [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], "hihat": [0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1], "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], "clap": [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]}'::jsonb, true)
ON CONFLICT DO NOTHING;
```

### éœ€æ±‚ 30ï¼šæ’­æ”¾å™¨æ•´åˆç¯€å¥æ’­æ”¾
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå»¢åœŸå¡”ç¾…ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦éŸ³æ¨‚æ’­æ”¾å™¨èƒ½å¤ æ’­æ”¾æ’­æ”¾æ¸…å–®ä¸­çš„ patternï¼Œä»¥ä¾¿æ¬£è³è‡ªè¨‚ç¯€å¥éŸ³æ¨‚ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…é¸æ“‡æ’­æ”¾æ¸…å–®ä¸¦é»æ“Šæ’­æ”¾ THEN ç³»çµ± SHALL è¼‰å…¥ç¬¬ä¸€å€‹ pattern ä¸¦é–‹å§‹æ’­æ”¾
2. WHEN pattern æ’­æ”¾å®Œç•¢ï¼ˆä¾‹å¦‚ 4 å€‹å¾ªç’°å¾Œï¼‰THEN ç³»çµ± SHALL è‡ªå‹•æ’­æ”¾ä¸‹ä¸€å€‹ pattern
3. WHEN ä½¿ç”¨è€…é»æ“Šä¸Šä¸€é¦–/ä¸‹ä¸€é¦– THEN ç³»çµ± SHALL åˆ‡æ›åˆ°å°æ‡‰ pattern
4. WHEN ä½¿ç”¨è€…å•Ÿç”¨éš¨æ©Ÿæ’­æ”¾ THEN ç³»çµ± SHALL éš¨æ©Ÿé¸æ“‡ä¸‹ä¸€å€‹ pattern
5. WHEN ä½¿ç”¨è€…å•Ÿç”¨å¾ªç’°æ’­æ”¾ THEN ç³»çµ± SHALL åœ¨æ’­æ”¾æ¸…å–®çµæŸå¾Œé‡æ–°é–‹å§‹
6. WHERE pattern æ’­æ”¾ THE ç³»çµ± SHALL ä½¿ç”¨ RhythmAudioSynthesizer åˆæˆéŸ³è¨Šï¼ˆWeb Audio APIï¼‰
7. WHERE æ’­æ”¾å¾ªç’°é‚è¼¯ THE ç³»çµ± SHALL æ¯å€‹ pattern é è¨­å¾ªç’° 4 æ¬¡å¾Œåˆ‡æ›ä¸‹ä¸€é¦–
8. WHEN ä½¿ç”¨è€…èª¿æ•´ BPM THEN ç³»çµ± SHALL å³æ™‚èª¿æ•´æ’­æ”¾é€Ÿåº¦ï¼ˆé è¨­ 120 BPMï¼‰
9. WHERE ç•¶å‰æ’­æ”¾è³‡è¨Š THE ç³»çµ± SHALL é¡¯ç¤º pattern åç¨±ã€æ’­æ”¾æ¸…å–®åç¨±ã€æ’­æ”¾é€²åº¦
10. WHEN pattern åˆ‡æ›æ™‚ THEN ç³»çµ± SHALL ä½¿ç”¨ 2 ç§’ crossfade å¹³æ»‘éæ¸¡ï¼ˆè‹¥æ”¯æ´ï¼‰
11. WHERE æ’­æ”¾ç‹€æ…‹æŒä¹…åŒ– THE ç³»çµ± SHALL å„²å­˜ç•¶å‰æ’­æ”¾æ¸…å–®ã€pattern ç´¢å¼•ã€æ’­æ”¾ä½ç½®è‡³ localStorage

**æ’­æ”¾é‚è¼¯å¯¦ä½œ**ï¼š
```typescript
class PlaylistPlayer {
  private currentPlaylist: Playlist;
  private currentPatternIndex: number = 0;
  private synthesizer: RhythmAudioSynthesizer;
  private loopCount: number = 0;
  private maxLoopsPerPattern: number = 4;  // æ¯å€‹ pattern å¾ªç’° 4 æ¬¡

  async playPattern(pattern: Pattern): Promise<void> {
    // ä½¿ç”¨ RhythmAudioSynthesizer æ’­æ”¾ pattern
    await this.synthesizer.loadPattern(pattern);
    this.synthesizer.play();
  }

  onPatternComplete(): void {
    this.loopCount++;
    if (this.loopCount >= this.maxLoopsPerPattern) {
      this.loopCount = 0;
      this.nextPattern();
    } else {
      // ç¹¼çºŒå¾ªç’°ç•¶å‰ pattern
      this.synthesizer.restart();
    }
  }

  nextPattern(): void {
    // æ’­æ”¾ä¸‹ä¸€å€‹ pattern
    const nextIndex = (this.currentPatternIndex + 1) % this.currentPlaylist.patterns.length;
    this.currentPatternIndex = nextIndex;
    this.playPattern(this.currentPlaylist.patterns[nextIndex].pattern);
  }

  previousPattern(): void {
    // æ’­æ”¾ä¸Šä¸€å€‹ pattern
    const prevIndex = this.currentPatternIndex === 0
      ? this.currentPlaylist.patterns.length - 1
      : this.currentPatternIndex - 1;
    this.currentPatternIndex = prevIndex;
    this.playPattern(this.currentPlaylist.patterns[prevIndex].pattern);
  }

  randomPattern(): void {
    // éš¨æ©Ÿæ’­æ”¾
    const randomIndex = Math.floor(Math.random() * this.currentPlaylist.patterns.length);
    this.currentPatternIndex = randomIndex;
    this.playPattern(this.currentPlaylist.patterns[randomIndex].pattern);
  }
}
```

**å‰ç«¯æ•´åˆç¯„ä¾‹**ï¼š
```typescript
// æ’­æ”¾æ¸…å–®é¸æ“‡å™¨
function PlaylistSelector() {
  const { playlists } = usePlaylistManager();
  const { loadPlaylist, play } = useMusicPlayer();

  return (
    <select onChange={(e) => {
      const playlist = playlists.find(p => p.id === e.target.value);
      loadPlaylist(playlist);
      play();
    }}>
      {playlists.map(playlist => (
        <option key={playlist.id} value={playlist.id}>
          {playlist.name} ({playlist.patterns.length} é¦–)
        </option>
      ))}
    </select>
  );
}

// ç•¶å‰æ’­æ”¾è³‡è¨Š
function NowPlaying() {
  const { currentPattern, currentPlaylist } = useMusicPlayer();

  return (
    <div>
      <div className="text-pip-boy-green font-cubic">
        {currentPlaylist?.name}
      </div>
      <div className="text-2xl font-bold">
        {currentPattern?.name}
      </div>
      <div className="text-sm text-gray-400">
        {currentPattern?.description}
      </div>
    </div>
  );
}
```

### ã€ç³»çµ± Cã€‘è¨ªå®¢èˆ‡å…¬é–‹æ­Œæ›²ç³»çµ±éœ€æ±‚ â­ æ–°å¢

### éœ€æ±‚ 31ï¼šè¨ªå®¢ç€è¦½å…¬é–‹æ­Œæ›²
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºè¨ªå®¢ï¼ˆæœªç™»å…¥ä½¿ç”¨è€…ï¼‰ï¼Œæˆ‘æƒ³è¦ç€è¦½æ‰€æœ‰å…¬é–‹çš„æ­Œæ›²ï¼ˆç³»çµ±é è¨­ + ä½¿ç”¨è€…å…¬é–‹å‰µä½œï¼‰ï¼Œä»¥ä¾¿è©¦ç”¨éŸ³æ¨‚ç³»çµ±åŠŸèƒ½ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN è¨ªå®¢è¨ªå•æ­Œæ›²åˆ—è¡¨é  THEN ç³»çµ± SHALL é¡¯ç¤ºæ‰€æœ‰ `is_system_preset = true` çš„æ­Œæ›²
2. WHEN è¨ªå®¢è¨ªå•æ­Œæ›²åˆ—è¡¨é  THEN ç³»çµ± SHALL é¡¯ç¤ºæ‰€æœ‰ `is_public = true` çš„ä½¿ç”¨è€…å‰µä½œæ­Œæ›²
3. WHERE æ­Œæ›²ç‚ºç§å¯†ï¼ˆ`is_public = false`ï¼‰THEN ç³»çµ± SHALL NOT é¡¯ç¤ºçµ¦è¨ªå®¢
4. WHEN è¨ªå®¢é»æ“Šå…¬é–‹æ­Œæ›² THEN ç³»çµ± SHALL é¡¯ç¤ºæ­Œæ›²è©³æƒ…ï¼ˆåç¨±ã€æè¿°ã€patternï¼‰
5. WHEN è¨ªå®¢é»æ“Šã€ŒåŠ å…¥æ’­æ”¾æ¸…å–®ã€THEN ç³»çµ± SHALL å°‡æ­Œæ›²åŠ å…¥ localStorage æ’­æ”¾æ¸…å–®
6. WHERE æ­Œæ›²åˆ—è¡¨é¡¯ç¤º THE ç³»çµ± SHALL é¡¯ç¤ºå‰µä½œè€…åç¨±ï¼ˆä½¿ç”¨è€…å‰µä½œæ­Œæ›²ï¼‰æˆ–ã€Œç³»çµ±é è¨­ã€æ¨™ç±¤
7. WHERE åˆ†é  THE ç³»çµ± SHALL æ”¯æ´åˆ†é ç€è¦½ï¼ˆæ¯é  20 é¦–ï¼Œä¸Šé™ 100 é¦–/é ï¼‰
8. WHERE æ’åº THE ç³»çµ± SHALL æ”¯æ´æŒ‰å»ºç«‹æ™‚é–“ã€åç¨±æ’åºï¼ˆcreated_at_desc | created_at_asc | name_asc | name_descï¼‰

**API ç«¯é»**ï¼š
```http
GET /api/v1/music/presets/public
Authorization: Optional

Query Parameters:
- page: integer (default: 1)
- limit: integer (default: 20, max: 100)
- sort: string (created_at_desc | created_at_asc | name_asc | name_desc)

Response (200):
{
  "systemPresets": [
    {
      "id": "uuid",
      "name": "Techno",
      "description": "ç¶“å…¸ Techno ç¯€å¥",
      "isSystemPreset": true,
      "isPublic": true,
      "createdAt": "2025-01-01T00:00:00Z"
    }
  ],
  "publicPresets": [
    {
      "id": "uuid",
      "name": "æˆ‘çš„ House Mix",
      "description": "è‡ªè¨‚çš„ House ç¯€å¥",
      "userId": "uuid",
      "userName": "ä½¿ç”¨è€…A",
      "isPublic": true,
      "createdAt": "2025-01-13T12:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "totalCount": 150,
    "totalPages": 8
  }
}
```

### éœ€æ±‚ 32ï¼šä½¿ç”¨è€…å‰µä½œæ­Œæ›²æ™‚é¸æ“‡å…¬é–‹/ç§å¯†
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºè¨»å†Šä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦åœ¨å„²å­˜ç¯€å¥æ­Œæ›²æ™‚é¸æ“‡æ˜¯å¦å…¬é–‹ï¼Œä»¥ä¾¿èˆ‡å…¶ä»–ä½¿ç”¨è€…åˆ†äº«æˆ‘çš„å‰µä½œã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…åœ¨ç¯€å¥ç·¨è¼¯å™¨ä¸­é»æ“Šã€Œå„²å­˜ã€THEN ç³»çµ± SHALL é¡¯ç¤ºå„²å­˜å°è©±æ¡†
2. WHERE å„²å­˜å°è©±æ¡† THEN ç³»çµ± SHALL æä¾›ã€Œå…¬é–‹åˆ†äº«ã€å‹¾é¸æ¡†ï¼ˆé è¨­ï¼šæœªå‹¾é¸/ç§å¯†ï¼‰
3. WHEN ä½¿ç”¨è€…å‹¾é¸ã€Œå…¬é–‹åˆ†äº«ã€ä¸¦å„²å­˜ THEN ç³»çµ± SHALL è¨­å®š `is_public = true`
4. WHEN ä½¿ç”¨è€…æœªå‹¾é¸ã€Œå…¬é–‹åˆ†äº«ã€ä¸¦å„²å­˜ THEN ç³»çµ± SHALL è¨­å®š `is_public = false`
5. WHEN ä½¿ç”¨è€…å„²å­˜å¾Œ THEN ç³»çµ± SHALL é¡¯ç¤ºç¢ºèªè¨Šæ¯ã€Œå·²å„²å­˜ç‚ºå…¬é–‹æ­Œæ›²ã€æˆ–ã€Œå·²å„²å­˜ç‚ºç§å¯†æ­Œæ›²ã€
6. WHERE ç·¨è¼¯ç¾æœ‰æ­Œæ›² THE ç³»çµ± SHALL å…è¨±ä½¿ç”¨è€…è®Šæ›´å…¬é–‹/ç§å¯†ç‹€æ…‹
7. WHERE å…¬é–‹æ­Œæ›² THE ç³»çµ± SHALL åœ¨æ­Œæ›²åˆ—è¡¨é¡¯ç¤ºã€Œå…¬é–‹ã€æ¨™ç±¤
8. WHERE ç§å¯†æ­Œæ›² THE ç³»çµ± SHALL åœ¨æ­Œæ›²åˆ—è¡¨é¡¯ç¤ºã€Œç§å¯†ã€æ¨™ç±¤ï¼ˆåƒ…ä½¿ç”¨è€…è‡ªå·±å¯è¦‹ï¼‰

**UI è¨­è¨ˆ**ï¼š
```typescript
// å„²å­˜å°è©±æ¡†
<Dialog>
  <DialogTitle>å„²å­˜ç¯€å¥</DialogTitle>
  <DialogContent>
    <Input
      label="æ­Œæ›²åç¨±"
      value={name}
      maxLength={50}
      required
    />
    <Textarea
      label="æè¿°ï¼ˆå¯é¸ï¼‰"
      value={description}
      maxLength={200}
    />
    <Checkbox
      label="å…¬é–‹åˆ†äº«"
      description="å‹¾é¸å¾Œå…¶ä»–ä½¿ç”¨è€…ï¼ˆå«è¨ªå®¢ï¼‰å¯ä»¥æŸ¥çœ‹ä¸¦ä½¿ç”¨æ­¤ç¯€å¥"
      checked={isPublic}
      onChange={setIsPublic}
    />
  </DialogContent>
  <DialogActions>
    <Button variant="secondary" onClick={onCancel}>å–æ¶ˆ</Button>
    <Button variant="primary" onClick={handleSave}>å„²å­˜</Button>
  </DialogActions>
</Dialog>
```

**API ç«¯é»**ï¼š
```http
POST /api/v1/music/presets
Authorization: Bearer <token>

Request Body:
{
  "name": "æˆ‘çš„ Techno Mix",
  "description": "è‡ªè¨‚çš„ Techno ç¯€å¥",
  "pattern": {
    "kick": [1,0,0,0, ...],
    "snare": [0,0,0,0, ...],
    ...
  },
  "isPublic": true
}

Response (201):
{
  "id": "uuid",
  "userId": "uuid",
  "name": "æˆ‘çš„ Techno Mix",
  "description": "è‡ªè¨‚çš„ Techno ç¯€å¥",
  "isPublic": true,
  "createdAt": "2025-01-13T12:00:00Z",
  "message": "å·²å„²å­˜ç‚ºå…¬é–‹æ­Œæ›²"
}
```

```http
PUT /api/v1/music/presets/{preset_id}
Authorization: Bearer <token>

Request Body:
{
  "name": "æ›´æ–°åç¨±",
  "description": "æ›´æ–°æè¿°",
  "isPublic": false
}

Response (200):
{
  "id": "uuid",
  "name": "æ›´æ–°åç¨±",
  "isPublic": false,
  "message": "å·²æ›´æ–°ç‚ºç§å¯†æ­Œæ›²"
}
```

### éœ€æ±‚ 33ï¼šè¨ªå®¢æ’­æ”¾æ¸…å–®ï¼ˆlocalStorageï¼‰
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºè¨ªå®¢ï¼Œæˆ‘æƒ³è¦å»ºç«‹ä¸€å€‹æ’­æ”¾æ¸…å–®ï¼Œä»¥ä¾¿è©¦ç”¨éŸ³æ¨‚æ’­æ”¾åŠŸèƒ½ï¼Œä½†æˆ‘çŸ¥é“é€™æ˜¯è‡¨æ™‚çš„ä¸”æœ‰é™åˆ¶ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN è¨ªå®¢è¨ªå•éŸ³æ¨‚æ’­æ”¾å™¨ THEN ç³»çµ± SHALL å¾ localStorage è®€å–æ’­æ”¾æ¸…å–®ï¼ˆkey: `guest_playlist`ï¼‰
2. WHEN è¨ªå®¢é¦–æ¬¡è¨ªå• THEN ç³»çµ± SHALL å»ºç«‹ç©ºçš„æ’­æ”¾æ¸…å–®
3. WHEN è¨ªå®¢åŠ å…¥æ­Œæ›²åˆ°æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL æª¢æŸ¥æ­Œæ›²æ•¸é‡
4. WHERE æ’­æ”¾æ¸…å–®å·²æœ‰ 4 é¦–æ­Œæ›² THEN ç³»çµ± SHALL é¡¯ç¤ºã€Œè¨ªå®¢æ’­æ”¾æ¸…å–®å·²æ»¿ï¼ˆä¸Šé™ 4 é¦–ï¼‰ï¼Œè«‹è¨»å†Šä»¥è§£é™¤é™åˆ¶ã€
5. WHEN è¨ªå®¢åŠ å…¥æ­Œæ›²æˆåŠŸ THEN ç³»çµ± SHALL å„²å­˜åˆ° localStorage
6. WHEN è¨ªå®¢ç§»é™¤æ­Œæ›² THEN ç³»çµ± SHALL æ›´æ–° localStorage
7. WHERE æ’­æ”¾æ¸…å–®é¡¯ç¤º THE ç³»çµ± SHALL é¡¯ç¤ºã€Œè¨ªå®¢æ’­æ”¾æ¸…å–®ï¼ˆ{count}/4 é¦–ï¼‰ã€
8. WHERE è³‡æ–™æ¸…é™¤ THE ç³»çµ± SHALL åœ¨æ’­æ”¾æ¸…å–®ä»‹é¢æç¤ºã€Œè¨ªå®¢è³‡æ–™æœƒåœ¨æ¸…é™¤ç€è¦½å™¨è³‡æ–™æ™‚éºå¤±ã€
9. WHEN è¨ªå®¢æ¸…ç©ºç€è¦½å™¨è³‡æ–™ THEN æ’­æ”¾æ¸…å–® SHALL éºå¤±ï¼ˆæ­£å¸¸è¡Œç‚ºï¼‰
10. WHERE æ’­æ”¾æ¸…å–®åç¨± THE ç³»çµ± SHALL å›ºå®šä½¿ç”¨ã€Œè¨ªå®¢æ’­æ”¾æ¸…å–®ã€ï¼ˆä¸å¯ä¿®æ”¹ï¼‰

**localStorage è³‡æ–™çµæ§‹**ï¼š
```typescript
interface GuestPlaylist {
  id: string;  // å›ºå®šç‚º "guest-playlist-local"
  name: string;  // å›ºå®šç‚ºã€Œè¨ªå®¢æ’­æ”¾æ¸…å–®ã€
  patterns: Array<{
    patternId: string;  // å¼•ç”¨ DB ä¸­çš„ pattern ID
    position: number;
    addedAt: string;  // ISO timestamp
  }>;
  createdAt: string;
  updatedAt: string;
}

// localStorage å„²å­˜ç¯„ä¾‹
const guestPlaylist: GuestPlaylist = {
  id: "guest-playlist-local",
  name: "è¨ªå®¢æ’­æ”¾æ¸…å–®",
  patterns: [
    { patternId: "uuid-1", position: 0, addedAt: "2025-01-13T12:00:00Z" },
    { patternId: "uuid-2", position: 1, addedAt: "2025-01-13T12:05:00Z" }
  ],
  createdAt: "2025-01-13T12:00:00Z",
  updatedAt: "2025-01-13T12:05:00Z"
};

localStorage.setItem('guest_playlist', JSON.stringify(guestPlaylist));
```

**é™åˆ¶æç¤º UI**ï¼š
```typescript
// ç•¶è¨ªå®¢å˜—è©¦åŠ å…¥ç¬¬ 5 é¦–æ­Œæ›²æ™‚
<Alert variant="warning">
  <PixelIcon name="alert-triangle" variant="warning" sizePreset="sm" decorative />
  <AlertTitle>è¨ªå®¢æ’­æ”¾æ¸…å–®å·²æ»¿</AlertTitle>
  <AlertDescription>
    è¨ªå®¢æœ€å¤šåªèƒ½åŠ å…¥ 4 é¦–æ­Œæ›²åˆ°æ’­æ”¾æ¸…å–®ã€‚
    <Link href="/auth/register" className="underline">ç«‹å³è¨»å†Š</Link>ä»¥è§£é™¤é™åˆ¶ï¼Œäº«å—ç„¡é™æ’­æ”¾æ¸…å–®ï¼
  </AlertDescription>
</Alert>

// æ’­æ”¾æ¸…å–®æ¨™é¡Œé¡¯ç¤º
<div className="flex items-center justify-between">
  <h3 className="font-cubic text-pip-boy-green">è¨ªå®¢æ’­æ”¾æ¸…å–®</h3>
  <span className="text-sm text-muted">
    {guestPlaylist.patterns.length}/4 é¦–
  </span>
</div>
<p className="text-xs text-warning mt-1">
  âš ï¸ è¨ªå®¢è³‡æ–™æœƒåœ¨æ¸…é™¤ç€è¦½å™¨è³‡æ–™æ™‚éºå¤±
</p>
```

### éœ€æ±‚ 34ï¼šè¨»å†Šä½¿ç”¨è€…æ’­æ”¾æ¸…å–®ï¼ˆç„¡é™åˆ¶ï¼‰
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºè¨»å†Šä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦å»ºç«‹ç„¡é™æ•¸é‡çš„æ’­æ”¾æ¸…å–®ï¼Œæ¯å€‹æ¸…å–®åŒ…å«ç„¡é™é¦–æ­Œæ›²ï¼Œä»¥ä¾¿å®Œæ•´ä½¿ç”¨éŸ³æ¨‚ç³»çµ±ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN ä½¿ç”¨è€…ç™»å…¥ THEN ç³»çµ± SHALL å¾è³‡æ–™åº«è¼‰å…¥æ‰€æœ‰æ’­æ”¾æ¸…å–®
2. WHEN ä½¿ç”¨è€…å»ºç«‹æ–°æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL NOT é™åˆ¶æ¸…å–®æ•¸é‡
3. WHEN ä½¿ç”¨è€…åŠ å…¥æ­Œæ›²åˆ°æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL NOT é™åˆ¶æ­Œæ›²æ•¸é‡
4. WHEN ä½¿ç”¨è€…åˆ‡æ›è£ç½®ä¸¦ç™»å…¥ THEN ç³»çµ± SHALL åŒæ­¥é¡¯ç¤ºæ‰€æœ‰æ’­æ”¾æ¸…å–®
5. WHEN ä½¿ç”¨è€…ç™»å‡º THEN ç³»çµ± SHALL æ¸…é™¤æœ¬åœ°å¿«å–çš„æ’­æ”¾æ¸…å–®è³‡æ–™
6. WHERE æ’­æ”¾æ¸…å–®é¡¯ç¤º THE ç³»çµ± SHALL é¡¯ç¤ºã€Œæˆ‘çš„æ’­æ”¾æ¸…å–®ï¼ˆå…± {count} å€‹ï¼‰ã€
7. WHERE æ­Œæ›²æ•¸é‡é¡¯ç¤º THE ç³»çµ± SHALL é¡¯ç¤ºã€Œ{playlistName}ï¼ˆ{songCount} é¦–ï¼‰ã€
8. WHERE è·¨è£ç½®åŒæ­¥ THE ç³»çµ± SHALL åœ¨ 5 ç§’å…§å®Œæˆè³‡æ–™åŒæ­¥

**API ç«¯é»**ï¼š
```http
GET /api/v1/playlists
Authorization: Bearer <token>

Response (200):
{
  "playlists": [
    {
      "id": "uuid",
      "userId": "uuid",
      "name": "æˆ‘çš„ Techno åˆé›†",
      "description": "æœ€æ„›çš„ Techno ç¯€å¥",
      "patternCount": 15,
      "createdAt": "2025-01-10T12:00:00Z",
      "updatedAt": "2025-01-13T12:00:00Z"
    },
    {
      "id": "uuid",
      "userId": "uuid",
      "name": "æ”¾é¬†æ™‚åˆ»",
      "patternCount": 8,
      "createdAt": "2025-01-12T15:00:00Z"
    }
  ],
  "totalCount": 2
}
```

**UI è¨­è¨ˆ**ï¼š
```typescript
// ä½¿ç”¨è€…æ’­æ”¾æ¸…å–®åˆ—è¡¨
<div>
  <div className="flex items-center justify-between mb-4">
    <h3 className="font-cubic text-pip-boy-green">æˆ‘çš„æ’­æ”¾æ¸…å–®</h3>
    <span className="text-sm text-muted">å…± {playlists.length} å€‹</span>
  </div>
  <Button onClick={createNewPlaylist}>
    <PixelIcon name="plus" sizePreset="xs" decorative />
    å»ºç«‹æ–°æ’­æ”¾æ¸…å–®
  </Button>
  <div className="space-y-2 mt-4">
    {playlists.map(playlist => (
      <PlaylistCard key={playlist.id} playlist={playlist}>
        <div className="flex items-center justify-between">
          <span className="font-cubic">{playlist.name}</span>
          <span className="text-sm text-muted">{playlist.patternCount} é¦–</span>
        </div>
      </PlaylistCard>
    ))}
  </div>
</div>
```

### éœ€æ±‚ 35ï¼šè¨ªå®¢è½‰è¨»å†Šä½¿ç”¨è€…æ™‚çš„æ’­æ”¾æ¸…å–®é·ç§»
**ä½¿ç”¨è€…æ•…äº‹**ï¼šä½œç‚ºå‰›è¨»å†Šçš„ä½¿ç”¨è€…ï¼Œæˆ‘æƒ³è¦å°‡è¨ªå®¢æ¨¡å¼å»ºç«‹çš„æ’­æ”¾æ¸…å–®åŒ¯å…¥åˆ°æˆ‘çš„å¸³è™Ÿï¼Œä»¥ä¾¿ä¿ç•™æˆ‘çš„é¸æ“‡ã€‚

#### é©—æ”¶æ¨™æº–

1. WHEN è¨ªå®¢å®Œæˆè¨»å†Šä¸¦é¦–æ¬¡ç™»å…¥ THEN ç³»çµ± SHALL æª¢æŸ¥ localStorage æ˜¯å¦æœ‰ `guest_playlist`
2. WHERE localStorage æœ‰è¨ªå®¢æ’­æ”¾æ¸…å–® THEN ç³»çµ± SHALL é¡¯ç¤ºåŒ¯å…¥å°è©±æ¡†
3. WHEN ä½¿ç”¨è€…é»æ“Šã€ŒåŒ¯å…¥ã€THEN ç³»çµ± SHALL å»ºç«‹æ–°æ’­æ”¾æ¸…å–®ä¸¦åŠ å…¥æ‰€æœ‰æ­Œæ›²
4. WHEN ä½¿ç”¨è€…é»æ“Šã€Œè·³éã€THEN ç³»çµ± SHALL æ¸…é™¤ localStorage çš„ `guest_playlist`
5. WHEN åŒ¯å…¥å®Œæˆ THEN ç³»çµ± SHALL æ¸…é™¤ localStorage çš„ `guest_playlist`
6. WHERE åŒ¯å…¥æ’­æ”¾æ¸…å–®åç¨± THE ç³»çµ± SHALL ä½¿ç”¨ã€Œè¨ªå®¢æ’­æ”¾æ¸…å–®ï¼ˆå·²åŒ¯å…¥ï¼‰ã€
7. WHERE åŒ¯å…¥å¤±æ•— THE ç³»çµ± SHALL é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ä¸”ä¸æ¸…é™¤ localStorageï¼ˆä½¿ç”¨è€…å¯é‡è©¦ï¼‰
8. WHEN åŒ¯å…¥æˆåŠŸ THEN ç³»çµ± SHALL é¡¯ç¤ºç¢ºèªè¨Šæ¯ã€Œå·²æˆåŠŸåŒ¯å…¥ {count} é¦–æ­Œæ›²ã€

**UI æµç¨‹**ï¼š
```typescript
// è¨»å†Šå®Œæˆå¾Œé¦–æ¬¡ç™»å…¥æ™‚é¡¯ç¤º
<Dialog open={hasGuestPlaylist}>
  <DialogTitle>åŒ¯å…¥è¨ªå®¢æ’­æ”¾æ¸…å–®</DialogTitle>
  <DialogContent>
    <p className="mb-2">
      ä½ åœ¨è¨ªå®¢æ¨¡å¼æ™‚å»ºç«‹äº†ä¸€å€‹åŒ…å« <strong>{guestPlaylist.patterns.length} é¦–æ­Œæ›²</strong>çš„æ’­æ”¾æ¸…å–®ã€‚
    </p>
    <p>æ˜¯å¦è¦å°‡é€™äº›æ­Œæ›²åŒ¯å…¥åˆ°ä½ çš„å¸³è™Ÿä¸­ï¼Ÿ</p>
    <Alert variant="info" className="mt-4">
      <PixelIcon name="info" variant="info" sizePreset="sm" decorative />
      <AlertDescription>
        åŒ¯å…¥å¾Œå°‡å»ºç«‹åç‚ºã€Œè¨ªå®¢æ’­æ”¾æ¸…å–®ï¼ˆå·²åŒ¯å…¥ï¼‰ã€çš„æ–°æ’­æ”¾æ¸…å–®
      </AlertDescription>
    </Alert>
  </DialogContent>
  <DialogActions>
    <Button variant="secondary" onClick={handleSkip}>
      <PixelIcon name="close" sizePreset="xs" decorative />
      è·³é
    </Button>
    <Button variant="primary" onClick={handleImport}>
      <PixelIcon name="download" sizePreset="xs" decorative />
      åŒ¯å…¥åˆ°æˆ‘çš„å¸³è™Ÿ
    </Button>
  </DialogActions>
</Dialog>

// åŒ¯å…¥æˆåŠŸæç¤º
<Toast variant="success">
  <PixelIcon name="check" variant="success" sizePreset="sm" decorative />
  å·²æˆåŠŸåŒ¯å…¥ {count} é¦–æ­Œæ›²åˆ°ã€Œè¨ªå®¢æ’­æ”¾æ¸…å–®ï¼ˆå·²åŒ¯å…¥ï¼‰ã€
</Toast>
```

**API ç«¯é»**ï¼š
```http
POST /api/v1/playlists/import-guest
Authorization: Bearer <token>

Request Body:
{
  "guestPlaylist": {
    "patterns": [
      { "patternId": "uuid-1", "position": 0 },
      { "patternId": "uuid-2", "position": 1 }
    ]
  }
}

Response (201):
{
  "playlistId": "uuid",
  "name": "è¨ªå®¢æ’­æ”¾æ¸…å–®ï¼ˆå·²åŒ¯å…¥ï¼‰",
  "patternCount": 2,
  "message": "å·²æˆåŠŸåŒ¯å…¥ 2 é¦–æ­Œæ›²"
}

Error Response (400):
{
  "error": "INVALID_PATTERN_ID",
  "message": "éƒ¨åˆ†æ­Œæ›² ID ç„¡æ•ˆï¼Œè«‹é‡è©¦",
  "invalidPatternIds": ["uuid-3"]
}
```

## éåŠŸèƒ½æ€§éœ€æ±‚

### æ•ˆèƒ½éœ€æ±‚
- **éŸ³æ¨‚åˆ‡æ›å»¶é²**ï¼š< 500msï¼ˆæ’­æ”¾å™¨ï¼‰
- **ç¯€å¥ç·¨è¼¯å™¨è¼‰å…¥æ™‚é–“**ï¼š< 200msï¼ˆé é¢åˆå§‹åŒ–ï¼‰â­
- **AI ç”Ÿæˆå›æ‡‰æ™‚é–“**ï¼š< 3 ç§’ï¼ˆLLM API å‘¼å«ï¼‰â­
- **éŸ³æ•ˆåˆæˆå»¶é²**ï¼š< 10msï¼ˆWeb Audio API è§¸ç™¼ï¼‰â­
- **ä»‹é¢æ¸²æŸ“æ™‚é–“**ï¼š< 100ms
- **è¨˜æ†¶é«”ä½¿ç”¨ä¸Šé™**ï¼š50MBï¼ˆæ•´åˆç¾æœ‰éŸ³è¨Šç³»çµ±é™åˆ¶ï¼‰
- **CPU ä½¿ç”¨ç‡**ï¼šç¶­æŒ FPS >= 30

### ç›¸å®¹æ€§éœ€æ±‚
- **ç€è¦½å™¨æ”¯æ´**ï¼šChrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **Web Audio API æ”¯æ´**ï¼šæ‰€æœ‰ä¸»æµç€è¦½å™¨ï¼ˆChrome 90+ã€Firefox 88+ã€Safari 14.1+ï¼‰â­
- **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šæ”¯æ´æ¡Œé¢ï¼ˆ>= 768pxï¼‰å’Œè¡Œå‹•è£ç½®ï¼ˆ< 768pxï¼‰
- **è§¸æ§æ”¯æ´**ï¼šæ”¯æ´è§¸æ§æ‰‹å‹¢å’Œæ»‘å‹•æ“ä½œ

### å®‰å…¨æ€§éœ€æ±‚
- **è³‡æ–™å„²å­˜**ï¼šåƒ…ä½¿ç”¨ localStorageï¼ˆä¸æ¶‰åŠæ•æ„Ÿè³‡æ–™ï¼‰
- **XSS é˜²è­·**ï¼šæ‰€æœ‰ä½¿ç”¨è€…è¼¸å…¥ï¼ˆæ’­æ”¾æ¸…å–®åç¨±ï¼‰éœ€ç¶“é sanitize
- **CORS ç­–ç•¥**ï¼šéµå¾ªç¾æœ‰ CORS è¨­å®š
- **API èªè­‰**ï¼šæ‰€æœ‰ç¯€å¥ç·¨è¼¯å™¨ API ä½¿ç”¨ Supabase Auth token é©—è­‰ â­
- **Row Level Security**ï¼šPreset è¡¨ä½¿ç”¨ RLS policyï¼ˆåƒ…è¨ªå•è‡ªå·±çš„ presetï¼‰â­
- **é…é¡é™åˆ¶**ï¼šæ¯æ—¥ AI ç”Ÿæˆæ¬¡æ•¸é™åˆ¶ï¼ˆ20 æ¬¡/å¤©ï¼‰â­

### å¯ç¶­è­·æ€§éœ€æ±‚
- **TypeScript**ï¼šæ‰€æœ‰ç¨‹å¼ç¢¼ä½¿ç”¨ TypeScript 5 åš´æ ¼æ¨¡å¼
- **å…ƒä»¶åŒ–**ï¼šæ’­æ”¾å™¨å’Œç¯€å¥ç·¨è¼¯å™¨æ‹†åˆ†ç‚ºç¨ç«‹å¯é‡ç”¨å…ƒä»¶
- **æ¸¬è©¦è¦†è“‹ç‡**ï¼šå–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ >= 80%
- **æ–‡ä»¶åŒ–**ï¼šæ‰€æœ‰å…¬é–‹ API éœ€åŒ…å« JSDoc
- **éŸ³è¨Šæ¨¡çµ„åˆ†é›¢**ï¼šç¯€å¥ç·¨è¼¯å™¨éŸ³è¨Šåˆæˆå™¨èˆ‡æ’­æ”¾å™¨éŸ³è¨Šå¼•æ“å®Œå…¨ç¨ç«‹ â­

### ç„¡éšœç¤™éœ€æ±‚
- **WCAG 2.1 AA åˆè¦**ï¼šç¬¦åˆ AA ç­‰ç´šç„¡éšœç¤™æ¨™æº–
- **è¢å¹•é–±è®€å™¨æ”¯æ´**ï¼šå®Œæ•´ ARIA æ¨™ç±¤
- **éµç›¤å°èˆª**ï¼šæ‰€æœ‰åŠŸèƒ½å¯é€ééµç›¤æ“ä½œ
- **é¡è‰²å°æ¯”åº¦**ï¼šPip-Boy ç¶ è‰²ï¼ˆ#00ff88ï¼‰èˆ‡é»‘è‰²èƒŒæ™¯å°æ¯”åº¦ > 4.5:1
- **å‹•ç•«æ§åˆ¶**ï¼šæ”¯æ´ `prefers-reduced-motion` åå¥½è¨­å®š â­

## æŠ€è¡“é™åˆ¶èˆ‡ä¾è³´

### ç¾æœ‰æ¶æ§‹ä¾è³´
- **ProceduralMusicEngine**ï¼šç¨‹åºå¼éŸ³æ¨‚ç”Ÿæˆå¼•æ“ï¼ˆ`/src/lib/audio/ProceduralMusicEngine.ts`ï¼‰- åƒ…ç”¨æ–¼æ’­æ”¾å™¨
- **audioStore**ï¼šZustand éŸ³è¨Šç‹€æ…‹ç®¡ç†ï¼ˆ`/src/lib/audio/audioStore.ts`ï¼‰
- **VolumeControl**ï¼šéŸ³é‡æ§åˆ¶çµ„ä»¶ï¼ˆ`/src/components/audio/VolumeControl.tsx`ï¼‰
- **constants.ts**ï¼šéŸ³è¨Šç³»çµ±å¸¸æ•¸ï¼ˆåŒ…å« SCENE_MUSIC_MAPï¼‰

### æŠ€è¡“å †ç–Š
- **å‰ç«¯æ¡†æ¶**ï¼šNext.js 15 (App Router)
- **ç‹€æ…‹ç®¡ç†**ï¼šZustand 4.5+
- **UI çµ„ä»¶åº«**ï¼šshadcn/uiï¼ˆRadix UI primitivesï¼‰
  - **Drawer çµ„ä»¶**ï¼šä¸»æ’­æ”¾å™¨ä»‹é¢ï¼ˆå¾åº•éƒ¨æ»‘å…¥ï¼‰
  - **Sheet çµ„ä»¶**ï¼šæ’­æ”¾æ¸…å–®å½ˆçª—ï¼ˆå¾å³å´æ»‘å…¥ï¼‰
  - **Popover çµ„ä»¶**ï¼šéŸ³é‡æ§åˆ¶å½ˆçª—
  - **Slider çµ„ä»¶**ï¼šéŸ³é‡æ»‘æ¡¿ã€Tempo æ§åˆ¶ â­
- **æ¨£å¼æ–¹æ¡ˆ**ï¼šTailwind CSS v4
- **TypeScript**ï¼šTypeScript 5ï¼ˆåš´æ ¼æ¨¡å¼ï¼‰
- **å¥—ä»¶ç®¡ç†**ï¼šBun
- **å¾Œç«¯æ¡†æ¶**ï¼šFastAPI (Python) â­
- **è³‡æ–™åº«**ï¼šSupabase PostgreSQL â­
- **èªè­‰ç³»çµ±**ï¼šSupabase Authï¼ˆç¾æœ‰ç³»çµ±ï¼‰â­
- **AI æœå‹™**ï¼š
  - **OpenAI API**ï¼šGPT-4 Turbo / GPT-3.5 Turboï¼ˆç¯€å¥åƒæ•¸è§£æï¼‰â­
  - **Google Gemini API**ï¼šGemini Pro / Gemini 1.5 Flashï¼ˆå¿«é€Ÿè§£æï¼‰â­
- **éŸ³è¨ŠæŠ€è¡“**ï¼š
  - **Web Audio API**ï¼šç€è¦½å™¨åŸç”ŸéŸ³è¨Šè™•ç†
  - **AudioContext**ï¼šéŸ³è¨Šä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆæ’­æ”¾å™¨ + ç¯€å¥ç·¨è¼¯å™¨å„è‡ªç¨ç«‹ï¼‰â­
  - **OscillatorNode**ï¼šéŸ³æ³¢ç”Ÿæˆå™¨
  - **GainNode**ï¼šéŸ³é‡æ§åˆ¶
  - **BiquadFilterNode**ï¼šé »ç‡æ¿¾æ³¢å™¨
  - **NoiseBuffer**ï¼šç™½å™ªéŸ³ç”Ÿæˆï¼ˆç¯€å¥ç·¨è¼¯å™¨å°ˆç”¨ï¼‰â­
  - **AudioBufferSourceNode**ï¼šéŸ³è¨Šç·©è¡æ’­æ”¾ï¼ˆç¯€å¥ç·¨è¼¯å™¨å°ˆç”¨ï¼‰â­

### åƒè€ƒæª”æ¡ˆ
- **ç¯€å¥ç·¨è¼¯å™¨è¨­è¨ˆåƒè€ƒ**ï¼š`/src/components/music-player/sample.html`ï¼ˆå®Œæ•´éŸ³åºå™¨å¯¦ä½œï¼‰â­
- **ç¾æœ‰ Auth ç³»çµ±**ï¼šSupabase Auth ä¸­ä»‹å±¤ï¼ˆç™»å…¥é©—è­‰ï¼‰â­
- **ç¾æœ‰ AI Provider**ï¼šAI provider æ•´åˆæ¨¡çµ„ï¼ˆç”ŸæˆåŠŸèƒ½ï¼‰â­

### è³‡æ–™åº«çµæ§‹ï¼ˆæ–°å¢ï¼‰â­

#### user_rhythm_presets è¡¨
```sql
CREATE TABLE user_rhythm_presets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  name TEXT NOT NULL CHECK (char_length(name) <= 50),
  description TEXT,
  pattern JSONB NOT NULL,
  is_system_preset BOOLEAN DEFAULT FALSE,  -- â­ æ¨™è¨˜ç³»çµ±é è¨­
  is_public BOOLEAN DEFAULT FALSE,  -- â­ æ–°å¢ï¼šå…¬é–‹/ç§å¯†æ¨™è¨˜ï¼ˆv4.0ï¼‰
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ç´¢å¼•
CREATE INDEX idx_user_rhythm_presets_user_id ON user_rhythm_presets(user_id);
CREATE INDEX idx_user_rhythm_presets_created_at ON user_rhythm_presets(created_at DESC);
CREATE INDEX idx_user_rhythm_presets_public ON user_rhythm_presets(is_public) WHERE is_public = true;  -- â­ æ–°å¢ï¼šå…¬é–‹æ­Œæ›²ç´¢å¼•ï¼ˆv4.0ï¼‰
CREATE INDEX idx_user_rhythm_presets_system ON user_rhythm_presets(is_system_preset) WHERE is_system_preset = true;  -- â­ æ–°å¢ï¼šç³»çµ±é è¨­ç´¢å¼•ï¼ˆv4.0ï¼‰

-- RLS Policiesï¼ˆv4.0 æ›´æ–°ï¼‰â­
ALTER TABLE user_rhythm_presets ENABLE ROW LEVEL SECURITY;

-- æŸ¥çœ‹æ¬Šé™ï¼šç³»çµ±é è¨­ OR å…¬é–‹ OR è‡ªå·±çš„
CREATE POLICY "Allow read access to public and own presets" ON user_rhythm_presets
  FOR SELECT USING (
    is_system_preset = true OR
    is_public = true OR
    auth.uid() = user_id
  );

-- å»ºç«‹æ¬Šé™ï¼šåƒ…é™å·²ç™»å…¥ä½¿ç”¨è€…
CREATE POLICY "Allow insert for authenticated users" ON user_rhythm_presets
  FOR INSERT WITH CHECK (auth.uid() = user_id);

-- æ›´æ–°æ¬Šé™ï¼šåƒ…é™æ“æœ‰è€…
CREATE POLICY "Allow update for owners" ON user_rhythm_presets
  FOR UPDATE USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);

-- åˆªé™¤æ¬Šé™ï¼šåƒ…é™æ“æœ‰è€…ä¸”éç³»çµ±é è¨­
CREATE POLICY "Allow delete for owners (non-system)" ON user_rhythm_presets
  FOR DELETE USING (auth.uid() = user_id AND is_system_preset = false);
```

#### playlists è¡¨
```sql
CREATE TABLE playlists (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  name TEXT NOT NULL CHECK (char_length(name) <= 50),
  description TEXT,
  is_public BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_playlists_user_id ON playlists(user_id);

-- RLS Policies
ALTER TABLE playlists ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own playlists" ON playlists
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own playlists" ON playlists
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own playlists" ON playlists
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own playlists" ON playlists
  FOR DELETE USING (auth.uid() = user_id);
```

#### playlist_patterns è¡¨ï¼ˆâ­ æ–°å¢ - å–ä»£ playlist_tracksï¼‰
```sql
CREATE TABLE playlist_patterns (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  playlist_id UUID NOT NULL REFERENCES playlists(id) ON DELETE CASCADE,
  pattern_id UUID NOT NULL REFERENCES user_rhythm_presets(id) ON DELETE CASCADE,
  position INTEGER NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  UNIQUE(playlist_id, position),
  UNIQUE(playlist_id, pattern_id)  -- åŒä¸€ pattern ä¸èƒ½é‡è¤‡åŠ å…¥
);

CREATE INDEX idx_playlist_patterns_playlist_id ON playlist_patterns(playlist_id);
CREATE INDEX idx_playlist_patterns_pattern_id ON playlist_patterns(pattern_id);

-- RLS Policies
ALTER TABLE playlist_patterns ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own playlist patterns" ON playlist_patterns
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM playlists
      WHERE playlists.id = playlist_patterns.playlist_id
      AND playlists.user_id = auth.uid()
    )
  );

CREATE POLICY "Users can insert patterns to own playlists" ON playlist_patterns
  FOR INSERT WITH CHECK (
    EXISTS (
      SELECT 1 FROM playlists
      WHERE playlists.id = playlist_patterns.playlist_id
      AND playlists.user_id = auth.uid()
    )
  );

CREATE POLICY "Users can delete patterns from own playlists" ON playlist_patterns
  FOR DELETE USING (
    EXISTS (
      SELECT 1 FROM playlists
      WHERE playlists.id = playlist_patterns.playlist_id
      AND playlists.user_id = auth.uid()
    )
  );
```

#### user_ai_quotas è¡¨ï¼ˆæ•´åˆç¾æœ‰ï¼‰â­
```sql
-- å‡è¨­å·²å­˜åœ¨ï¼Œéœ€ç¢ºä¿åŒ…å«ç¯€å¥ç”Ÿæˆé…é¡æ¬„ä½
ALTER TABLE user_ai_quotas ADD COLUMN IF NOT EXISTS rhythm_quota_used INTEGER DEFAULT 0;
ALTER TABLE user_ai_quotas ADD COLUMN IF NOT EXISTS rhythm_quota_limit INTEGER DEFAULT 20;
```

#### âš ï¸ å·²åˆªé™¤çš„è¡¨
- âŒ `music_tracks` - ä¸å†éœ€è¦å¤–éƒ¨éŸ³æ¨‚æª”æ¡ˆ
- âŒ `playlist_tracks` - æ”¹ç”¨ `playlist_patterns`

### éŸ³æ¨‚æ¨¡å¼å®šç¾©ï¼ˆå·²æ£„ç”¨ï¼‰âš ï¸
> **æ³¨æ„**ï¼šä»¥ä¸‹éŸ³æ¨‚æ¨¡å¼å®šç¾©å·²è¢« Pattern-Based ç³»çµ±å–ä»£ï¼Œè«‹åƒè€ƒéœ€æ±‚ 29 çš„ç³»çµ±é è¨­ Patternã€‚

- ~~**synthwave**ï¼šé¦–é èƒŒæ™¯éŸ³æ¨‚ï¼ˆé›»å­åˆæˆå™¨é¢¨æ ¼ï¼‰~~
- ~~**divination**ï¼šå åœé é¢éŸ³æ¨‚ï¼ˆç¥ç§˜æ°›åœï¼‰~~
- ~~**lofi**ï¼šå„€è¡¨æ¿/å€‹äººè³‡æ–™é ï¼ˆLo-fi ç¯€å¥ï¼‰~~
- ~~**ambient**ï¼šå¡ç‰Œç€è¦½é ï¼ˆç’°å¢ƒéŸ³æ¨‚ï¼‰~~

---

## è³‡æ–™åº«é·ç§»è…³æœ¬ï¼ˆv4.0ï¼‰â­ æ–°å¢

### é·ç§»è…³æœ¬ï¼šæ–°å¢è¨ªå®¢èˆ‡å…¬é–‹æ­Œæ›²æ”¯æ´

```sql
-- 1. æ›´æ–° user_rhythm_presets è¡¨ï¼ˆæ–°å¢ is_public æ¬„ä½ï¼‰
ALTER TABLE user_rhythm_presets
ADD COLUMN IF NOT EXISTS is_public BOOLEAN DEFAULT FALSE;

-- 2. å»ºç«‹ç´¢å¼•ï¼ˆå„ªåŒ–å…¬é–‹æ­Œæ›²æŸ¥è©¢ï¼‰
CREATE INDEX IF NOT EXISTS idx_user_rhythm_presets_public
ON user_rhythm_presets(is_public)
WHERE is_public = true;

CREATE INDEX IF NOT EXISTS idx_user_rhythm_presets_system
ON user_rhythm_presets(is_system_preset)
WHERE is_system_preset = true;

-- 3. æ›´æ–°ç³»çµ±é è¨­æ­Œæ›²ç‚ºå…¬é–‹
UPDATE user_rhythm_presets
SET is_public = true
WHERE is_system_preset = true;

-- 4. åˆªé™¤èˆŠçš„ RLS policies
DROP POLICY IF EXISTS "Users can view own presets and system presets" ON user_rhythm_presets;
DROP POLICY IF EXISTS "Users can insert own presets" ON user_rhythm_presets;
DROP POLICY IF EXISTS "Users can delete own presets" ON user_rhythm_presets;

-- 5. å»ºç«‹æ–°çš„ RLS policiesï¼ˆæ”¯æ´è¨ªå®¢æŸ¥çœ‹å…¬é–‹æ­Œæ›²ï¼‰
CREATE POLICY "Allow read access to public and own presets" ON user_rhythm_presets
  FOR SELECT USING (
    is_system_preset = true OR
    is_public = true OR
    auth.uid() = user_id
  );

CREATE POLICY "Allow insert for authenticated users" ON user_rhythm_presets
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Allow update for owners" ON user_rhythm_presets
  FOR UPDATE USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Allow delete for owners (non-system)" ON user_rhythm_presets
  FOR DELETE USING (auth.uid() = user_id AND is_system_preset = false);

-- 6. é©—è­‰é·ç§»çµæœ
-- æª¢æŸ¥ is_public æ¬„ä½æ˜¯å¦å­˜åœ¨
SELECT column_name, data_type, column_default
FROM information_schema.columns
WHERE table_name = 'user_rhythm_presets'
AND column_name = 'is_public';

-- æª¢æŸ¥ç´¢å¼•æ˜¯å¦å»ºç«‹æˆåŠŸ
SELECT indexname, indexdef
FROM pg_indexes
WHERE tablename = 'user_rhythm_presets'
AND indexname IN ('idx_user_rhythm_presets_public', 'idx_user_rhythm_presets_system');

-- æª¢æŸ¥ RLS policies æ˜¯å¦æ­£ç¢º
SELECT policyname, cmd, qual
FROM pg_policies
WHERE tablename = 'user_rhythm_presets';
```

### é·ç§»é©—è­‰æ¸…å–®

- [ ] `is_public` æ¬„ä½å·²æ–°å¢è‡³ `user_rhythm_presets` è¡¨
- [ ] ç´¢å¼• `idx_user_rhythm_presets_public` å·²å»ºç«‹
- [ ] ç´¢å¼• `idx_user_rhythm_presets_system` å·²å»ºç«‹
- [ ] ç³»çµ±é è¨­æ­Œæ›²çš„ `is_public` å·²è¨­ç‚º `true`
- [ ] RLS policy "Allow read access to public and own presets" å·²å»ºç«‹
- [ ] RLS policy "Allow insert for authenticated users" å·²å»ºç«‹
- [ ] RLS policy "Allow update for owners" å·²å»ºç«‹
- [ ] RLS policy "Allow delete for owners (non-system)" å·²å»ºç«‹
- [ ] èˆŠçš„ RLS policies å·²åˆªé™¤

### å›æ»¾è…³æœ¬ï¼ˆè‹¥éœ€è¦ï¼‰

```sql
-- 1. åˆªé™¤æ–°çš„ RLS policies
DROP POLICY IF EXISTS "Allow read access to public and own presets" ON user_rhythm_presets;
DROP POLICY IF EXISTS "Allow insert for authenticated users" ON user_rhythm_presets;
DROP POLICY IF EXISTS "Allow update for owners" ON user_rhythm_presets;
DROP POLICY IF EXISTS "Allow delete for owners (non-system)" ON user_rhythm_presets;

-- 2. æ¢å¾©èˆŠçš„ RLS policies
CREATE POLICY "Users can view own presets and system presets" ON user_rhythm_presets
  FOR SELECT USING (auth.uid() = user_id OR is_system_preset = true);

CREATE POLICY "Users can insert own presets" ON user_rhythm_presets
  FOR INSERT WITH CHECK (auth.uid() = user_id AND is_system_preset = false);

CREATE POLICY "Users can delete own presets" ON user_rhythm_presets
  FOR DELETE USING (auth.uid() = user_id AND is_system_preset = false);

-- 3. åˆªé™¤ç´¢å¼•
DROP INDEX IF EXISTS idx_user_rhythm_presets_public;
DROP INDEX IF EXISTS idx_user_rhythm_presets_system;

-- 4. åˆªé™¤ is_public æ¬„ä½
ALTER TABLE user_rhythm_presets DROP COLUMN IF EXISTS is_public;
```

---

## API ç«¯é»è¦æ ¼ï¼ˆPattern-Based æ¶æ§‹ï¼‰â­ æ–°å¢

### æ’­æ”¾æ¸…å–® API

#### 1. å»ºç«‹æ’­æ”¾æ¸…å–®
```http
POST /api/v1/playlists
Authorization: Bearer <token>

Request Body:
{
  "name": "æˆ‘çš„ Techno Mix",
  "description": "æœ€æ„›çš„ Techno ç¯€å¥åˆé›†",
  "isPublic": false
}

Response (201):
{
  "id": "uuid",
  "userId": "uuid",
  "name": "æˆ‘çš„ Techno Mix",
  "description": "æœ€æ„›çš„ Techno ç¯€å¥åˆé›†",
  "isPublic": false,
  "patterns": [],
  "createdAt": "2025-10-13T12:00:00Z",
  "updatedAt": "2025-10-13T12:00:00Z"
}
```

#### 2. åŠ å…¥ Pattern åˆ°æ’­æ”¾æ¸…å–®
```http
POST /api/v1/playlists/{playlist_id}/patterns
Authorization: Bearer <token>

Request Body:
{
  "patternId": "uuid",
  "position": 0  // æ’å…¥ä½ç½®ï¼ˆå¯é¸ï¼Œé è¨­åŠ åˆ°æœ€å¾Œï¼‰
}

Response (201):
{
  "id": "uuid",
  "playlistId": "uuid",
  "patternId": "uuid",
  "position": 0,
  "pattern": {
    "id": "uuid",
    "name": "Techno",
    "description": "ç¶“å…¸ Techno ç¯€å¥",
    "isSystemPreset": true,
    "pattern": {
      "kick": [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
      "snare": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
      "hihat": [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
      "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      "clap": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]
    }
  },
  "createdAt": "2025-10-13T12:00:00Z"
}
```

#### 3. ç²å–æ’­æ”¾æ¸…å–®ï¼ˆå« Patternï¼‰
```http
GET /api/v1/playlists/{playlist_id}
Authorization: Bearer <token>

Response (200):
{
  "id": "uuid",
  "userId": "uuid",
  "name": "æˆ‘çš„ Techno Mix",
  "description": "æœ€æ„›çš„ Techno ç¯€å¥åˆé›†",
  "isPublic": false,
  "patterns": [
    {
      "id": "uuid",
      "position": 0,
      "pattern": {
        "id": "uuid",
        "name": "Techno",
        "description": "ç¶“å…¸ Techno ç¯€å¥",
        "isSystemPreset": true,
        "pattern": {
          "kick": [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
          "snare": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
          "hihat": [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
          "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
          "clap": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]
        }
      }
    },
    {
      "id": "uuid",
      "position": 1,
      "pattern": {
        "id": "uuid",
        "name": "æˆ‘çš„è‡ªè¨‚ç¯€å¥",
        "description": "å¯¦é©—æ€§ç¯€å¥",
        "isSystemPreset": false,
        "pattern": {
          "kick": [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
          "snare": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
          "hihat": [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
          "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
          "clap": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
        }
      }
    }
  ],
  "createdAt": "2025-10-13T12:00:00Z",
  "updatedAt": "2025-10-13T12:30:00Z"
}
```

#### 4. ç²å–ä½¿ç”¨è€…æ‰€æœ‰æ’­æ”¾æ¸…å–®
```http
GET /api/v1/playlists
Authorization: Bearer <token>

Response (200):
{
  "playlists": [
    {
      "id": "uuid",
      "name": "æˆ‘çš„ Techno Mix",
      "description": "æœ€æ„›çš„ Techno ç¯€å¥åˆé›†",
      "patternCount": 5,
      "createdAt": "2025-10-13T12:00:00Z"
    },
    {
      "id": "uuid",
      "name": "æ”¾é¬†ç¯€å¥",
      "description": "é©åˆå·¥ä½œçš„ç¯€å¥",
      "patternCount": 3,
      "createdAt": "2025-10-12T10:00:00Z"
    }
  ]
}
```

#### 5. ç§»é™¤ Pattern
```http
DELETE /api/v1/playlists/{playlist_id}/patterns/{pattern_id}
Authorization: Bearer <token>

Response (204): No Content
```

#### 6. èª¿æ•´ Pattern é †åº
```http
PUT /api/v1/playlists/{playlist_id}/patterns/{pattern_id}/position
Authorization: Bearer <token>

Request Body:
{
  "position": 2
}

Response (200):
{
  "id": "uuid",
  "playlistId": "uuid",
  "patternId": "uuid",
  "position": 2,
  "createdAt": "2025-10-13T12:00:00Z"
}
```

#### 7. æ›´æ–°æ’­æ”¾æ¸…å–®è³‡è¨Š
```http
PUT /api/v1/playlists/{playlist_id}
Authorization: Bearer <token>

Request Body:
{
  "name": "æ–°çš„æ’­æ”¾æ¸…å–®åç¨±",
  "description": "æ–°çš„æè¿°",
  "isPublic": true
}

Response (200):
{
  "id": "uuid",
  "userId": "uuid",
  "name": "æ–°çš„æ’­æ”¾æ¸…å–®åç¨±",
  "description": "æ–°çš„æè¿°",
  "isPublic": true,
  "updatedAt": "2025-10-13T13:00:00Z"
}
```

#### 8. åˆªé™¤æ’­æ”¾æ¸…å–®
```http
DELETE /api/v1/playlists/{playlist_id}
Authorization: Bearer <token>

Response (204): No Content
```

### Pattern ç®¡ç† API

#### 9. ç²å–æ‰€æœ‰å¯ç”¨ Patternï¼ˆç³»çµ± + ä½¿ç”¨è€…ï¼‰
```http
GET /api/v1/music/presets/available
Authorization: Bearer <token>

Response (200):
{
  "systemPresets": [
    {
      "id": "uuid",
      "name": "Techno",
      "description": "ç¶“å…¸ Techno ç¯€å¥",
      "isSystemPreset": true,
      "pattern": {
        "kick": [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
        "snare": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
        "hihat": [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
        "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        "clap": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]
      },
      "createdAt": "2025-01-01T00:00:00Z"
    }
    // ... å…¶ä»–ç³»çµ±é è¨­ (House, Trap, Breakbeat, Minimal)
  ],
  "userPresets": [
    {
      "id": "uuid",
      "name": "æˆ‘çš„ç¯€å¥",
      "description": "å¯¦é©—æ€§ç¯€å¥",
      "isSystemPreset": false,
      "pattern": {
        "kick": [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
        "snare": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
        "hihat": [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        "clap": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
      },
      "createdAt": "2025-10-13T12:00:00Z"
    }
  ]
}
```

#### 10. å„²å­˜ä½¿ç”¨è€…è‡ªè¨‚ Presetï¼ˆä¾†è‡ªç¯€å¥ç·¨è¼¯å™¨ï¼‰
```http
POST /api/v1/music/presets
Authorization: Bearer <token>

Request Body:
{
  "name": "My Techno Beat",
  "description": "å¯¦é©—æ€§ Techno ç¯€å¥",
  "pattern": {
    "kick": [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
    "snare": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
    "hihat": [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
    "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    "clap": [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]
  }
}

Response (201):
{
  "id": "uuid",
  "userId": "uuid",
  "name": "My Techno Beat",
  "description": "å¯¦é©—æ€§ Techno ç¯€å¥",
  "pattern": { ... },
  "isSystemPreset": false,
  "createdAt": "2025-10-13T12:00:00Z"
}
```

#### 11. åˆªé™¤ä½¿ç”¨è€… Preset
```http
DELETE /api/v1/music/presets/{preset_id}
Authorization: Bearer <token>

Response (204): No Content

Error (403) - å˜—è©¦åˆªé™¤ç³»çµ±é è¨­:
{
  "error": "Cannot delete system preset"
}
```

### AI ç”Ÿæˆ APIï¼ˆç¯€å¥ç·¨è¼¯å™¨å°ˆç”¨ï¼‰

#### 12. AI ç”Ÿæˆç¯€å¥ Pattern
```http
POST /api/v1/music/generate-rhythm
Authorization: Bearer <token>

Request Body:
{
  "prompt": "808 cowbell rhythm with heavy trap influence"
}

Response (200):
{
  "pattern": {
    "kick": [1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0],
    "snare": [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
    "hihat": [1,0,1,0,1,0,1,0,1,1,0,1,0,1,1,1],
    "openhat": [0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
    "clap": [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]
  },
  "quotaRemaining": 15
}

Error (400) - é…é¡ç”¨ç›¡:
{
  "error": "Daily quota exceeded",
  "quotaLimit": 20,
  "quotaUsed": 20,
  "resetAt": "2025-10-14T00:00:00Z"
}

Error (500) - AI ç”Ÿæˆå¤±æ•—:
{
  "error": "AI generation failed",
  "message": "Unable to parse rhythm from AI response"
}
```

#### 13. ç²å–ä½¿ç”¨è€… AI é…é¡ç‹€æ…‹
```http
GET /api/v1/music/quota
Authorization: Bearer <token>

Response (200):
{
  "quotaLimit": 20,
  "quotaUsed": 5,
  "quotaRemaining": 15,
  "resetAt": "2025-10-14T00:00:00Z"
}
```

### âš ï¸ å·²åˆªé™¤çš„ API ç«¯é»

ä»¥ä¸‹ API ç«¯é»å·²å¾ç³»çµ±ä¸­ç§»é™¤ï¼Œå› ç‚ºä¸å†ä½¿ç”¨å¤–éƒ¨éŸ³æ¨‚æª”æ¡ˆï¼š

- âŒ `POST /api/v1/playlists/tracks` - æ–°å¢éŸ³æ¨‚æª”æ¡ˆè‡³æ’­æ”¾æ¸…å–®ï¼ˆæ”¹ç”¨ Patternï¼‰
- âŒ `GET /api/v1/playlists/tracks` - ç²å–æ’­æ”¾æ¸…å–®éŸ³æ¨‚æª”æ¡ˆï¼ˆæ”¹ç”¨ Patternï¼‰
- âŒ `DELETE /api/v1/playlists/tracks/{track_id}` - ç§»é™¤éŸ³æ¨‚æª”æ¡ˆï¼ˆæ”¹ç”¨ Patternï¼‰
- âŒ `GET /api/v1/music/tracks` - ç²å–æ‰€æœ‰å¯ç”¨éŸ³æ¨‚æª”æ¡ˆï¼ˆæ”¹ç”¨ç³»çµ±é è¨­ Patternï¼‰
- âŒ `POST /api/v1/music/upload` - ä¸Šå‚³éŸ³æ¨‚æª”æ¡ˆï¼ˆæ”¹ç”¨ç¯€å¥ç·¨è¼¯å™¨å‰µå»º Patternï¼‰

## UI/UX è¦æ ¼

### è¨­è¨ˆç³»çµ±
- **ä¸»è‰²èª¿**ï¼šPip-Boy ç¶ è‰² `#00ff88`
- **èƒŒæ™¯è‰²**ï¼š`var(--color-wasteland-darker)` æˆ– `#000000`
- **æ–‡å­—å­—é«”**ï¼šCubic 11 åƒç´ å­—é«”ï¼ˆå…¨ç«™çµ±ä¸€ï¼‰â­
- **é‚Šæ¡†æ¨£å¼**ï¼š2px solid `#00ff88` æˆ– `#00ff88/50`
- **é™°å½±æ•ˆæœ**ï¼š`shadow-pip-boy-green` æˆ– `0 0 10px rgba(0, 255, 136, 0.5)`
- **åœ–ç¤ºç³»çµ±**ï¼šPixelIconï¼ˆä¸ä½¿ç”¨ lucide-reactï¼‰â­

### è¦–è¦ºæ•ˆæœ
- **CRT æƒæç·š**ï¼šä½¿ç”¨ CSS `background-image` æˆ– `::before` pseudo-element
- **ç¶ è‰²ç™¼å…‰**ï¼š`box-shadow: 0 0 10px var(--color-glow-green)`
- **éæ¸¡å‹•ç•«**ï¼š300ms ease-outï¼ˆæŒ‰éˆ•ã€hover æ•ˆæœï¼‰
- **è¼‰å…¥å‹•ç•«**ï¼šæ—‹è½‰ Pip-Boy åœ–ç¤ºæˆ–æƒæç·šæ•ˆæœ
- **æ­¥é©Ÿé«˜äº®å‹•ç•«**ï¼šæ’­æ”¾æ™‚è„ˆè¡æ•ˆæœï¼ˆç¯€å¥ç·¨è¼¯å™¨ï¼‰â­

### éŸ¿æ‡‰å¼ä½ˆå±€

#### æ’­æ”¾å™¨ï¼ˆç³»çµ± Aï¼‰

- **æ¡Œé¢ç‰ˆï¼ˆ>= 768pxï¼‰**ï¼š
  - Drawer æ’­æ”¾å™¨ä¸»ä»‹é¢å¾åº•éƒ¨æ»‘å…¥ï¼Œé è¨­é«˜åº¦ç‚ºè¢å¹•é«˜åº¦çš„ 60%ï¼ˆå¯æ‹–æ›³èª¿æ•´ 30%-90%ï¼‰
  - Drawer å¯æœ€å°åŒ–ç‚ºåº•éƒ¨æµ®å‹•æ§åˆ¶æ¢ï¼ˆé¡¯ç¤ºç•¶å‰æ›²ç›®ã€æ’­æ”¾/æš«åœæŒ‰éˆ•ï¼‰
  - é»æ“Š Drawer å…§çš„ã€Œæ’­æ”¾æ¸…å–®ã€æŒ‰éˆ•é–‹å•Ÿ Sheet å½ˆçª—ï¼ˆå¾å³å´æ»‘å…¥ï¼Œå¯¬åº¦ 400pxï¼‰
  - Sheet å½ˆçª—å…§é¡¯ç¤ºéŸ³æ¨‚æ¨¡å¼ç€è¦½å™¨å’Œå®Œæ•´æ’­æ”¾æ¸…å–®ï¼ˆå¯æ²å‹•ï¼‰
  - Drawer å…§é¡¯ç¤ºç•¶å‰æ›²ç›®è³‡è¨Šã€æ’­æ”¾æ§åˆ¶ã€é€²åº¦æ¢ã€éŸ³é‡æ§åˆ¶

- **è¡Œå‹•ç‰ˆï¼ˆ< 768pxï¼‰**ï¼š
  - Drawer æ’­æ”¾å™¨ä¸»ä»‹é¢å¾åº•éƒ¨æ»‘å…¥ï¼Œé è¨­é«˜åº¦ç‚ºè¢å¹•é«˜åº¦çš„ 60%
  - Drawer å¯å‘ä¸‹æ‹–æ›³æœ€å°åŒ–ç‚ºåº•éƒ¨æµ®å‹•æ§åˆ¶æ¢
  - é»æ“Šæµ®å‹•æ§åˆ¶æ¢å¯é‡æ–°å±•é–‹å®Œæ•´ Drawer æ’­æ”¾å™¨
  - é»æ“Š Drawer å…§çš„ã€Œæ’­æ”¾æ¸…å–®ã€æŒ‰éˆ•é–‹å•Ÿ Sheet å½ˆçª—ï¼ˆå¾å³å´æ»‘å…¥ï¼Œå¯¬åº¦ç‚ºè¢å¹•çš„ 90%ï¼‰
  - Sheet å½ˆçª—å…§é¡¯ç¤ºéŸ³æ¨‚æ¨¡å¼ç€è¦½å™¨å’Œæ’­æ”¾æ¸…å–®ç®¡ç†

#### ç¯€å¥ç·¨è¼¯å™¨ï¼ˆç³»çµ± Bï¼‰â­

- **æ¡Œé¢ç‰ˆï¼ˆ>= 768pxï¼‰**ï¼š
  - å®Œæ•´é é¢ä½ˆå±€ï¼ˆ`/dashboard/rhythm-editor`ï¼‰
  - 16 æ­¥é©Ÿç¶²æ ¼å®Œæ•´é¡¯ç¤ºï¼ˆ5 è»Œé“ Ã— 16 æ­¥é©Ÿï¼‰
  - å·¦å´ï¼šè»Œé“æ¨™ç±¤ï¼ˆKickã€Snareã€HiHatã€OpenHatã€Clapï¼‰
  - ä¸­å¤®ï¼šæ­¥é©Ÿç¶²æ ¼
  - å³å´ï¼šæ§åˆ¶é¢æ¿ï¼ˆTempoã€Play/Pause/Stopã€Clearã€Presetã€AI ç”Ÿæˆï¼‰
  - åº•éƒ¨ï¼šé…é¡é¡¯ç¤ºå’Œä½¿ç”¨è€… Preset åˆ—è¡¨

- **è¡Œå‹•ç‰ˆï¼ˆ< 768pxï¼‰**ï¼š
  - å®Œæ•´é é¢ä½ˆå±€
  - æ­¥é©Ÿç¶²æ ¼æ©«å‘æ²å‹•ï¼ˆ5 è»Œé“ Ã— 16 æ­¥é©Ÿï¼‰
  - æ§åˆ¶é¢æ¿å‚ç›´å †ç–Šæ–¼ç¶²æ ¼ä¸‹æ–¹
  - Tempo æ§åˆ¶æ¢å’Œå‚³è¼¸æŒ‰éˆ•å›ºå®šæ–¼åº•éƒ¨

### äº’å‹•æ¨¡å¼
- **Hover æ•ˆæœ**ï¼šç¶ è‰²ç™¼å…‰ + è¼•å¾®æ”¾å¤§ï¼ˆscale: 1.05ï¼‰
- **é»æ“Šåé¥‹**ï¼špip-boy-beep éŸ³æ•ˆ + æŒ‰éˆ•ç¸®å°å‹•ç•«
- **æ‹–æ›³æ“ä½œ**ï¼šéŸ³æ¨‚æ¨¡å¼é …ç›®å¯æ‹–æ›³è‡³æ’­æ”¾æ¸…å–®
- **æ»‘å‹•æ‰‹å‹¢**ï¼šè¡Œå‹•è£ç½®æ”¯æ´å·¦å³æ»‘å‹•åˆ‡æ›æ›²ç›®
- **æ­¥é©Ÿé»æ“Šåé¥‹**ï¼šç¯€å¥ç·¨è¼¯å™¨æ­¥é©Ÿæ ¼å­é»æ“Šæ™‚è§¸ç™¼è¦–è¦ºåè½‰ + éŸ³æ•ˆé è¦½ â­
- **éµç›¤å°èˆª**ï¼šTab éµèšç„¦ã€Enter åˆ‡æ›ã€æ–¹å‘éµç§»å‹•ï¼ˆç¯€å¥ç·¨è¼¯å™¨ï¼‰â­

---

## é‡è¦æé†’ âš ï¸

### ç³»çµ±åˆ†é›¢åŸå‰‡
1. **ç¯€å¥ç·¨è¼¯å™¨æ˜¯ç¨ç«‹é é¢**ï¼š`/dashboard/rhythm-editor`ï¼Œä¸åœ¨ MusicPlayerDrawer å…§
2. **å…©å€‹ç³»çµ±äº’ä¸å¹²æ“¾**ï¼šæ’­æ”¾å™¨ä½¿ç”¨ ProceduralMusicEngineï¼Œç¯€å¥ç·¨è¼¯å™¨ä½¿ç”¨ç¨ç«‹ Web Audio API åˆæˆå™¨
3. **èªè­‰éš”é›¢**ï¼šç¯€å¥ç·¨è¼¯å™¨éœ€ç™»å…¥ï¼Œæ’­æ”¾å™¨å…¬é–‹ä½¿ç”¨
4. **AudioContext ç¨ç«‹**ï¼šå„è‡ªç®¡ç†ç¨ç«‹çš„ AudioContext å¯¦ä¾‹

### æŠ€è¡“ç´„æŸ
1. **å®Œå…¨æ¨¡ä»¿ sample.html**ï¼šç¯€å¥ç·¨è¼¯å™¨çš„éŸ³è¨Šåˆæˆã€UI ä½ˆå±€ã€äº’å‹•æ–¹å¼åƒè€ƒ sample.html
2. **æ¨‚å™¨åç¨±ä¸€è‡´**ï¼šä½¿ç”¨ sample.html åŸå§‹åç¨±ï¼ˆKickã€Snareã€HiHatã€OpenHatã€Clapï¼‰
3. **ä¸ä½¿ç”¨ lucide-react**ï¼šå…¨ç«™çµ±ä¸€ä½¿ç”¨ PixelIcon
4. **ä¸ä½¿ç”¨ç¾æœ‰åˆæˆå™¨**ï¼šç¯€å¥ç·¨è¼¯å™¨ä¸ä½¿ç”¨ Bassã€Padã€Lead åˆæˆå™¨

### è³‡æ–™æµ
1. **AI ç”Ÿæˆæµç¨‹**ï¼šå‰ç«¯ â†’ FastAPI â†’ AI Provider â†’ è§£æ pattern â†’ å›å‚³å‰ç«¯
2. **Preset å„²å­˜æµç¨‹**ï¼šå‰ç«¯ â†’ FastAPI â†’ Supabase `user_rhythm_presets` è¡¨
3. **é…é¡ç®¡ç†æµç¨‹**ï¼šå‰ç«¯æª¢æŸ¥ â†’ FastAPI é©—è­‰ â†’ `user_ai_quotas` è¡¨ â†’ å›å‚³å‰©é¤˜é…é¡

---

**æ–‡æª”ç‰ˆæœ¬**ï¼š4.0
**å»ºç«‹æ—¥æœŸ**ï¼š2025-01-10
**æ›´æ–°æ—¥æœŸ**ï¼š2025-10-13
**è®Šæ›´è¨˜éŒ„**ï¼š
- v4.0: **è¨ªå®¢ç³»çµ±èˆ‡å…¬é–‹æ­Œæ›²** - æ–°å¢è¨ªå®¢åŠŸèƒ½èˆ‡å…¬é–‹åˆ†äº«æ©Ÿåˆ¶ â­
  - **æ–°å¢éœ€æ±‚ 31-35**ï¼šè¨ªå®¢ç€è¦½å…¬é–‹æ­Œæ›²ã€å…¬é–‹/ç§å¯†æ­Œæ›²æ§åˆ¶ã€è¨ªå®¢æ’­æ”¾æ¸…å–®ï¼ˆlocalStorageï¼‰ã€è¨»å†Šä½¿ç”¨è€…æ’­æ”¾æ¸…å–®ï¼ˆç„¡é™åˆ¶ï¼‰ã€è¨ªå®¢è½‰è¨»å†Šä½¿ç”¨è€…çš„æ’­æ”¾æ¸…å–®é·ç§»
  - **è³‡æ–™åº«è®Šæ›´**ï¼š
    - `user_rhythm_presets` è¡¨æ–°å¢ `is_public` æ¬„ä½ï¼ˆå…¬é–‹/ç§å¯†æ¨™è¨˜ï¼‰
    - æ–°å¢ç´¢å¼•ï¼š`idx_user_rhythm_presets_public`ï¼ˆå…¬é–‹æ­Œæ›²ç´¢å¼•ï¼‰
    - æ–°å¢ç´¢å¼•ï¼š`idx_user_rhythm_presets_system`ï¼ˆç³»çµ±é è¨­ç´¢å¼•ï¼‰
    - æ›´æ–° RLS Policiesï¼šæ”¯æ´è¨ªå®¢æŸ¥çœ‹å…¬é–‹æ­Œæ›²ã€ç³»çµ±é è¨­æ­Œæ›²
  - **API ç«¯é»æ›´æ–°**ï¼š
    - æ–°å¢ `GET /api/v1/music/presets/public`ï¼ˆè¨ªå®¢å¯ç”¨ï¼ŒæŸ¥çœ‹å…¬é–‹æ­Œæ›²ï¼‰
    - æ–°å¢ `POST /api/v1/playlists/import-guest`ï¼ˆåŒ¯å…¥è¨ªå®¢æ’­æ”¾æ¸…å–®ï¼‰
    - æ›´æ–° `POST /api/v1/music/presets`ï¼ˆæ”¯æ´ `isPublic` åƒæ•¸ï¼‰
    - æ›´æ–° `PUT /api/v1/music/presets/{preset_id}`ï¼ˆæ”¯æ´æ›´æ–° `isPublic` ç‹€æ…‹ï¼‰
  - **å‰ç«¯åŠŸèƒ½æ–°å¢**ï¼š
    - localStorage æ’­æ”¾æ¸…å–®ç®¡ç†ï¼ˆè¨ªå®¢å°ˆç”¨ï¼Œä¸Šé™ 4 é¦–æ­Œæ›²ï¼‰
    - è¨ªå®¢è½‰è¨»å†Šä½¿ç”¨è€…æ™‚çš„æ’­æ”¾æ¸…å–®åŒ¯å…¥æµç¨‹
    - å…¬é–‹/ç§å¯†æ­Œæ›²åˆ‡æ› UIï¼ˆå„²å­˜å°è©±æ¡†ä¸­çš„å‹¾é¸æ¡†ï¼‰
    - è¨ªå®¢é™åˆ¶æç¤º UIï¼ˆæ’­æ”¾æ¸…å–®å·²æ»¿æç¤ºã€è¨»å†Šå°å¼•ï¼‰
  - **æ¬Šé™å°æ¯”è¡¨**ï¼šæ–°å¢è¨ªå®¢ vs è¨»å†Šä½¿ç”¨è€…åŠŸèƒ½å°æ¯”è¡¨
  - **æ­Œæ›²å¯è¦‹æ€§è¦å‰‡**ï¼šæ˜ç¢ºå®šç¾©è¨ªå®¢å’Œè¨»å†Šä½¿ç”¨è€…çš„æ­Œæ›²æŸ¥çœ‹æ¬Šé™
- v3.0: **æ¶æ§‹é‡æ§‹** - Pattern-Based æ’­æ”¾ç³»çµ±æ•´åˆ â­
  - **æ–°å¢éœ€æ±‚ 28-30**ï¼šPattern-Based æ’­æ”¾æ¸…å–®ç®¡ç†ã€ç³»çµ±é è¨­ Patternã€æ’­æ”¾å™¨æ•´åˆç¯€å¥æ’­æ”¾
  - **æ›´æ–°éœ€æ±‚ 3**ï¼šæ¨™è¨˜ç‚ºå·²æ£„ç”¨ï¼Œæ”¹ç”¨ Pattern-Based æ’­æ”¾æ¸…å–®ï¼ˆéœ€æ±‚ 28ï¼‰
  - **è³‡æ–™åº«è®Šæ›´**ï¼š
    - æ–°å¢ `playlist_patterns` è¡¨ï¼ˆå–ä»£ `playlist_tracks`ï¼‰
    - æ›´æ–° `user_rhythm_presets` è¡¨ï¼ˆæ–°å¢ `is_system_preset`ã€`description` æ¬„ä½ï¼‰
    - åˆªé™¤ `music_tracks` è¡¨ï¼ˆä¸å†ä½¿ç”¨å¤–éƒ¨éŸ³æ¨‚æª”æ¡ˆï¼‰
    - åˆªé™¤ `playlist_tracks` è¡¨ï¼ˆæ”¹ç”¨ `playlist_patterns`ï¼‰
  - **API ç«¯é»æ›´æ–°**ï¼š
    - æ–°å¢ 13 å€‹ Pattern-Based API ç«¯é»
    - åˆªé™¤ 5 å€‹åŸºæ–¼éŸ³æ¨‚æª”æ¡ˆçš„ API ç«¯é»
  - **ç³»çµ±é è¨­ Pattern**ï¼šæ–°å¢ 5 å€‹ç³»çµ±é è¨­ï¼ˆTechnoã€Houseã€Trapã€Breakbeatã€Minimalï¼‰
  - **æ¶æ§‹åœ–æ›´æ–°**ï¼šåæ˜  Pattern â†’ Playlist â†’ Player è³‡æ–™æµ
  - **æ’­æ”¾å™¨é‚è¼¯**ï¼šæ–°å¢ PlaylistPlayer é¡åˆ¥å¯¦ä½œï¼ˆå¾ªç’°æ’­æ”¾ã€éš¨æ©Ÿæ’­æ”¾ã€Pattern åˆ‡æ›ï¼‰
- v2.0: **é‡å¤§æ›´æ–°** - æ–°å¢ç¨ç«‹ç¯€å¥ç·¨è¼¯å™¨ç³»çµ±ï¼ˆç³»çµ± Bï¼‰
  - æ–°å¢éœ€æ±‚ 20-27ï¼šç¨ç«‹é é¢è·¯ç”±ã€16 æ­¥é©ŸéŸ³åºå™¨ã€AI ç”Ÿæˆã€Preset ç³»çµ±ã€Web Audio API åˆæˆå™¨ã€å¾Œç«¯ APIã€UI/UX
  - æ–°å¢è³‡æ–™åº«çµæ§‹ï¼š`user_rhythm_presets` è¡¨ã€`user_ai_quotas` é…é¡æ¬„ä½
  - æ–°å¢æŠ€è¡“å †ç–Šï¼šFastAPI å¾Œç«¯ã€Supabase Authã€AI Provider æ•´åˆ
  - æ–°å¢éŸ¿æ‡‰å¼ä½ˆå±€è¦æ ¼ï¼šç¯€å¥ç·¨è¼¯å™¨æ¡Œé¢/æ‰‹æ©Ÿç‰ˆ
  - æ›´æ–°ç³»çµ±æ¶æ§‹åœ–ï¼šå‰å°æ’­æ”¾å™¨ + å¾Œå°ç¯€å¥ç·¨è¼¯å™¨åˆ†é›¢
- v1.3: æ–°å¢éœ€æ±‚ 13ï¼ˆAI é©…å‹•éŸ³æ¨‚ç”Ÿæˆï¼‰ã€éœ€æ±‚ 14ï¼ˆLLM Provider æ•´åˆï¼‰ã€éœ€æ±‚ 15ï¼ˆWeb Audio API ç¨‹åºå¼éŸ³æ¨‚ç”Ÿæˆå¼•æ“ï¼‰
- v1.2: ä¿®æ­£å…ƒä»¶è§’è‰²å®šç¾© - Drawer ç‚ºä¸»æ’­æ”¾å™¨ä»‹é¢ã€Sheet ç‚ºæ’­æ”¾æ¸…å–®å½ˆçª—
- v1.1: æ–°å¢éœ€æ±‚ 11ï¼ˆç§»é™¤è‡ªå‹•å ´æ™¯éŸ³æ¨‚ï¼‰å’Œéœ€æ±‚ 12ï¼ˆSheet/Drawer å½ˆçª—æ’­æ”¾æ¸…å–®ä»‹é¢ï¼‰
- v1.0: åˆå§‹ç‰ˆæœ¬ï¼ˆ10 å€‹éœ€æ±‚ï¼‰

**èªè¨€**ï¼šç¹é«”ä¸­æ–‡ï¼ˆzh-TWï¼‰

---

## ğŸ“‹ éœ€æ±‚æ‘˜è¦ï¼ˆv4.0ï¼‰

### æ ¸å¿ƒéœ€æ±‚ï¼ˆ35 å€‹ï¼‰
- **éœ€æ±‚ 1-2**ï¼šéŸ³æ¨‚æ¨¡å¼ç€è¦½èˆ‡æ’­æ”¾æ§åˆ¶ï¼ˆä¿ç•™ï¼‰
- **éœ€æ±‚ 3**ï¼šæ’­æ”¾æ¸…å–®ç®¡ç†ï¼ˆå·²æ£„ç”¨ â†’ è¦‹éœ€æ±‚ 28ï¼‰âš ï¸
- **éœ€æ±‚ 4-12**ï¼šUI/UXã€éŸ³é‡æ§åˆ¶ã€ç‹€æ…‹æŒä¹…åŒ–ã€éµç›¤å°èˆªã€æ•ˆèƒ½ã€ç„¡éšœç¤™ã€ç§»é™¤è‡ªå‹•éŸ³æ¨‚ã€Sheet å½ˆçª—ï¼ˆä¿ç•™ï¼‰
- **éœ€æ±‚ 20-27**ï¼šç¯€å¥ç·¨è¼¯å™¨ç³»çµ±ï¼ˆç¨ç«‹é é¢ã€éŸ³åºå™¨ã€AI ç”Ÿæˆã€Presetã€åˆæˆå™¨ã€APIã€UI/UXï¼‰
- **éœ€æ±‚ 28**ï¼šæ’­æ”¾æ¸…å–®ç®¡ç†ï¼ˆPattern-Basedï¼‰â­ v3.0
- **éœ€æ±‚ 29**ï¼šç³»çµ±é è¨­ Pattern ç®¡ç† â­ v3.0
- **éœ€æ±‚ 30**ï¼šæ’­æ”¾å™¨æ•´åˆç¯€å¥æ’­æ”¾ â­ v3.0
- **éœ€æ±‚ 31**ï¼šè¨ªå®¢ç€è¦½å…¬é–‹æ­Œæ›² â­ v4.0 æ–°å¢
- **éœ€æ±‚ 32**ï¼šä½¿ç”¨è€…å‰µä½œæ­Œæ›²æ™‚é¸æ“‡å…¬é–‹/ç§å¯† â­ v4.0 æ–°å¢
- **éœ€æ±‚ 33**ï¼šè¨ªå®¢æ’­æ”¾æ¸…å–®ï¼ˆlocalStorageï¼‰ â­ v4.0 æ–°å¢
- **éœ€æ±‚ 34**ï¼šè¨»å†Šä½¿ç”¨è€…æ’­æ”¾æ¸…å–®ï¼ˆç„¡é™åˆ¶ï¼‰ â­ v4.0 æ–°å¢
- **éœ€æ±‚ 35**ï¼šè¨ªå®¢è½‰è¨»å†Šä½¿ç”¨è€…æ™‚çš„æ’­æ”¾æ¸…å–®é·ç§» â­ v4.0 æ–°å¢

### æ ¸å¿ƒè®Šæ›´ï¼ˆv4.0ï¼‰
1. **è¨ªå®¢ç³»çµ±** â­ æ–°å¢
   - è¨ªå®¢å¯ç€è¦½ç³»çµ±é è¨­æ­Œæ›²ï¼ˆ5 é¦–ï¼‰å’Œå…¬é–‹çš„ä½¿ç”¨è€…å‰µä½œæ­Œæ›²
   - è¨ªå®¢å¯å»ºç«‹ localStorage æ’­æ”¾æ¸…å–®ï¼ˆä¸Šé™ 1 å€‹æ¸…å–®ã€4 é¦–æ­Œæ›²ï¼‰
   - è¨ªå®¢ç„¡æ³•ä½¿ç”¨ç¯€å¥ç·¨è¼¯å™¨å’Œ AI ç”ŸæˆåŠŸèƒ½
2. **å…¬é–‹/ç§å¯†æ­Œæ›²æ©Ÿåˆ¶** â­ æ–°å¢
   - `user_rhythm_presets` æ–°å¢ `is_public` æ¬„ä½
   - ä½¿ç”¨è€…å¯åœ¨å„²å­˜æ­Œæ›²æ™‚é¸æ“‡å…¬é–‹/ç§å¯†
   - å…¬é–‹æ­Œæ›²å¯è¢«æ‰€æœ‰äººï¼ˆå«è¨ªå®¢ï¼‰æŸ¥çœ‹å’Œä½¿ç”¨
   - ç§å¯†æ­Œæ›²åªæœ‰æ“æœ‰è€…å¯è¦‹
3. **RLS Policies æ›´æ–°** â­ æ–°å¢
   - è¨ªå®¢å¯æŸ¥çœ‹ï¼šç³»çµ±é è¨­æ­Œæ›² (`is_system_preset = true`) + å…¬é–‹æ­Œæ›² (`is_public = true`)
   - è¨»å†Šä½¿ç”¨è€…å¯æŸ¥çœ‹ï¼šç³»çµ±é è¨­ + å…¬é–‹æ­Œæ›² + è‡ªå·±çš„ç§å¯†æ­Œæ›²
4. **æ’­æ”¾æ¸…å–®é·ç§»æµç¨‹** â­ æ–°å¢
   - è¨ªå®¢è¨»å†Šå¾Œå¯é¸æ“‡åŒ¯å…¥ localStorage æ’­æ”¾æ¸…å–®åˆ°è³‡æ–™åº«
   - åŒ¯å…¥å¾Œè‡ªå‹•æ¸…é™¤ localStorage è³‡æ–™

### æ ¸å¿ƒè®Šæ›´ï¼ˆv3.0ï¼‰
1. **åˆªé™¤æ­Œæ›²ï¼ˆTracksï¼‰æ¦‚å¿µ** âš ï¸
   - ç§»é™¤ `music_tracks` è¡¨
   - ç§»é™¤ `POST /api/v1/playlists/tracks` ç­‰ç›¸é—œ API
2. **Pattern å³æ­Œæ›²** â­
   - `user_rhythm_presets` è¡¨çš„æ¯ä¸€ç­†è¨˜éŒ„ = ä¸€é¦–ã€Œæ­Œæ›²ã€
   - æ’­æ”¾æ¸…å–®åŒ…å«å¤šå€‹ pattern å¼•ç”¨ï¼ˆ`playlist_patterns` è¡¨ï¼‰
3. **ç³»çµ±é è¨­æ­Œæ›²** â­
   - 5 å€‹ç³»çµ±é è¨­ patternï¼ˆTechnoã€Houseã€Trapã€Breakbeatã€Minimalï¼‰
   - ç³»çµ±å¸³è™Ÿï¼ˆ`00000000-0000-0000-0000-000000000000`ï¼‰æ“æœ‰
   - æ‰€æœ‰ä½¿ç”¨è€…éƒ½å¯ä»¥åŠ å…¥æ’­æ”¾æ¸…å–®
