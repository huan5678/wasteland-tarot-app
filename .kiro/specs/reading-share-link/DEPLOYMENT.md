# Reading Share Link - Deployment Checklist

## éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®

ä½¿ç”¨æ­¤æ¸…å–®ç¢ºä¿åˆ†äº«åŠŸèƒ½åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­å®‰å…¨ä¸”æ­£ç¢ºåœ°é‹è¡Œã€‚

---

## ğŸ“‹ Phase 1: è³‡æ–™åº«é·ç§»

### 1.1 æ¸¬è©¦ç’°å¢ƒé©—è­‰

- [ ] åœ¨æ¸¬è©¦è³‡æ–™åº«åŸ·è¡Œé·ç§»
  ```bash
  cd backend
  alembic upgrade head
  ```

- [ ] é©—è­‰ `completed_readings` è¡¨æ ¼çµæ§‹
  ```sql
  \d completed_readings
  ```

- [ ] ç¢ºèªä»¥ä¸‹è®Šæ›´ï¼š
  - [ ] `share_token` æ¬„ä½å·²æ·»åŠ  (UUID type)
  - [ ] `share_token` æ¬„ä½å…è¨± NULL
  - [ ] `share_token` æœ‰ UNIQUE constraint
  - [ ] `idx_completed_readings_share_token` ç´¢å¼•å·²å‰µå»º

### 1.2 ç”Ÿç”¢ç’°å¢ƒé·ç§»

- [ ] å‚™ä»½ç”Ÿç”¢è³‡æ–™åº«
  ```bash
  pg_dump -U postgres -d wasteland_tarot > backup_$(date +%Y%m%d_%H%M%S).sql
  ```

- [ ] åœ¨ç¶­è­·æ™‚æ®µåŸ·è¡Œé·ç§»
- [ ] é©—è­‰é·ç§»æˆåŠŸ
- [ ] è¨˜éŒ„é·ç§»æ™‚é–“å’Œçµæœ

### 1.3 å›æ»¾è¨ˆç•«

- [ ] æº–å‚™å›æ»¾è…³æœ¬
  ```bash
  alembic downgrade -1
  ```

- [ ] æ¸¬è©¦å›æ»¾æµç¨‹
- [ ] è¨˜éŒ„å›æ»¾æ­¥é©Ÿ

---

## ğŸ” Phase 2: å®‰å…¨æª¢æŸ¥

### 2.1 è³‡æ–™éš±ç§

- [ ] é©—è­‰ `ShareService._filter_private_fields()` æ­£ç¢ºéæ¿¾ä»¥ä¸‹æ¬„ä½ï¼š
  - [ ] `user_id`
  - [ ] `user_email`
  - [ ] `user_name`
  - [ ] `user` (relationship)

- [ ] åŸ·è¡Œéš±ç§æ¸¬è©¦
  ```bash
  cd backend
  pytest tests/unit/test_share_service.py::test_privacy_filtering -v
  ```

- [ ] æ‰‹å‹•é©—è­‰ API å›æ‡‰ä¸å«æ•æ„Ÿè³‡æ–™
  ```bash
  curl http://localhost:8000/api/v1/share/{token} | jq
  ```

### 2.2 SQL Injection é˜²è­·

- [ ] ç¢ºèªæ‰€æœ‰æŸ¥è©¢ä½¿ç”¨ ORM æˆ–åƒæ•¸åŒ–æŸ¥è©¢
- [ ] åŸ·è¡Œ SQL injection æ¸¬è©¦
  ```bash
  playwright test tests/e2e/reading-share-security.spec.ts -g "SQL Injection"
  ```

- [ ] é©—è­‰ UUID åƒæ•¸é©—è­‰æ­£å¸¸é‹ä½œ

### 2.3 XSS é˜²è­·

- [ ] ç¢ºèªå‰ç«¯ä½¿ç”¨ React (è‡ªå‹•è½‰ç¾©)
- [ ] åŸ·è¡Œ XSS æ¸¬è©¦
  ```bash
  playwright test tests/e2e/reading-share-security.spec.ts -g "XSS"
  ```

- [ ] (å»ºè­°) è¨­å®š Content-Security-Policy header

### 2.4 æˆæ¬Šæª¢æŸ¥

- [ ] æ¸¬è©¦æœªç™»å…¥ä½¿ç”¨è€…ç„¡æ³•ç”Ÿæˆåˆ†äº«é€£çµ (401/403)
- [ ] æ¸¬è©¦éæ“æœ‰è€…ç„¡æ³•åˆ†äº«ä»–äººçš„å åœ (403)
- [ ] æ¸¬è©¦å…¬é–‹ç«¯é»ç„¡éœ€æˆæ¬Š (GET /share/{token})

---

## ğŸ§ª Phase 3: æ¸¬è©¦é©—è­‰

### 3.1 å–®å…ƒæ¸¬è©¦

- [ ] åŸ·è¡Œå¾Œç«¯å–®å…ƒæ¸¬è©¦
  ```bash
  cd backend
  pytest tests/unit/test_share_service.py -v
  pytest tests/api/test_share_api.py -v
  ```

- [ ] ç¢ºèªæ¸¬è©¦è¦†è“‹ç‡ â‰¥ 80%
  ```bash
  pytest --cov=app/services/share_service --cov=app/api/v1/endpoints/share
  ```

### 3.2 E2E æ¸¬è©¦

- [ ] åŸ·è¡Œå®Œæ•´ E2E æ¸¬è©¦
  ```bash
  playwright test tests/e2e/reading-share.spec.ts
  ```

- [ ] é©—è­‰ä»¥ä¸‹å ´æ™¯ï¼š
  - [ ] å®Œæ•´åˆ†äº«æµç¨‹ (ç”Ÿæˆ â†’ è¤‡è£½ â†’ è¨ªå•)
  - [ ] éš±ç§é©—è­‰ (ç„¡ user_id)
  - [ ] åˆªé™¤å åœä½¿åˆ†äº«é€£çµå¤±æ•ˆ
  - [ ] ç„¡æ•ˆ token è™•ç†
  - [ ] å†ªç­‰æ€§ (é‡è¤‡åˆ†äº«è¿”å›ç›¸åŒ token)

### 3.3 å®‰å…¨æ¸¬è©¦

- [ ] åŸ·è¡Œå®‰å…¨æ¸¬è©¦
  ```bash
  playwright test tests/e2e/reading-share-security.spec.ts
  ```

- [ ] ç¢ºèªæ‰€æœ‰å®‰å…¨æ¸¬è©¦é€šé

### 3.4 æ‰‹å‹•æ¸¬è©¦

- [ ] å‰µå»ºæ¸¬è©¦å åœ
- [ ] ç”Ÿæˆåˆ†äº«é€£çµ
- [ ] è¤‡è£½é€£çµ
- [ ] åœ¨ç„¡ç—•è¦–çª—é–‹å•Ÿé€£çµ
- [ ] é©—è­‰è³‡æ–™æ­£ç¢ºé¡¯ç¤º
- [ ] åˆªé™¤å åœ
- [ ] é©—è­‰åˆ†äº«é€£çµå¤±æ•ˆ (404)

---

## âš™ï¸ Phase 4: ç’°å¢ƒé…ç½®

### 4.1 ç’°å¢ƒè®Šæ•¸

- [ ] è¨­å®š `FRONTEND_URL`
  ```bash
  # .env
  FRONTEND_URL=https://wasteland-tarot.com
  ```

- [ ] é©—è­‰è¨­å®šç”Ÿæ•ˆ
  ```python
  from app.config import settings
  print(settings.frontend_url)
  ```

### 4.2 CORS è¨­å®š

- [ ] ç¢ºèª CORS å…è¨±å‰ç«¯åŸŸå
  ```python
  # backend/app/main.py
  origins = [
      settings.frontend_url,
      "http://localhost:3000",  # é–‹ç™¼ç’°å¢ƒ
  ]
  ```

### 4.3 è³‡æ–™åº«é€£ç·šæ± 

- [ ] æª¢æŸ¥è³‡æ–™åº«é€£ç·šæ± å¤§å°è¶³å¤ 
- [ ] ç›£æ§é€£ç·šä½¿ç”¨æƒ…æ³

---

## ğŸ“Š Phase 5: æ•ˆèƒ½å„ªåŒ–

### 5.1 è³‡æ–™åº«ç´¢å¼•

- [ ] ç¢ºèª `share_token` ç´¢å¼•å­˜åœ¨ä¸”æœ‰æ•ˆ
  ```sql
  SELECT * FROM pg_indexes WHERE tablename = 'completed_readings' AND indexname LIKE '%share_token%';
  ```

- [ ] åŸ·è¡Œ EXPLAIN ANALYZE æª¢æŸ¥æŸ¥è©¢æ•ˆèƒ½
  ```sql
  EXPLAIN ANALYZE
  SELECT * FROM completed_readings WHERE share_token = 'uuid-here';
  ```

### 5.2 å¿«å–ç­–ç•¥ (å¯é¸)

- [ ] è€ƒæ…®å¯¦ä½œ Redis å¿«å–
- [ ] è¨­å®šåˆç†çš„ TTL

### 5.3 CDN è¨­å®š (å¯é¸)

- [ ] å¦‚æœä½¿ç”¨ CDNï¼Œç¢ºä¿ `/share/*` è·¯å¾‘å¯å¿«å–
- [ ] è¨­å®šé©ç•¶çš„ Cache-Control headers

---

## ğŸš€ Phase 6: éƒ¨ç½²æ­¥é©Ÿ

### 6.1 æº–å‚™å·¥ä½œ

- [ ] é€šçŸ¥åœ˜éšŠå³å°‡éƒ¨ç½²
- [ ] å‚™ä»½ç”Ÿç”¢è³‡æ–™åº«
- [ ] è¨­å®šç¶­è­·é é¢ (å¦‚éœ€è¦)

### 6.2 å¾Œç«¯éƒ¨ç½²

1. [ ] æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
   ```bash
   git pull origin main
   ```

2. [ ] åŸ·è¡Œè³‡æ–™åº«é·ç§»
   ```bash
   cd backend
   alembic upgrade head
   ```

3. [ ] é‡å•Ÿå¾Œç«¯æœå‹™
   ```bash
   systemctl restart wasteland-tarot-backend
   ```

4. [ ] é©—è­‰æœå‹™é‹è¡Œ
   ```bash
   curl http://localhost:8000/health
   ```

### 6.3 å‰ç«¯éƒ¨ç½²

1. [ ] æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
   ```bash
   git pull origin main
   ```

2. [ ] å®‰è£ä¾è³´
   ```bash
   npm install
   ```

3. [ ] å»ºç½®ç”Ÿç”¢ç‰ˆæœ¬
   ```bash
   npm run build
   ```

4. [ ] éƒ¨ç½²åˆ°ä¼ºæœå™¨
   ```bash
   npm run start
   # æˆ–ä½¿ç”¨ PM2
   pm2 restart wasteland-tarot-frontend
   ```

5. [ ] é©—è­‰å‰ç«¯é‹è¡Œ
   ```bash
   curl https://wasteland-tarot.com
   ```

### 6.4 é©—è­‰éƒ¨ç½²

- [ ] æ¸¬è©¦åˆ†äº«åŠŸèƒ½é‹ä½œ
- [ ] æª¢æŸ¥éŒ¯èª¤æ—¥èªŒ
- [ ] ç›£æ§ç³»çµ±è³‡æºä½¿ç”¨

---

## ğŸ“ˆ Phase 7: ç›£æ§èˆ‡å‘Šè­¦

### 7.1 æ—¥èªŒç›£æ§

- [ ] ç¢ºèªåˆ†äº«ç›¸é—œæ—¥èªŒæ­£å¸¸è¨˜éŒ„
- [ ] è¨­å®šéŒ¯èª¤æ—¥èªŒå‘Šè­¦

### 7.2 æ•ˆèƒ½ç›£æ§

- [ ] ç›£æ§ API å›æ‡‰æ™‚é–“
  - Target: `POST /readings/{id}/share` < 500ms
  - Target: `GET /share/{token}` < 300ms

- [ ] ç›£æ§è³‡æ–™åº«æŸ¥è©¢æ•ˆèƒ½

### 7.3 ä½¿ç”¨é‡ç›£æ§

- [ ] è¿½è¹¤åˆ†äº«é€£çµç”Ÿæˆæ¬¡æ•¸
- [ ] è¿½è¹¤åˆ†äº«é€£çµè¨ªå•æ¬¡æ•¸
- [ ] è¨­å®šç•°å¸¸ä½¿ç”¨å‘Šè­¦ (é˜²æ­¢æ¿«ç”¨)

### 7.4 éŒ¯èª¤ç›£æ§

- [ ] ç›£æ§ 404 éŒ¯èª¤ç‡ (å¯èƒ½è¡¨ç¤ºå¤§é‡ç„¡æ•ˆé€£çµ)
- [ ] ç›£æ§ 403 éŒ¯èª¤ç‡ (å¯èƒ½è¡¨ç¤ºæˆæ¬Šå•é¡Œ)
- [ ] ç›£æ§ 500 éŒ¯èª¤ (ç³»çµ±å•é¡Œ)

---

## ğŸ”§ Phase 8: å›æ»¾è¨ˆç•«

### 8.1 å›æ»¾è§¸ç™¼æ¢ä»¶

åœ¨ä»¥ä¸‹æƒ…æ³è€ƒæ…®å›æ»¾ï¼š

- [ ] å¤§é‡ 500 éŒ¯èª¤ (éŒ¯èª¤ç‡ > 5%)
- [ ] è³‡æ–™éš±ç§æ´©æ¼
- [ ] é—œéµåŠŸèƒ½å¤±æ•ˆ
- [ ] æ•ˆèƒ½åš´é‡é™ä½ (å›æ‡‰æ™‚é–“ > 3s)

### 8.2 å›æ»¾æ­¥é©Ÿ

1. [ ] å›æ»¾å‰ç«¯éƒ¨ç½²
   ```bash
   git checkout {previous-commit}
   npm run build
   pm2 restart wasteland-tarot-frontend
   ```

2. [ ] å›æ»¾å¾Œç«¯éƒ¨ç½²
   ```bash
   git checkout {previous-commit}
   systemctl restart wasteland-tarot-backend
   ```

3. [ ] å›æ»¾è³‡æ–™åº«é·ç§» (è¬¹æ…ï¼)
   ```bash
   cd backend
   alembic downgrade -1
   ```

4. [ ] é©—è­‰å›æ»¾æˆåŠŸ

5. [ ] é€šçŸ¥åœ˜éšŠå’Œä½¿ç”¨è€…

---

## ğŸ“ Phase 9: æ–‡ä»¶æ›´æ–°

### 9.1 API æ–‡ä»¶

- [ ] æ›´æ–° Swagger/OpenAPI æ–‡ä»¶
- [ ] ç¢ºä¿ API.md èˆ‡å¯¦ä½œä¸€è‡´
- [ ] æ›´æ–° Postman collection (å¦‚æœ‰)

### 9.2 ä½¿ç”¨è€…æ–‡ä»¶

- [ ] æ›´æ–°ä½¿ç”¨è€…æ‰‹å†Š
- [ ] å‰µå»ºåˆ†äº«åŠŸèƒ½æ•™å­¸
- [ ] æ›´æ–° FAQ

### 9.3 å…§éƒ¨æ–‡ä»¶

- [ ] æ›´æ–°ç³»çµ±æ¶æ§‹åœ–
- [ ] è¨˜éŒ„éƒ¨ç½²æ—¥èªŒ
- [ ] æ›´æ–° README

---

## âœ… Phase 10: éƒ¨ç½²å¾Œé©—è­‰

### 10.1 ç…™éœ§æ¸¬è©¦ (Smoke Test)

åœ¨ç”Ÿç”¢ç’°å¢ƒåŸ·è¡Œä»¥ä¸‹æ¸¬è©¦ï¼š

- [ ] ä½¿ç”¨è€…å¯ä»¥ç™»å…¥
- [ ] å¯ä»¥å‰µå»ºæ–°å åœ
- [ ] å¯ä»¥ç”Ÿæˆåˆ†äº«é€£çµ
- [ ] åˆ†äº«é€£çµå¯ä»¥åœ¨ç„¡ç—•è¦–çª—è¨ªå•
- [ ] åˆ†äº«è³‡æ–™ä¸å«å€‹äººè³‡è¨Š
- [ ] åˆªé™¤å åœå¾Œåˆ†äº«é€£çµå¤±æ•ˆ

### 10.2 æ•ˆèƒ½é©—è­‰

- [ ] API å›æ‡‰æ™‚é–“åœ¨å¯æ¥å—ç¯„åœå…§
- [ ] è³‡æ–™åº«æŸ¥è©¢ä½¿ç”¨ç´¢å¼•
- [ ] ç„¡è¨˜æ†¶é«”æ´©æ¼

### 10.3 å®‰å…¨é©—è­‰

- [ ] ç„¡ SQL injection æ¼æ´
- [ ] ç„¡ XSS æ¼æ´
- [ ] éš±ç§è³‡æ–™æ­£ç¢ºéæ¿¾
- [ ] æˆæ¬Šæª¢æŸ¥æ­£å¸¸é‹ä½œ

### 10.4 ä½¿ç”¨è€…é©—è­‰

- [ ] é‚€è«‹å…§éƒ¨æ¸¬è©¦äººå“¡æ¸¬è©¦
- [ ] æ”¶é›†åé¥‹
- [ ] ä¿®å¾©ç·Šæ€¥å•é¡Œ

---

## ğŸ› Phase 11: å·²çŸ¥å•é¡Œèˆ‡é™åˆ¶

### 11.1 å·²çŸ¥é™åˆ¶

è¨˜éŒ„å·²çŸ¥ä½†å¯æ¥å—çš„é™åˆ¶ï¼š

- [ ] åˆ†äº«é€£çµç„¡æ³•æ’¤éŠ·ï¼ˆé™¤éåˆªé™¤å åœï¼‰
- [ ] åˆ†äº«é€£çµæ°¸ä¹…æœ‰æ•ˆ
- [ ] ç„¡æ³•è¿½è¹¤èª°æŸ¥çœ‹äº†é€£çµ
- [ ] ç„¡æ³•è¨­å®šéæœŸæ™‚é–“

### 11.2 æœªä¾†æ”¹é€²

è¦åŠƒæœªä¾†ç‰ˆæœ¬å¯èƒ½çš„æ”¹é€²ï¼š

- [ ] æ·»åŠ åˆ†äº«é€£çµéæœŸæ™‚é–“
- [ ] æ·»åŠ è¨ªå•çµ±è¨ˆ
- [ ] æ·»åŠ æ’¤éŠ·åˆ†äº«åŠŸèƒ½
- [ ] æ·»åŠ åˆ†äº«æ¬Šé™è¨­å®šï¼ˆåƒ…ç‰¹å®šäººå¯è¦‹ï¼‰

---

## ğŸ“ Phase 12: æ”¯æ´èˆ‡è¯çµ¡

### 12.1 ç·Šæ€¥è¯çµ¡

- **æŠ€è¡“è² è²¬äºº**: [Name] - [Email]
- **è³‡æ–™åº«ç®¡ç†å“¡**: [Name] - [Email]
- **DevOps**: [Name] - [Email]

### 12.2 ç›£æ§å„€è¡¨æ¿

- [ ] æ‡‰ç”¨ç›£æ§: [URL]
- [ ] éŒ¯èª¤è¿½è¹¤: [URL]
- [ ] æ•ˆèƒ½ç›£æ§: [URL]

### 12.3 æ–‡ä»¶é€£çµ

- API æ–‡ä»¶: `.kiro/specs/reading-share-link/API.md`
- éœ€æ±‚æ–‡ä»¶: `.kiro/specs/reading-share-link/requirements.md`
- è¨­è¨ˆæ–‡ä»¶: `.kiro/specs/reading-share-link/design.md`
- ä»»å‹™æ¸…å–®: `.kiro/specs/reading-share-link/tasks.md`

---

## âœ¨ æœ€çµ‚æª¢æŸ¥

éƒ¨ç½²å®Œæˆå¾Œï¼Œç¢ºèªä»¥ä¸‹æ‰€æœ‰é …ç›®ï¼š

- [ ] âœ… æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] âœ… è³‡æ–™åº«é·ç§»æˆåŠŸ
- [ ] âœ… å‰å¾Œç«¯éƒ¨ç½²å®Œæˆ
- [ ] âœ… ç…™éœ§æ¸¬è©¦é€šé
- [ ] âœ… ç›£æ§å’Œå‘Šè­¦å·²è¨­å®š
- [ ] âœ… æ–‡ä»¶å·²æ›´æ–°
- [ ] âœ… åœ˜éšŠå·²é€šçŸ¥
- [ ] âœ… ä½¿ç”¨è€…å¯ä»¥æ­£å¸¸ä½¿ç”¨åˆ†äº«åŠŸèƒ½
- [ ] âœ… ç„¡éš±ç§è³‡æ–™æ´©æ¼
- [ ] âœ… ç„¡å®‰å…¨æ¼æ´

---

## ğŸ“… éƒ¨ç½²è¨˜éŒ„

### éƒ¨ç½²æ—¥æœŸ: _______________

### éƒ¨ç½²äººå“¡: _______________

### ç‰ˆæœ¬è™Ÿ: _______________

### éƒ¨ç½²çµæœ:
- [ ] æˆåŠŸ
- [ ] éƒ¨åˆ†æˆåŠŸï¼ˆèªªæ˜ï¼š_______________ï¼‰
- [ ] å¤±æ•—ï¼ˆèªªæ˜ï¼š_______________ï¼‰

### å•é¡Œè¨˜éŒ„:


### å¾ŒçºŒè¡Œå‹•:


---

**éƒ¨ç½²å®Œæˆï¼** ğŸ‰

è¨˜å¾—åœ¨éƒ¨ç½²å¾ŒæŒçºŒç›£æ§ç³»çµ±é‹è¡Œç‹€æ³ï¼Œä¸¦åŠæ™‚è™•ç†ä»»ä½•å•é¡Œã€‚
