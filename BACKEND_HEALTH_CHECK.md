# Backend Health Check å¯¦ä½œèªªæ˜

## å•é¡Œ

Zeabur serverless backend ä¼‘çœ å¾Œï¼Œç”¨æˆ¶è¨ªå•ç¶²ç«™æ™‚æœƒé‡åˆ° API è«‹æ±‚å¤±æ•—ï¼ˆ502/503 éŒ¯èª¤ï¼‰ã€‚

## è§£æ±ºæ–¹æ¡ˆ

åœ¨æ‡‰ç”¨å•Ÿå‹•æ™‚å…ˆæª¢æŸ¥å¾Œç«¯å¥åº·ç‹€æ…‹ï¼Œç­‰å¾…å¾Œç«¯å–šé†’å¾Œå†è¼‰å…¥ä¸»æ‡‰ç”¨ã€‚

## å¯¦ä½œå…§å®¹

### 1. Health Check API Route
**æª”æ¡ˆ**: `src/app/api/v1/health/route.ts`

- ç¨ç«‹çš„ health check endpoint
- 10 ç§’è¶…æ™‚æ©Ÿåˆ¶
- éŒ¯èª¤åˆ†é¡è™•ç†ï¼ˆtimeout/unavailableï¼‰

### 2. BackendHealthCheck Provider
**æª”æ¡ˆ**: `src/components/providers/BackendHealthCheck.tsx`

- è‡ªå‹•é‡è©¦æ©Ÿåˆ¶ï¼ˆæœ€å¤š 10 æ¬¡ï¼Œé–“éš” 3 ç§’ï¼‰
- Fallout é¢¨æ ¼ Loading ç•«é¢
- é€²åº¦é¡¯ç¤ºèˆ‡éŒ¯èª¤è™•ç†
- æ‰‹å‹•é‡è©¦é¸é …

### 3. Layout æ•´åˆ
**æª”æ¡ˆ**: `src/app/layout.tsx`

- BackendHealthCheck åŒ…è£¹æ‰€æœ‰å…¶ä»– providers
- ç¢ºä¿å¾Œç«¯å°±ç·’å¾Œæ‰åˆå§‹åŒ–æ‡‰ç”¨

## ä½¿ç”¨æµç¨‹

```
ç”¨æˆ¶è¨ªå•ç¶²ç«™
    â†“
BackendHealthCheck åŸ·è¡Œ
    â†“
æª¢æŸ¥ /api/v1/health
    â†“
    â”œâ”€â†’ å¾Œç«¯å°±ç·’ â†’ ç«‹å³è¼‰å…¥æ‡‰ç”¨ï¼ˆ~200msï¼‰
    â”‚
    â””â”€â†’ å¾Œç«¯ä¼‘çœ  â†’ é¡¯ç¤º Loading
            â†“
        é‡è©¦æª¢æŸ¥ï¼ˆæ¯ 3 ç§’ï¼‰
            â†“
            â”œâ”€â†’ å¾Œç«¯å–šé†’ â†’ è¼‰å…¥æ‡‰ç”¨
            â”‚
            â””â”€â†’ 10 æ¬¡å¤±æ•— â†’ é¡¯ç¤ºéŒ¯èª¤ + é‡è©¦æŒ‰éˆ•
```

## Zeabur éƒ¨ç½²è¨­å®š

### ç’°å¢ƒè®Šæ•¸

ç¢ºä¿åœ¨ Zeabur å‰ç«¯æœå‹™è¨­å®šï¼š

```env
API_BASE_URL=http://backend-service-name.zeabur.internal:8080
```

> **é‡è¦**: ä½¿ç”¨ Zeabur å…§éƒ¨åŸŸåæ ¼å¼ `http://<service-name>.zeabur.internal:<port>`

### å¾Œç«¯æœå‹™

ç¢ºä¿å¾Œç«¯æœ‰ `/health` endpointï¼š

```python
@app.get("/health")
async def health_check():
    return {
        "status": "ğŸŸ¢ Healthy",
        "timestamp": time.time(),
        "components": {...}
    }
```

## æ¸¬è©¦æ–¹æ³•

### Local Testing

```bash
# 1. å•Ÿå‹•å¾Œç«¯
cd backend
uv run uvicorn main:app --reload

# 2. å•Ÿå‹•å‰ç«¯ï¼ˆå¦ä¸€å€‹ terminalï¼‰
bun run dev

# 3. è¨ªå• http://localhost:3000
# é æœŸ: å¿«é€Ÿè¼‰å…¥ï¼ˆ~200msï¼‰

# 4. æ¸¬è©¦ health endpoint
curl http://localhost:3000/api/v1/health
```

### Cold Start æ¨¡æ“¬

```bash
# 1. åœæ­¢å¾Œç«¯æœå‹™
# 2. è¨ªå• http://localhost:3000
# 3. è§€å¯Ÿ Loading ç•«é¢å’Œé‡è©¦æ¬¡æ•¸
# 4. å•Ÿå‹•å¾Œç«¯
# 5. è§€å¯Ÿæ‡‰ç”¨è‡ªå‹•è¼‰å…¥
```

### Production Testing (Zeabur)

```bash
# 1. ç­‰å¾…å¾Œç«¯ä¼‘çœ ï¼ˆ5-10 åˆ†é˜ç„¡è¨ªå•ï¼‰
# 2. è¨ªå•ç¶²ç«™ä»»æ„é é¢
# 3. è§€å¯Ÿ:
#    - Loading ç•«é¢å‡ºç¾
#    - å¾Œç«¯å–šé†’ï¼ˆç´„ 5-15 ç§’ï¼‰
#    - æ‡‰ç”¨æ­£å¸¸è¼‰å…¥
```

## ç‰¹æ€§

âœ… **ç´”å‰ç«¯è§£æ±ºæ–¹æ¡ˆ**: ä¸éœ€ä¿®æ”¹å¾Œç«¯  
âœ… **å…¨åŸŸç”Ÿæ•ˆ**: é©ç”¨æ–¼æ‰€æœ‰é é¢å…¥å£  
âœ… **æ™ºæ…§é‡è©¦**: æœ€å¤š 10 æ¬¡ï¼Œé–“éš” 3 ç§’  
âœ… **ä½¿ç”¨è€…å‹å–„**: æ¸…æ¥šçš„ç‹€æ…‹æç¤ºå’Œé€²åº¦  
âœ… **Fallout é¢¨æ ¼**: ç¬¦åˆç¶²ç«™è¨­è¨ˆèªè¨€  
âœ… **æ•ˆèƒ½å„ªåŒ–**: å¾Œç«¯å·²å–šé†’æ™‚ç„¡å»¶é²  

## æ•ˆèƒ½æŒ‡æ¨™

| æƒ…å¢ƒ | å»¶é²æ™‚é–“ | ä½¿ç”¨è€…é«”é©— |
|-----|---------|----------|
| å¾Œç«¯å·²å–šé†’ | ~200ms | ç„¡æ„ŸçŸ¥ï¼Œç«‹å³è¼‰å…¥ |
| å¾Œç«¯å†·å•Ÿå‹• | 5-15 ç§’ | é¡¯ç¤º Loadingï¼Œé€²åº¦å¯è¦‹ |
| å¾Œç«¯æ•…éšœ | 30 ç§’ | é¡¯ç¤ºéŒ¯èª¤ï¼Œæä¾›é‡è©¦ |

## ç›£æ§å»ºè­°

### è¿½è¹¤æŒ‡æ¨™

1. **Cold Start é »ç‡**: å¤šä¹…ç™¼ç”Ÿä¸€æ¬¡å†·å•Ÿå‹•
2. **å–šé†’æ™‚é–“**: å¹³å‡éœ€è¦å¤šä¹…å–šé†’å¾Œç«¯
3. **å¤±æ•—ç‡**: health check å¤±æ•—æ¯”ä¾‹
4. **é‡è©¦æ¬¡æ•¸**: å¹³å‡éœ€è¦é‡è©¦å¹¾æ¬¡

### å„ªåŒ–æ–¹å‘

1. **Pre-warming**: ä½¿ç”¨ Zeabur æ’ç¨‹ä»»å‹™å®šæ™‚ ping å¾Œç«¯ï¼ˆæ¯ 5 åˆ†é˜ï¼‰
2. **Smart Retry**: å¯¦ä½œæŒ‡æ•¸é€€é¿æ¼”ç®—æ³•
3. **Caching**: å¿«å– health statusï¼ˆ5 ç§’ï¼‰é¿å…é‡è¤‡æª¢æŸ¥
4. **Fallback**: æä¾›é›¢ç·šæ¨¡å¼æˆ–éœæ…‹å…§å®¹

## éƒ¨ç½²æ¸…å–®

- [x] å¯¦ä½œ BackendHealthCheck provider
- [x] å»ºç«‹ /api/v1/health route
- [x] æ•´åˆåˆ° layout.tsx
- [x] æœ¬åœ°æ¸¬è©¦é€šé
- [ ] éƒ¨ç½²åˆ° Zeabur
- [ ] æ¸¬è©¦å†·å•Ÿå‹•å ´æ™¯
- [ ] ç›£æ§æ•ˆèƒ½æŒ‡æ¨™
- [ ] ï¼ˆå¯é¸ï¼‰è¨­å®š pre-warming cron job

## åƒè€ƒè³‡æ–™

- è©³ç´°è¨­è¨ˆ: `.kiro/specs/backend-health-check/`
- Zeabur éƒ¨ç½²æŒ‡å—: `ZEABUR_DEPLOYMENT_GUIDE.md`
- Serverless Cold Start æœ€ä½³å¯¦è¸: [Microsoft Azure Blog](https://azure.microsoft.com/blog/understanding-serverless-cold-start/)

---

**å¯¦ä½œå®Œæˆæ™‚é–“**: 2025-11-05  
**ç‹€æ…‹**: âœ… Ready for deployment
